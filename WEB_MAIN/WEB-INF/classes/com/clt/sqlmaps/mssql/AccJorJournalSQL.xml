<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="acc.jor.journal">
	
	<typeAlias alias="InvJorVO" 	type="com.clt.apps.fis.acc.jor.journal.dto.InvJorVO"/>		<!-- InvoiceList   -->
	<typeAlias alias="JournalVO" 	type="com.clt.apps.fis.acc.jor.journal.dto.JournalVO"/>		<!-- Journal Info   -->
	<typeAlias alias="GeneralVO" 	type="com.clt.apps.fis.acc.jor.journal.dto.GeneralVO"/>		<!-- General Info   -->
	<typeAlias alias="JournaHistoryVO" 	type="com.clt.apps.fis.acc.jor.journal.dto.JournaHistoryVO"/>		<!-- Journal Info   -->
	<typeAlias alias="FrtVO" 		type="com.clt.apps.fis.acc.inv.invoice.dto.FrtVO"/>		<!-- Freight Info   -->
	
    <!-- Deposit InvoiceList 조회  -->
    <select id="searchINV_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchINV_LIST */
		<isEqual property="page_show_yn" compareValue="Y">
		SELECT a1.*                 
          FROM (     
          SELECT ROW_NUMBER() OVER (ORDER BY T.INV_NO) as ROWNUM, T.* 
            FROM (
        </isEqual>    
          SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt 
            FROM (
          SELECT Z.*, CASE WHEN BANK_MULTI_CURR_FLAG = 'Y' 
          				   THEN isnull((SELECT  top 1 cast(xch_rt_ut AS numeric(20,8)) AS xch_rt_ut
						  				  FROM  tb_finc_perf_xcrt   <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경 (tb_inv_xcrt > tb_finc_perf_xcrt 변경)-->    
						 				 WHERE  delt_flg = 'N' AND fm_curr_cd = Z.inv_aply_curr_cd AND to_curr_cd = #f_curr_cd# AND DELT_FLG = 'N'
							    <![CDATA[  AND  ( ( dt_clss_cd = 'M' AND aply_fm_dt <= inv_xcrt_dt AND aply_to_dt >= inv_xcrt_dt )                         
						        		    OR  ( dt_clss_cd = 'D' AND aply_fm_dt BETWEEN inv_xcrt_dt AND inv_xcrt_dt) ) ]]>
				      					 ORDER BY  DT_CLSS_CD ASC),1)
      					   ELSE inv_aply_xcrt2 END AS inv_aply_xcrt
            FROM (
                 SELECT MAX(inv_dtl.INV_POST_DT)		AS inv_post_dt
		    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
		    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
				       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
				       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
				       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
				        END								AS inv_tp
		
						,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_AR)                
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_AGENT_AR)
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_AGENT_AP)
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_AP) END gl_no    
						,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AR) AND use_flg = 'Y')                
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AR) AND use_flg = 'Y')   
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AP) AND use_flg = 'Y')       
						      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AP) AND use_flg = 'Y') END gl_rmk  
						      
					   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_EX_LOSS)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_MISC_LOSS)
							 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_EX_PROFIT)
							 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_MISC_PROFIT)
					    END clr_gl_cd
				       ,MAX(inv_dtl.INV_NO)				AS inv_no
				       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
				        END 							AS buy_inv_no
				        ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.doc_ref_no)
							ELSE 
						       CASE WHEN MAX(frt.intg_bl_seq) is not null THEN MAX(bl.REF_NO)
						             WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.REF_NO)					
						        END
						END AS ref_no
						<!-- 	//#6885 [STAR-MEX] DEPOSIT ENTRY & LIST - ADDING TAX INVOICE NO. COLUMN -->
						,MAX(inv_mst.TAX_NO) as tax_no
					   , CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.MBL_NO)    
							ELSE	MAX(CASE WHEN bl.intg_bl_seq is not null THEN bl.bl_no ELSE oth.mbl_no END) 
						END 	AS bl_no 
						,MAX(inv_dtl.INV_APLY_CURR_CD)   AS inv_aply_curr_cd
				       ,MAX(inv_dtl.INV_APLY_XCRT)		AS inv_aply_xcrt2
				       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT) * -1
				        END								AS inv_sum_amt	
					   
					   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
				        END								AS bal_sum_amt
				        
				       ,MAX(inv_dtl.inv_seq)			AS inv_seq
				       ,MAX(inv_mst.trdp_cd)			AS trdp_cd
					   					   
					    <!-- #3488 Accounting Multi Language 적용  --> 	   			 
			   			,CASE
						 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
						 		 THEN MAX(trdp.locl_nm)
				 		 	ELSE MAX(trdp.eng_nm)
			   			 END AS trdp_nm
					   
				       ,CASE WHEN isnull(MAX(inv_dtl.BAL_AMT),0) = 0 THEN '1'
				             ELSE '0'
				        END 							AS clr_flag
				       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd

				       <!-- #4998 [JTC]Deposit/Payment Local Amount vs. Invoice Local Amount difference adjustment -->
				       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT), 0) - isnull(MAX(jnr_dtl.LOCL_AMT), 0)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN (isnull(MAX(inv_dtl.LOCL_TTL_AMT), 0) * -1) - (isnull(MAX(jnr_dtl.LOCL_AMT), 0) * -1)
                        END AS locl_bal_amt

						<!-- #21662 : [BINEX]Deposit, Payment -->
						,MAX(jnr_dtl.INP_TYPE)			as INP_TYPE
						,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD
						,(case          
				            when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)         
				            when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)         
				            else MAX(TIDB.MODI_TMS) 
				        end)  as modi_tms     
						
				       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
					   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
					   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
				       ,CASE WHEN MAX(inv_mst.AIR_SEA_CLSS_CD) = 'G' AND (SELECT ISNULL(OPT_VAL, '') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_GNA_RMK') = 'Y'
						     THEN MAX(inv_mst.INV_RMK)
						     ELSE ''
						 END AS jnr_desc 
					   ,(SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') AS BANK_MULTI_CURR_FLAG
					   ,#f_post_dt# AS inv_xcrt_dt  <!-- #1617 rollback -->
					   <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
					   ,max(trdp.ACCT_CD) as acct_cd
					   
					   <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
					   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0)
				             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
				        END								AS locl_ttl_amt					   
					   ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
					   ,'0' as locl_amt
					   <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
					   ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					   	ELSE 
					   		(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		 ELSE ''
					   		END) 
					   	END AS imp_ref_no  
					   
				  FROM TB_INV inv_mst
				    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
				     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
				    LEFT JOIN TB_FRT frt 
				     	ON inv_mst.INV_SEQ = frt.INV_SEQ AND frt.delt_flg = 'N'
					LEFT JOIN TB_INTG_BL bl
				     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ AND bl.delt_flg = 'N'
					LEFT JOIN TB_OTH_SALES oth
				     	ON frt.OTH_SEQ = oth.OTH_SEQ AND oth.delt_flg = 'N'  
					LEFT JOIN TB_WM_DOC_MST wms
				     	ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
					LEFT JOIN (
					           SELECT DISTINCT
                                    B.INP_TYPE
                                  , B.INV_SEQ
                                  , SUM(B.LOCL_AMT) OVER(PARTITION BY B.INV_SEQ) LOCL_AMT
                                  , B.DELT_FLG
                               FROM TB_JNR_MST A
                               JOIN TB_JNR_DTL B
                                 ON A.JNR_NO = B.JNR_NO
                                AND A.DELT_FLG = B.DELT_FLG
                              WHERE A.DELT_FLG = 'N'
                               <isNotEmpty property="s_cust_cd">
                                AND A.TRDP_CD = #s_cust_cd#
                               </isNotEmpty>
					          ) jnr_dtl
				     	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'
				    LEFT OUTER JOIN  TB_OFC ofc 
				        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N' 
					LEFT OUTER JOIN TB_ADD_INFO_BND bnd
				     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
				    LEFT OUTER JOIN TB_TRDP trdp 	
				        ON trdp.trdp_cd = inv_mst.trdp_cd
				        
					    LEFT OUTER JOIN
			            (
			                SELECT
			                    MODI_TMS,
			                    INV_SEQ 
			                FROM
			                    TB_INV_DTL_BLCK                
			            ) TIDB                          
			                ON TIDB.INV_SEQ = INV_DTL.INV_SEQ             
				        
				        
				 WHERE isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
				 
				 <isNotEmpty property="s_post_strdt">
				 	<isNotEmpty property="s_post_enddt">
				 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
				 	</isNotEmpty>
				 </isNotEmpty>
				 <isNotEmpty property="s_inv_strdt">
				 	<isNotEmpty property="s_inv_enddt">
				 		AND inv_dtl.INV_DT between #s_inv_strdt# AND #s_inv_enddt#
				 	</isNotEmpty>
				 </isNotEmpty>
				 <isNotEmpty property="s_ofc_cd">
				   AND inv_mst.OFC_CD = #s_ofc_cd#
				 </isNotEmpty>
				 <isNotEmpty property="s_cust_cd">
				   AND inv_mst.DELT_FLG = 'N'
				   AND inv_mst.TRDP_CD = #s_cust_cd#
				 </isNotEmpty>  
				 
				 <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
				 <isNotEmpty  property="s_acct_cd">
				 	AND trdp.acct_cd like #s_acct_cd#
				 </isNotEmpty>
				 
				 <isNotEmpty property="s_cust_nm">
				    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
				                WHERE trd.TRDP_CD = inv_mst.TRDP_CD AND trd.ENG_NM LIKE #s_cust_nm# + '%')
				 </isNotEmpty>
				 <isNotEmpty property="f_curr_cd">
				   AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
				 </isNotEmpty>  
				 <isEqual property="his_chk" compareValue="O">
				   AND inv_dtl.INV_STS_CD != 'IE'
				   AND inv_dtl.BAL_AMT != 0
				 </isEqual>
				   <isNotEmpty property="s_inv_no">
				       AND ( inv_dtl.INV_NO = #s_inv_no# OR inv_dtl.BUY_INV_NO = #s_inv_no# )	
				   </isNotEmpty>
				   <isEqual property="dept_chk1" compareValue="Y">
				       <isEqual property="dept_chk2" compareValue="Y">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
				       	   </isEqual>
				       </isEqual>
				       <isEqual property="dept_chk2" compareValue="N">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
				       	   </isEqual>
				       </isEqual>	    		
				   </isEqual>
				   
				   <isEqual property="dept_chk1" compareValue="N">
				       <isEqual property="dept_chk2" compareValue="Y">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
				       	   </isEqual>
				       </isEqual>
				       <isEqual property="dept_chk2" compareValue="N">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('')
				       	   </isEqual>
				       </isEqual>	    		
				   </isEqual>
				   
				 GROUP BY inv_mst.INV_SEQ
				 ) Z
				 ) Y
		<isEqual property="page_show_yn" compareValue="Y">		 
				 ) T 
				 ) a1      
           WHERE 1 = 1
           <![CDATA[
             AND a1.ROWNUM >  #beginIdx# /**P*/ 
             AND a1.ROWNUM <=  #topCnt# /**P*/ 
           ]]>  
        </isEqual>   
    </select>
    
    <select id="searchINV_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
	     /* AccJorJournalSQL.xml  searchINV_LIST_CNT */
    	SELECT COUNT(*)
    	  FROM (SELECT  MAX(inv_dtl.INV_NO)				AS inv_no
				  FROM TB_INV inv_mst
				    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
				     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
				    LEFT JOIN TB_FRT frt 
				     	ON inv_mst.INV_SEQ = frt.INV_SEQ AND frt.delt_flg = 'N'
					LEFT JOIN TB_INTG_BL bl
				     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ AND bl.delt_flg = 'N'
					LEFT JOIN TB_OTH_SALES oth
				     	ON frt.OTH_SEQ = oth.OTH_SEQ AND oth.delt_flg = 'N'  
					LEFT JOIN TB_WM_DOC_MST wms
				     	ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
					LEFT JOIN TB_JNR_DTL jnr_dtl
				     	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'	
				    LEFT OUTER JOIN  TB_OFC ofc 
				        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N' 
					LEFT OUTER JOIN TB_ADD_INFO_BND bnd
				     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
				    LEFT OUTER JOIN TB_TRDP trdp 	
				        ON trdp.trdp_cd = inv_mst.trdp_cd
				        
				 WHERE isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
				 
				 <isNotEmpty property="s_post_strdt">
				 	<isNotEmpty property="s_post_enddt">
				 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
				 	</isNotEmpty>
				 </isNotEmpty>
				 <isNotEmpty property="s_inv_strdt">
				 	<isNotEmpty property="s_inv_enddt">
				 		AND inv_dtl.INV_DT between #s_inv_strdt# AND #s_inv_enddt#
				 	</isNotEmpty>
				 </isNotEmpty>
				 <isNotEmpty property="s_ofc_cd">
				   AND inv_mst.OFC_CD = #s_ofc_cd#
				 </isNotEmpty>
				 
				 <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
				 <isNotEmpty  property="s_acct_cd">
				 	AND trdp.acct_cd like #s_acct_cd#
				 </isNotEmpty>				 
				 
				 <isNotEmpty property="s_cust_cd">
				   AND inv_mst.DELT_FLG = 'N'
				   AND inv_mst.TRDP_CD = #s_cust_cd#
				 </isNotEmpty>  
				 <isNotEmpty property="s_cust_nm">
				    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
				                WHERE trd.TRDP_CD = inv_mst.TRDP_CD AND trd.ENG_NM LIKE #s_cust_nm# + '%')
				 </isNotEmpty>
				 <isNotEmpty property="f_curr_cd">
				   AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
				 </isNotEmpty>  
				 <isEqual property="his_chk" compareValue="O">
				   AND inv_dtl.INV_STS_CD != 'IE'
				   AND inv_dtl.BAL_AMT != 0
				 </isEqual>
				   <isNotEmpty property="s_inv_no">
				       AND ( inv_dtl.INV_NO = #s_inv_no# OR inv_dtl.BUY_INV_NO = #s_inv_no# )	
				   </isNotEmpty>
				   <isEqual property="dept_chk1" compareValue="Y">
				       <isEqual property="dept_chk2" compareValue="Y">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
				       	   </isEqual>
				       </isEqual>
				       <isEqual property="dept_chk2" compareValue="N">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
				       	   </isEqual>
				       </isEqual>	    		
				   </isEqual>
				   
				   <isEqual property="dept_chk1" compareValue="N">
				       <isEqual property="dept_chk2" compareValue="Y">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
				       	   </isEqual>
				       </isEqual>
				       <isEqual property="dept_chk2" compareValue="N">
				       	   <isEqual property="dept_chk3" compareValue="Y">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
				       	   </isEqual>
				       	   <isEqual property="dept_chk3" compareValue="N">
				       	   	   AND inv_mst.sell_buy_tp_cd IN('')
				       	   </isEqual>
				       </isEqual>	    		
				   </isEqual>
				 GROUP BY inv_mst.INV_SEQ) K
	</select>
    
     <select id="searchBAD_DEBIT_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchBAD_DEBIT_LIST */
		 SELECT
        disp.trdp_cd ,
        disp.trdp_nm ,
		disp.sls_gp_cd ,
        disp.cr_term_cd,
        disp.cr_term_dt,
        disp.crd_lmt_amt,
        disp.inv_seq ,
        disp.inv_no ,
        disp.inv_dt ,
        disp.inv_sum_amt,
        disp.pay_amt ,
        disp.rgst_usrid ,
        disp.rgst_usrnm ,        
        disp.post_dt ,
        disp.inv_post_dt ,
        disp.inv_tp  ,       
		 <![CDATA[CASE WHEN disp.over_dt > 0 AND disp.over_dt < 31]]>
		 THEN ISNULL(disp.inv_sum_amt,0) - ISNULL(SUM(disp.ttl_pay_amt),0) ELSE 0 END AS over_1_30_amt,
		
		 <![CDATA[CASE WHEN disp.over_dt > 30 AND disp.over_dt < 61]]>
		 THEN ISNULL(disp.inv_sum_amt,0) - ISNULL(SUM(disp.ttl_pay_amt),0) ELSE 0 END AS over_31_60_amt,
		
		 <![CDATA[CASE WHEN disp.over_dt > 60 AND disp.over_dt < 91]]>
		 THEN ISNULL(disp.inv_sum_amt,0) - ISNULL(SUM(disp.ttl_pay_amt),0) ELSE 0 END AS over_61_90_amt,
		
		 <![CDATA[CASE WHEN disp.over_dt > 90]]>
		 THEN ISNULL(disp.inv_sum_amt,0) - ISNULL(SUM(disp.ttl_pay_amt),0) ELSE 0 END AS over_91_amt
        FROM ( 
		SELECT dtl.trdp_cd, dtl.eng_nm as trdp_nm,   
				dtl.sls_gp_cd ,
                dtl.cr_term_cd,
                dtl.cr_term_dt,
                dtl.crd_lmt_amt,
			   dtl.inv_seq,dtl.inv_no,
			   <isEqual property="f_rpt_type" compareValue="Y">
			    	SUM(dtl.inv_sum_amt) AS inv_sum_amt,
			   </isEqual>
			   <isEqual property="f_rpt_type" compareValue="N">
			   		CASE WHEN dtl.sell_buy_tp_cd ='B' THEN SUM(dtl.inv_sum_amt)*-1 ELSE SUM(dtl.inv_sum_amt) END AS inv_sum_amt,
			   </isEqual>			   
			   max(dtl.ttl_pay_amt) AS pay_amt,
				SUM(isnull(max(dtl.ttl_pay_amt),0)) OVER (PARTITION BY dtl.inv_seq) as ttl_pay_amt,	
				CASE                      
                WHEN dtl.sell_buy_tp_cd = 'S' THEN 'A/R'                                        
                WHEN dtl.sell_buy_tp_cd = 'D'	OR  dtl.sell_buy_tp_cd = 'C' THEN 'DB/CR'                                        
                WHEN dtl.sell_buy_tp_cd = 'B' THEN 'A/P'                              
            	END AS inv_tp             ,
			   dtl.inv_dt,  dtl.post_dt, dtl.inv_post_dt ,dtl.over_dt,  dtl.sell_buy_tp_cd, dtl.rgst_usrid , dtl.rgst_usrnm 
		FROM(	
			SELECT trdp.trdp_cd, trdp.eng_nm, trdp.sls_gp_cd , trdp.cr_term_cd, trdp.cr_term_dt,trdp.crd_lmt_amt,					
			inv.inv_seq,	idt.inv_no, inv.rgst_usrid,usr.eng_usr_nm AS rgst_usrnm , 
			CASE WHEN frt.sell_buy_tp_cd = 'C' THEN frt.cr_amt*-1 ELSE frt.inv_sum_amt END AS inv_sum_amt,				
			inv.sell_buy_tp_cd,			
			<isEqual property="f_acct_tp_radio" compareValue="A">
			CASE WHEN <![CDATA[jms.post_dt <= #f_end_dt#]]> AND NOT (jms.VOID_YN = 'Y' AND <![CDATA[jms.VOID_DT <= #f_end_dt#]]>)  
				THEN CASE WHEN inv.sell_buy_tp_cd IN ('C','B') THEN jdt.ttl_pay_amt * -1  ELSE jdt.ttl_pay_amt END
				ELSE 0	END AS ttl_pay_amt,
			</isEqual>
			<isEqual property="f_acct_tp_radio" compareValue="C">
			 CASE WHEN <![CDATA[jms.post_dt <= CONVERT(VARCHAR,GETDATE(),112)]]> AND NOT (jms.VOID_YN = 'Y' AND <![CDATA[jms.VOID_DT <= #f_end_dt#]]>) THEN 
 			CASE WHEN inv.sell_buy_tp_cd IN ('C','B') THEN jdt.ttl_pay_amt * -1  ELSE jdt.ttl_pay_amt END
				ELSE 0 
			END AS ttl_pay_amt,
			</isEqual>	
			jdt.jnr_no,
			idt.inv_dt, jms.post_dt, frt.inv_post_dt ,
			DATEDIFF("D", CONVERT(DATETIME,idt.inv_due_dt), CONVERT(DATETIME,#f_end_dt#)) AS over_dt
			FROM tb_trdp trdp			
			JOIN tb_inv inv ON inv.trdp_cd = trdp.trdp_cd AND inv.delt_flg = 'N'
			AND ( 1=2
			   <isEqual property="f_agn_rpt_tp_1" compareValue="A">
			   	  	OR inv.sell_buy_tp_cd = 'D'			   	  
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_2" compareValue="A">
			    	OR (inv.sell_buy_tp_cd = 'S' AND inv.sell_buy_tp_cd != 'G')			    
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_3" compareValue="A">			   
			   	   	<![CDATA[OR (inv.sell_buy_tp_cd = 'C' AND inv.inv_ttl_amt < 0 ) ]]>  
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_4" compareValue="A">
			   	   	<![CDATA[OR (inv.sell_buy_tp_cd = 'B' AND inv.sell_buy_tp_cd != 'G' AND inv.inv_ttl_amt < 0 ) ]]>
			   </isEqual>      
			   <isEqual property="f_agn_rpt_tp_5" compareValue="A">
			   	   <![CDATA[OR (inv.sell_buy_tp_cd = 'B' AND inv.air_sea_clss_cd = 'G' AND inv.inv_ttl_amt < 0) ]]>
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_6" compareValue="A">
			   	   	OR (inv.sell_buy_tp_cd = 'S' AND inv.air_sea_clss_cd = 'G')
			   </isEqual>
			)
			AND(1=2
			 <isEqual property="f_dpt_tp_1" compareValue="A">
			 	OR inv.inv_dept_cd IN ('SIM','SIH')   	   			
   			</isEqual>
		   <isEqual property="f_dpt_tp_2" compareValue="A">
		   		OR inv.inv_dept_cd IN ('SOM','SOH')		   	   
		   </isEqual>
		   <isEqual property="f_dpt_tp_3" compareValue="A">
		   		OR inv.inv_dept_cd IN ('OTH')		   	   
		   </isEqual>
		   <isEqual property="f_dpt_tp_4" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('AIM','AIH')
		   </isEqual>
		   <isEqual property="f_dpt_tp_5" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('AOM','AOH')
		   </isEqual>
		   <isEqual property="f_dpt_tp_6" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('GNR')
		   </isEqual>
		   <isEqual property="f_dpt_tp_7" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('WMS')
		   </isEqual>
			)
			JOIN tb_inv_dtl idt ON idt.inv_seq = inv.inv_seq AND idt.delt_flg = 'N'	
			LEFT OUTER JOIN (SELECT D.JNR_NO, D.INV_SEQ, SUM(D.TTL_PAY_AMT) AS TTL_PAY_AMT, MAX(d.post_dt) AS post_dt
			                                 FROM TB_JNR_DTL D
			                                     ,TB_JNR_MST M
			                                WHERE D.JNR_NO = M.JNR_NO
			                                  AND ISNULL(D.DELT_FLG, 'N')  = 'N'
			                                  AND ISNULL(M.DELT_FLG, 'N')  = 'N'
			 <isEqual property="f_dt_tp_radio" compareValue="I">                                 
			 AND ISNULL(M.VOID_YN,  'N') != 'Y'
			 </isEqual>
			                               GROUP BY D.JNR_NO, D.INV_SEQ) JDT ON JDT.INV_SEQ = INV.INV_SEQ
			
			LEFT OUTER JOIN TB_JNR_MST JMS ON JMS.JNR_NO= JDT.JNR_NO AND JMS.DELT_FLG = 'N'
			<isEqual property="f_dt_tp_radio" compareValue="I"> 
			  AND JMS.VOID_YN != 'Y'
			</isEqual>
			JOIN tb_frt frt ON frt.inv_seq = inv.inv_seq AND frt.delt_flg = 'N'
			left outer JOIN	tb_usr usr ON inv.rgst_usrid = usr.usrid
			<isEqual property="released_check" compareValue="O">
			JOIN tb_intg_bl bl
			ON bl.intg_bl_seq = frt.intg_bl_seq AND bl.delt_flg = 'N'
			AND (bl.RLSD_FLG = 'Y' OR (bl.CGO_RLSD_ON_DT_TM IS NOT NULL AND bl.CGO_RLSD_ON_DT_TM != ''))
			</isEqual>
			WHERE 1=1
			<isNotEmpty property="f_curr_cd">
			 AND idt.inv_aply_curr_cd = #f_curr_cd#
			</isNotEmpty> 			
			<isNotEmpty property="f_ofc_cd">
			 AND inv.ofc_cd = #f_ofc_cd#
			</isNotEmpty>
			
			<isEqual property="f_date_radio" compareValue="A">
				<isEqual property="f_dt_tp_radio" compareValue="P">
				<![CDATA[AND frt.inv_post_dt <= #f_end_dt# ]]>
				</isEqual>
				<isEqual property="f_dt_tp_radio" compareValue="I">
				<![CDATA[AND idt.inv_dt <= #f_end_dt# ]]>
				</isEqual>
			</isEqual>
			
			<isEqual property="f_date_radio" compareValue="P">
				<isEqual property="f_dt_tp_radio" compareValue="P">
				<![CDATA[AND frt.inv_post_dt >= #f_start_dt# ]]>
				<![CDATA[AND frt.inv_post_dt <= #f_end_dt# ]]>
				</isEqual>
				<isEqual property="f_dt_tp_radio" compareValue="I">
				<![CDATA[AND idt.inv_dt >= #f_start_dt# ]]>
				<![CDATA[AND idt.inv_dt <= #f_end_dt# ]]>
				</isEqual>
			</isEqual>
			
			UNION ALL
			SELECT trdp.trdp_cd, trdp.eng_nm,trdp.sls_gp_cd , trdp.cr_term_cd, trdp.cr_term_dt,trdp.crd_lmt_amt,
			inv.inv_seq,idt.inv_no,inv.rgst_usrid, usr.eng_usr_nm AS rgst_usrnm,
			0 AS inv_sum_amt,
			inv.sell_buy_tp_cd,			
			 (CASE WHEN NOT (jms.VOID_YN = 'Y' AND <![CDATA[jms.VOID_DT <= #f_end_dt#]]>)  THEN  
			 (CASE WHEN inv.sell_buy_tp_cd IN ('C','B') THEN jdt.ttl_pay_amt * -1 ELSE jdt.ttl_pay_amt END)  ELSE 0 END) AS ttl_pay_amt,
			jdt.jnr_no,
			idt.inv_dt,  jms.post_dt, frt.inv_post_dt 	,
			DATEDIFF("D", CONVERT(DATETIME,idt.inv_due_dt), CONVERT(DATETIME,#f_end_dt#)) AS over_dt
			FROM tb_trdp trdp			
			JOIN tb_inv inv
			ON inv.trdp_cd = trdp.trdp_cd AND inv.delt_flg = 'N'
			AND ( 1=2
			   <isEqual property="f_agn_rpt_tp_1" compareValue="A">
			   	  	OR inv.sell_buy_tp_cd = 'D'			   	  
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_2" compareValue="A">
			    	OR (inv.sell_buy_tp_cd = 'S' AND inv.sell_buy_tp_cd != 'G')			    
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_3" compareValue="A">
			   <![CDATA[OR (inv.sell_buy_tp_cd = 'C' AND inv.inv_ttl_amt < 0 ) ]]>			   	   		
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_4" compareValue="A">
			   	   	<![CDATA[OR (inv.sell_buy_tp_cd = 'B' AND inv.sell_buy_tp_cd != 'G' AND inv.inv_ttl_amt < 0 ) ]]>
			   </isEqual>      
			   <isEqual property="f_agn_rpt_tp_5" compareValue="A">
			   	   	<![CDATA[OR (inv.sell_buy_tp_cd = 'B' AND inv.air_sea_clss_cd = 'G' AND inv.inv_ttl_amt < 0 ) ]]>
			   </isEqual>
			   <isEqual property="f_agn_rpt_tp_6" compareValue="A">
			   	   	OR (inv.sell_buy_tp_cd = 'S' AND inv.air_sea_clss_cd = 'G')
			   </isEqual>      
			)
			AND(1=2
			   <isEqual property="f_dpt_tp_1" compareValue="A">
			 	OR inv.inv_dept_cd IN ('SIM','SIH')   	   			
   			</isEqual>
		   <isEqual property="f_dpt_tp_2" compareValue="A">
		   		OR inv.inv_dept_cd IN ('SOM','SOH')		   	   
		   </isEqual>
		   <isEqual property="f_dpt_tp_3" compareValue="A">
		   		OR inv.inv_dept_cd IN ('OTH')		   	   
		   </isEqual>
		   <isEqual property="f_dpt_tp_4" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('AIM','AIH')
		   </isEqual>
		   <isEqual property="f_dpt_tp_5" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('AOM','AOH')
		   </isEqual>
		   <isEqual property="f_dpt_tp_6" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('GNR')
		   </isEqual>
		   <isEqual property="f_dpt_tp_7" compareValue="A">
		   	   OR inv.inv_dept_cd IN ('WMS')
		   </isEqual>
			)
			JOIN tb_inv_dtl idt ON idt.inv_seq = inv.inv_seq AND ISNULL(idt.delt_flg,'N') = 'N'
			JOIN (SELECT JNR_NO, INV_SEQ, SUM(ttl_pay_amt) AS ttl_pay_amt ,MAX(post_dt) AS post_dt
			                                 FROM tb_jnr_dtl 
			                               WHERE ISNULL(delt_flg,'N') = 'N' 
			                               GROUP BY JNR_NO, INV_SEQ) jdt ON jdt.inv_seq = inv.inv_seq
			
			JOIN tb_jnr_mst jms ON jms.jnr_no= jdt.jnr_no 
			JOIN tb_frt frt ON frt.inv_seq = inv.inv_seq AND frt.delt_flg = 'N'
			left outer JOIN tb_usr usr ON inv.rgst_usrid = usr.usrid
			<isEqual property="released_check" compareValue="O">
			JOIN tb_intg_bl bl
			ON bl.intg_bl_seq = frt.intg_bl_seq AND bl.delt_flg = 'N'
			AND (bl.RLSD_FLG = 'Y' OR (bl.CGO_RLSD_ON_DT_TM IS NOT NULL AND bl.CGO_RLSD_ON_DT_TM != ''))
			</isEqual>
			WHERE 1=1
			<isEqual property="f_dt_tp_radio" compareValue="I">
			<![CDATA[AND 1=2 AND idt.inv_dt > #f_end_dt#]]>
			</isEqual>
			<isEqual property="f_dt_tp_radio" compareValue="P">
			<![CDATA[AND frt.inv_post_dt  >  #f_end_dt#]]>
			</isEqual>
			<![CDATA[AND jms.post_dt <= #f_end_dt#]]>
			AND jms.delt_flg = 'N'
			<isNotEmpty property="f_curr_cd">
			AND idt.inv_aply_curr_cd = #f_curr_cd#
			</isNotEmpty> 
			<isNotEmpty property="f_ofc_cd">
			 AND inv.ofc_cd = #f_ofc_cd#
			</isNotEmpty>
			)dtl 
			group by 
			dtl.trdp_cd, dtl.eng_nm, 
			dtl.sls_gp_cd , 
			dtl.cr_term_cd, 
			dtl.cr_term_dt,
			dtl.crd_lmt_amt,
			dtl.inv_seq,
			dtl.inv_no,
			dtl.inv_dt, 			
			dtl.sell_buy_tp_cd,
			dtl.jnr_no,
			dtl.rgst_usrid,
			dtl.rgst_usrnm,
			dtl.post_dt,
			dtl.inv_post_dt,
			dtl.over_dt
			) disp <![CDATA[WHERE disp.inv_sum_amt <> disp.ttl_pay_amt]]>
			AND  disp.inv_sum_amt != 0     
			group by  disp.trdp_cd ,
	        disp.trdp_nm ,
	        disp.sls_gp_cd ,
	        disp.cr_term_cd,
	        disp.cr_term_dt,
	        disp.crd_lmt_amt,
	        disp.inv_seq ,
	        disp.inv_no ,
	        disp.inv_dt ,
	        disp.inv_sum_amt,
	        disp.pay_amt ,
	        disp.rgst_usrid ,
	        disp.rgst_usrnm ,
	        disp.post_dt ,
	        disp.inv_post_dt ,
	        disp.inv_tp  ,
			disp.over_dt 
			order by disp.inv_dt desc, disp.inv_seq 
    </select>
    
    <!-- Check InvoiceList 조회  -->
    <select id="searchCHK_INV_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchCHK_INV_LIST */
		<isEqual property="page_show_yn" compareValue="Y">
		SELECT a1.*                 
          FROM (     
                SELECT ROW_NUMBER() OVER (ORDER BY T.INV_NO) as ROWNUM, T.* 
           	     FROM(
        </isEqual>   	 
        SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt 
            FROM (
          SELECT Z.*, CASE WHEN BANK_MULTI_CURR_FLAG = 'Y' 
          				   THEN isnull((SELECT  top 1 cast(xch_rt_ut AS numeric(20,8)) AS xch_rt_ut
						  				  FROM  tb_finc_perf_xcrt WITH(NOLOCK) <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경 (tb_inv_xcrt > tb_finc_perf_xcrt 변경)-->
						 				 WHERE  delt_flg = 'N' AND fm_curr_cd = Z.inv_aply_curr_cd AND to_curr_cd = #f_curr_cd# AND DELT_FLG = 'N'
							    <![CDATA[  AND  ( ( dt_clss_cd = 'M' AND aply_fm_dt <= inv_xcrt_dt AND aply_to_dt >= inv_xcrt_dt )                         
						        		    OR  ( dt_clss_cd = 'D' AND aply_fm_dt BETWEEN inv_xcrt_dt AND inv_xcrt_dt) ) ]]>
				      					 ORDER BY  DT_CLSS_CD ASC),1)
      					   ELSE inv_aply_xcrt2 END AS inv_aply_xcrt
            FROM (    
           	     
			    	SELECT  MAX(inv_dtl.INV_POST_DT)		AS inv_post_dt
			    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
			    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
					       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
					       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
					        END								AS inv_tp
			
							,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_AR)                
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_AGENT_AR)
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_AGENT_AP)
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_AP) END gl_no
							,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN (SELECT RMK FROM TB_GL_CD WITH(NOLOCK) WHERE GL_CD = MAX(ofc.GL_AR) AND use_flg = 'Y')                
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN (SELECT RMK FROM TB_GL_CD WITH(NOLOCK) WHERE GL_CD = MAX(ofc.GL_AGENT_AR) AND use_flg = 'Y')      
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN (SELECT RMK FROM TB_GL_CD WITH(NOLOCK) WHERE GL_CD = MAX(ofc.GL_AGENT_AP) AND use_flg = 'Y')        
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN (SELECT RMK FROM TB_GL_CD WITH(NOLOCK) WHERE GL_CD = MAX(ofc.GL_AP) AND use_flg = 'Y') END gl_rmk  
						    
						   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_EX_LOSS)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_MISC_LOSS)
								 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_EX_PROFIT)
								 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_MISC_PROFIT)
						    END clr_gl_cd 
					       ,MAX(inv_dtl.INV_NO)				AS inv_no
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
					        END 							AS buy_inv_no
					        ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.doc_ref_no)
					       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN MAX(bl.REF_NO)
					             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.REF_NO)					
									 END
								END 	AS ref_no
						   , CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.MBL_NO)
						   		ELSE     
					       			MAX(CASE WHEN bl.intg_bl_seq is not null THEN bl.bl_no ELSE oth.mbl_no END)	
					       		END	AS bl_no
					       ,MAX(inv_dtl.INV_APLY_CURR_CD)   AS inv_aply_curr_cd
					       ,MAX(inv_dtl.INV_APLY_XCRT)		AS inv_aply_xcrt2
					       
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT) * -1
					             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT) 
					        END								AS inv_sum_amt	
						   
						   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
					             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
					        END								AS bal_sum_amt

					       ,MAX(inv_dtl.inv_seq)			AS inv_seq
					       ,MAX(inv_mst.trdp_cd)			AS trdp_cd
						   
							<!-- #3488 Accounting Multi Language 적용  --> 	   			 
				   			,CASE
							 	WHEN (SELECT opt_val FROM TB_SYS_OPT WITH(NOLOCK) WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
							 		 THEN MAX(trdp.locl_nm)
					 		 	ELSE 	  MAX(trdp.eng_nm)				
				   			 END AS trdp_nm
						   
					       ,CASE WHEN isnull(MAX(inv_dtl.BAL_AMT),0) = 0 THEN '1'
					             ELSE '0'
					        END 							AS clr_flag
					       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd

					       <!-- #4998 [JTC]Deposit/Payment Local Amount vs. Invoice Local Amount difference adjustment -->
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN (isnull(MAX(inv_dtl.LOCL_TTL_AMT), 0) * -1) - (isnull(MAX(jnr_dtl.LOCL_AMT), 0) * -1)
	                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT), 0) - isnull(MAX(jnr_dtl.LOCL_AMT), 0)
	                        END AS locl_bal_amt

							<!-- #21662 : [BINEX]Deposit, Payment -->
							,MAX(jnr_dtl.INP_TYPE)			as INP_TYPE
							,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
							,(case          
					            when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)         
					            when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)         
					            else MAX(TIDB.MODI_TMS) 
					        end)  as modi_tms        
					        ,'' AS jnr_modi_tms   
							
					       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
						   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
						   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
				           ,CASE WHEN MAX(inv_mst.AIR_SEA_CLSS_CD) = 'G' AND (SELECT ISNULL(OPT_VAL, '') FROM TB_SYS_OPT WITH(NOLOCK) WHERE OPT_KEY = 'BANK_GNA_RMK') = 'Y'
							     THEN MAX(inv_mst.INV_RMK)
							     ELSE ''
							 END AS jnr_desc 
					   ,(SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WITH(NOLOCK) WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') AS BANK_MULTI_CURR_FLAG 
					   ,#f_post_dt# AS inv_xcrt_dt  <!-- #1617 rollback -->
                       <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
                       ,max(trdp.ACCT_CD) as acct_cd    		
                       
					   <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
					   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
				             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) 
				        END								AS locl_ttl_amt					   
					   ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
					   ,'0' as locl_amt			   
					   <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
					   ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					   	ELSE 
					   		(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		 ELSE ''
					   		END) 
					   	END AS imp_ref_no                      
                       			   
					  FROM TB_INV inv_mst WITH(NOLOCK)
					    LEFT OUTER JOIN TB_INV_DTL inv_dtl WITH(NOLOCK)
					     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
					    LEFT JOIN TB_FRT frt WITH(NOLOCK)
					     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
						LEFT JOIN TB_INTG_BL bl WITH(NOLOCK)
					     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
						LEFT JOIN TB_OTH_SALES oth WITH(NOLOCK)
					     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
					    LEFT JOIN TB_WM_DOC_MST wms WITH(NOLOCK)
				   			ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N' 	
						LEFT JOIN (
						           SELECT DISTINCT
	                                    B.INP_TYPE
	                                  , B.INV_SEQ
	                                  , SUM(B.LOCL_AMT) OVER(PARTITION BY B.INV_SEQ) LOCL_AMT
	                                  , B.DELT_FLG
	                               FROM TB_JNR_MST A WITH(NOLOCK)
	                               JOIN TB_JNR_DTL B WITH(NOLOCK)
	                                 ON A.JNR_NO = B.JNR_NO
	                                AND A.DELT_FLG = B.DELT_FLG
	                              WHERE A.DELT_FLG = 'N'
	                               <isNotEmpty property="s_cust_cd">
	                                AND A.TRDP_CD = #s_cust_cd#
	                               </isNotEmpty>
						          ) jnr_dtl
					      ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'
					    LEFT OUTER JOIN  TB_OFC ofc WITH(NOLOCK)
					        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N'
						LEFT OUTER JOIN TB_ADD_INFO_BND bnd WITH(NOLOCK)
					     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
					    LEFT OUTER JOIN TB_TRDP trdp WITH(NOLOCK)
					        ON trdp.trdp_cd = inv_mst.trdp_cd 	
					     LEFT OUTER JOIN
				            (
				                SELECT
				                    MODI_TMS,
				                    INV_SEQ 
				                FROM
				                    TB_INV_DTL_BLCK WITH(NOLOCK)
				            ) TIDB                          
			                ON TIDB.INV_SEQ = INV_DTL.INV_SEQ             
                
                 
					 WHERE  isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
					   AND inv_mst.DELT_FLG = 'N'
					 
					 <isNotEmpty property="s_post_strdt">
					 	<isNotEmpty property="s_post_enddt">
					 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
					 	</isNotEmpty>
					 </isNotEmpty>
					 <isNotEmpty property="s_inv_strdt">
				 		<isNotEmpty property="s_inv_enddt">
				 		AND inv_dtl.INV_DT between #s_inv_strdt# AND #s_inv_enddt#
				 		</isNotEmpty>
					 </isNotEmpty>
					 <isNotEmpty property="s_ofc_cd">
					   AND inv_mst.OFC_CD = #s_ofc_cd#
					 </isNotEmpty>
                     <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
                     <isNotEmpty  property="s_acct_cd">
                         AND trdp.acct_cd like #s_acct_cd#
                     </isNotEmpty>                 
					   
					 <isNotEmpty property="s_cust_cd">
					   AND inv_mst.TRDP_CD = #s_cust_cd#
					 </isNotEmpty>  
					 <isNotEmpty property="s_cust_nm">
					    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
					                WHERE trd.TRDP_CD = inv_mst.TRDP_CD
					                <!-- #3488 Accounting Multi Language 적용  --> 
					                AND ( trd.ENG_NM LIKE #s_cust_nm# + '%' OR trd.LOCL_NM LIKE #s_cust_nm# + '%' ) 
					               )
					 </isNotEmpty>
					 <isNotEmpty property="f_curr_cd">
					   AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WITH(NOLOCK) WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
					 </isNotEmpty> 
					 <isEqual property="his_chk" compareValue="O">
					   AND inv_dtl.INV_STS_CD != 'IE'
					   AND inv_dtl.BAL_AMT != 0
					 </isEqual>
					   <isNotEmpty property="s_inv_no">
					       AND (
						           ( inv_mst.sell_buy_tp_cd = 'B'  AND inv_dtl.BUY_INV_NO = #s_inv_no#)
						           OR
						           ( inv_mst.sell_buy_tp_cd != 'B' AND inv_dtl.INV_NO = #s_inv_no#)
					       	   )
					   </isNotEmpty>
					   
					   <isEqual property="dept_chk1" compareValue="Y">
					       <isEqual property="dept_chk2" compareValue="Y">
					       	   <isEqual property="dept_chk3" compareValue="Y">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
					       	   </isEqual>
					       	   <isEqual property="dept_chk3" compareValue="N">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
					       	   </isEqual>
					       </isEqual>
					       <isEqual property="dept_chk2" compareValue="N">
					       	   <isEqual property="dept_chk3" compareValue="Y">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
					       	   </isEqual>
					       	   <isEqual property="dept_chk3" compareValue="N">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
					       	   </isEqual>
					       </isEqual>	    		
					   </isEqual>
					   
					   <isEqual property="dept_chk1" compareValue="N">
					       <isEqual property="dept_chk2" compareValue="Y">
					       	   <isEqual property="dept_chk3" compareValue="Y">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
					       	   </isEqual>
					       	   <isEqual property="dept_chk3" compareValue="N">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
					       	   </isEqual>
					       </isEqual>
					       <isEqual property="dept_chk2" compareValue="N">
					       	   <isEqual property="dept_chk3" compareValue="Y">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
					       	   </isEqual>
					       	   <isEqual property="dept_chk3" compareValue="N">
					       	   	   AND inv_mst.sell_buy_tp_cd IN('')
					       	   </isEqual>
					       </isEqual>	    		
					   </isEqual>
					   <!-- OFVFOUR-8025 [ALA WHITELINE] ADD COLUMNS ON DEPOSIT/PAYMENT LIST & ENTRY -->
					   <isNotEmpty property="s_agent_ref_no">
								AND EXISTS( 
									 SELECT 1
								        FROM tb_frt B WITH(nolock)
								        LEFT OUTER JOIN tb_intg_bl  A WITH(nolock) on B.intg_bl_seq = A.intg_bl_seq
								       WHERE 1=1
								         AND B.inv_seq = inv_dtl.inv_seq
										 AND (CASE WHEN Isnull(inv_dtl.cust_ref_no, '') != '' AND (inv_mst.sell_buy_tp_cd IN ( 'D', 'C' ) ) THEN Isnull(inv_dtl.cust_ref_no, '')
					                              ELSE
					               			          CASE WHEN A.biz_clss_cd = 'M' THEN A.imp_ref_no
					                                       WHEN A.biz_clss_cd = 'H' THEN A.prnr_ref_no
					                                  ELSE ''
					                                  END
					                         END) LIKE '%' + #s_agent_ref_no# + '%'

								) 
					 </isNotEmpty>
					 GROUP BY inv_mst.INV_SEQ
					 ) Z
				 ) Y
		   <isEqual property="page_show_yn" compareValue="Y"> 
					 ) T ) a1      
           WHERE 1 = 1
           <![CDATA[
             AND a1.ROWNUM >  #beginIdx# /**P*/ 
             AND a1.ROWNUM <=  #topCnt# /**P*/
           ]]>  
           </isEqual>
    </select>
    
    <select id="searchCHK_INV_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
	     /* AccJorJournalSQL.xml  searchCHK_INV_LIST_CNT */
	     SELECT COUNT(*)
           	     FROM(
	    	SELECT  MAX(inv_dtl.INV_POST_DT)		AS inv_post_dt
	    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
	    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
			       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
			       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
			        END								AS inv_tp
	
					,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_AR)                
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_AGENT_AR)
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_AGENT_AP)
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_AP) END gl_no
					,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AR) AND use_flg = 'Y')                
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AR) AND use_flg = 'Y')      
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AP) AND use_flg = 'Y')        
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AP) AND use_flg = 'Y') END gl_rmk  
				    
				   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_EX_LOSS)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_MISC_LOSS)
						 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_EX_PROFIT)
						 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_MISC_PROFIT)
				    END clr_gl_cd 
			       ,MAX(inv_dtl.INV_NO)				AS inv_no
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
			        END 							AS buy_inv_no
			        ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.doc_ref_no)
			       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN MAX(bl.REF_NO)
			             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.REF_NO)					
							 END
						END 	AS ref_no
				   , CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.MBL_NO)
				   		ELSE     
			       			MAX(CASE WHEN bl.intg_bl_seq is not null THEN bl.bl_no ELSE oth.mbl_no END)	
			       		END	AS bl_no
			       ,MAX(inv_dtl.INV_APLY_CURR_CD)   AS inv_aply_curr_cd
			       ,MAX(inv_dtl.INV_APLY_XCRT)		AS inv_aply_xcrt
			       
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT) * -1
			             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT) 
			        END								AS inv_sum_amt	
				   
				   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
			             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
			        END								AS bal_sum_amt
	
			       ,MAX(inv_dtl.inv_seq)			AS inv_seq
			       ,MAX(inv_mst.trdp_cd)			AS trdp_cd
				   			
	   				<!-- #3488 Accounting Multi Language 적용  --> 	   			 
		   			,CASE
					 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
					 		 THEN MAX(trdp.locl_nm)
			 		 	ELSE MAX(trdp.eng_nm)
		   			 END AS trdp_nm
				   
			       ,CASE WHEN isnull(MAX(inv_dtl.BAL_AMT),0) = 0 THEN '1'
			             ELSE '0'
			        END 							AS clr_flag
			       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
			       
					<!-- #21662 : [BINEX]Deposit, Payment -->
					,MAX(jnr_dtl.INP_TYPE)			as INP_TYPE
					,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
					,MAX(inv_dtl.modi_tms) AS modi_tms
					
			       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
				   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
				   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
				   ,CASE WHEN MAX(inv_mst.AIR_SEA_CLSS_CD) = 'G' AND (SELECT ISNULL(OPT_VAL, '') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_GNA_RMK') = 'Y'
					     THEN MAX(inv_mst.INV_RMK)
					     ELSE ''
					 END AS jnr_desc  
			  FROM TB_INV inv_mst
			    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
			     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
			    LEFT JOIN TB_FRT frt 
			     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
				LEFT JOIN TB_INTG_BL bl
			     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
				LEFT JOIN TB_OTH_SALES oth
			     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
			    LEFT JOIN TB_WM_DOC_MST wms
		   			ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N' 	
				LEFT JOIN TB_JNR_DTL jnr_dtl
			     	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'	
			    LEFT OUTER JOIN  TB_OFC ofc 
			        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N'
				LEFT OUTER JOIN TB_ADD_INFO_BND bnd
			     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
			    LEFT OUTER JOIN TB_TRDP trdp 	
			        ON trdp.trdp_cd = inv_mst.trdp_cd 	
			        
			 WHERE  isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
			   AND inv_mst.DELT_FLG = 'N'
			 
			 <isNotEmpty property="s_post_strdt">
			 	<isNotEmpty property="s_post_enddt">
			 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
			 	</isNotEmpty>
			 </isNotEmpty>
			 <isNotEmpty property="s_inv_strdt">
				 <isNotEmpty property="s_inv_enddt">
				 	AND inv_dtl.INV_DT between #s_inv_strdt# AND #s_inv_enddt#
				 </isNotEmpty>
			 </isNotEmpty>
			 <isNotEmpty property="s_ofc_cd">
			   AND inv_mst.OFC_CD = #s_ofc_cd#
			 </isNotEmpty>
             <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
             <isNotEmpty  property="s_acct_cd">
                 AND trdp.acct_cd like #s_acct_cd#
             </isNotEmpty>                 
			   
			 <isNotEmpty property="s_cust_cd">
			   AND inv_mst.TRDP_CD = #s_cust_cd#
			 </isNotEmpty>  
			 <isNotEmpty property="s_cust_nm">
			    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
			                WHERE trd.TRDP_CD = inv_mst.TRDP_CD 
							<!-- #3488 Accounting Multi Language 적용  -->			                
			                AND ( trd.ENG_NM LIKE #s_cust_nm# + '%' OR trd.LOCL_NM LIKE #s_cust_nm# + '%' )
			                )
			 </isNotEmpty>
			 <isNotEmpty property="f_curr_cd">
			   AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
			 </isNotEmpty> 
			 <isEqual property="his_chk" compareValue="O">
			   AND inv_dtl.INV_STS_CD != 'IE'
			   AND inv_dtl.BAL_AMT != 0
			 </isEqual>
			   <isNotEmpty property="s_inv_no">
			       AND (
				           ( inv_mst.sell_buy_tp_cd = 'B'  AND inv_dtl.BUY_INV_NO = #s_inv_no#)
				           OR
				           ( inv_mst.sell_buy_tp_cd != 'B' AND inv_dtl.INV_NO = #s_inv_no#)
			       	   )
			   </isNotEmpty>
			   
			   <isEqual property="dept_chk1" compareValue="Y">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			   
			   <isEqual property="dept_chk1" compareValue="N">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			 GROUP BY inv_mst.INV_SEQ) T 
	</select>
    
    
    <!-- 생성된 DEPOSIT JOURNAL InvoiceList 조회  -->
    <select id="searchINV_JNR_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
        /* AccJorJournalSQL.xml > searchINV_JNR_LIST */
        SELECT Y.*
             , inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
          FROM (
                SELECT  MAX(jnr_dtl.POST_DT)            AS inv_post_dt
                       ,MAX(inv_dtl.INV_DT)             AS inv_dt
                       ,MAX(inv_dtl.INV_DUE_DT)         AS inv_due_dt
                       ,MAX(jnr_dtl.OFC_CD)             AS ofc_cd
                       ,MAX(inv_mst.INV_DEPT_CD)        AS inv_dept_cd
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
                        END                             AS inv_tp
                       ,MAX(jnr_dtl.INV_NO)             AS inv_no
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
                             ELSE MAX(jnr_dtl.INV_NO)
                        END                             AS buy_inv_no
                       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)           AS ref_no
                       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)           AS bl_no
                       ,MAX(jnr_dtl.CURR_CD)            AS inv_aply_curr_cd
                       ,MAX(jnr_dtl.XCRT)               AS inv_aply_xcrt
                		<!-- 	//#6885 [STAR-MEX] DEPOSIT ENTRY & LIST - ADDING TAX INVOICE NO. COLUMN -->
                	   ,MAX(inv_mst.TAX_NO) as tax_no
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) * -1
                             ELSE MAX(inv_dtl.inv_sum_amt)
                        END                             AS inv_sum_amt
                       ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
                             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
                        END)    +
                        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
                             ELSE MAX(jnr_dtl.pay_amt)
                        END)                                AS bal_sum_amt
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
                             ELSE MAX(jnr_dtl.pay_amt)
                        END                             AS pay_amt
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
                             ELSE MAX(jnr_dtl.ttl_pay_amt)
                        END                             AS ttl_pay_amt
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
                             ELSE MAX(jnr_dtl.pay_amt)
                        END                             AS old_pay_amt
                
                       ,MAX(jnr_dtl.GL_NO)              AS gl_no
                       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
                       ,MAX(jnr_dtl.JNR_DESC)           AS jnr_desc
                       ,MAX(inv_dtl.inv_seq)            AS inv_seq
                       <!-- ,MAX(inv_dtl.inv_no)                AS inv_no -->
                       ,MAX(jnr_mst.trdp_cd)            AS trdp_cd
                       <!-- ,(SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd)) AS trdp_nm -->
                
                       <!-- #3488 Accounting Multi Language 적용  -->
                       ,CASE WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y'
                             THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
                             ELSE (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
                         END AS trdp_nm
                
                       ,MAX(jnr_mst.RCVD_FM_NM)         AS rcvd_fm_nm
                       ,MAX(jnr_mst.RCVD_FM_CD)         AS rcvd_fm_cd <!-- OFVFOUR-7851: [JH LOGISTICS] TP: CARGO INTERNATIONAL (TP13613)  -->
                       ,MAX(jnr_mst.payto_cd)           AS payto_cd
                       ,MAX(jnr_mst.JNR_NO)             AS jnr_no
                       ,MAX(jnr_dtl.JNR_SEQ)            AS jnr_seq
                
                       ,MAX(jnr_mst.post_dt)            AS r_post_dt
                       ,MAX(jnr_mst.bank_seq)           AS r_bank_seq
                       <!-- //#6375 [Bug-Deposit/Payment Entry] Bank Field could be shown regardless of Use Flag -->
                       ,(SELECT bank.bank_nm FROM tb_bank bank WHERE MAX(jnr_mst.bank_seq) = bank.bank_seq) AS r_bank_nm
                       ,MAX(jnr_mst.clr_yn)             AS r_clr_yn
                       ,MAX(jnr_mst.clr_dt)             AS r_clr_dt
                       ,MAX(jnr_mst.void_yn)            AS r_void_yn
                       ,MAX(jnr_mst.void_dt)            AS r_void_dt
                       ,MAX(jnr_mst.chk_no)             AS r_chk_no
                       ,MAX(jnr_mst.amt)                AS r_amt
                       ,MAX(jnr_mst.curr_cd)            AS r_curr_cd
                       ,MAX(jnr_mst.rmk)                AS r_rmk
                       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S'
                                 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
                                           ELSE '0'
                                      END
                             ELSE '1'
                        END                             AS clr_flag
                       ,MAX(inv_mst.sell_buy_tp_cd)     AS sell_buy_tp_cd
                       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) as CLT_CMPL_FLG
                
                       ,MAX(jnr_dtl.INP_TYPE)           AS INP_TYPE
                       ,MAX(inv_mst.AIR_SEA_CLSS_CD)    AS AIR_SEA_CLSS_CD
                
                       ,MAX(jnr_mst.JNR_YN)             AS jnr_yn
                       ,MAX(jnr_mst.JNR_DT)             AS jnr_dt
                       ,MAX(jnr_mst.CLS_YN)             AS cls_yn
                       ,MAX(jnr_mst.CLS_DT)             AS cls_dt
                
                       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
                       ,MAX(bl.biz_clss_cd)  as biz_clss_cd
                       ,MAX(bl.intg_bl_seq)  as intg_bl_seq
                
                       ,max(jnr_mst.p_ofc_cd) as master_ofc_cd <!-- 201601 추가 -->

                         <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
                        ,(case when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
                               when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
                               else MAX(TIDB.MODI_TMS)
                          end)                as modi_tms
                
                       ,MAX(jnr_dtl.POST_DT)            AS inv_xcrt_dt  <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경  MAX(jnr_mst.post_dt)>MAX(jnr_dtl.POST_DT) 변경  -->
                       <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
                        END                             AS locl_ttl_amt
                       ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt

                       ,MAX(convert(float,jnr_mst.locl_amt))  as tot_locl_amt
                       ,MAX(convert(float,jnr_mst.locl_xcrt)) as tot_locl_xcrt
                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(jnr_dtl.LOCL_AMT),0)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(jnr_dtl.LOCL_AMT),0) * -1
                             ELSE MAX(jnr_dtl.LOCL_AMT)
                        END                             AS locl_amt

                       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(locl_bal.locl_bal_amt),0)
                             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(locl_bal.locl_bal_amt),0) * -1
                        END as locl_bal_amt
                        <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
					   ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					   	ELSE 
					   		(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		 ELSE ''
					   		END) 
					   	END AS imp_ref_no  
                
                  FROM TB_JNR_MST jnr_mst
                    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
                        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
                    LEFT OUTER JOIN TB_INV_DTL inv_dtl
                        /*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
                        ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
                    LEFT OUTER JOIN TB_INV inv_mst
                        ON inv_dtl.inv_seq = inv_mst.inv_seq
                    LEFT OUTER JOIN TB_FRT frt
                        ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
                    LEFT OUTER JOIN TB_INTG_BL bl
                        ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
                    LEFT OUTER JOIN TB_OTH_SALES oth
                        ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
                    LEFT OUTER JOIN  TB_WM_DOC_MST wms
                        ON frt.WMS_SEQ = wms.WM_DOC_SEQ
                    AND wms.delt_flg = 'N'
                    LEFT OUTER JOIN TB_ADD_INFO_BND bnd
                        ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
                    LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK
                        ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
                
                    <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
                    LEFT OUTER JOIN (SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK) TIDB
                      ON TIDB.INV_SEQ = INV_DTL.INV_SEQ

                    LEFT OUTER JOIN (
                                     select B.INV_SEQ
                                          , c.locl_ttl_amt - (sum(b.locl_amt) over(partition by b.inv_seq)) as locl_bal_amt
                                          , A.JNR_NO
                                       from tb_jnr_mst a
                                       join tb_jnr_dtl b
                                         on a.jnr_no = b.jnr_no
                                        and a.delt_flg = b.delt_flg
                                       join tb_inv_dtl c
                                         on c.inv_seq = b.inv_seq
                                      where 1 = 1
                                        and a.delt_flg = 'N'
                                        AND b.inv_seq IN (select inv_seq from tb_jnr_dtl where jnr_no = #f_jnr_no#)
                                    ) locl_bal
                      ON jnr_dtl.inv_seq = locl_bal.INV_SEQ
              WHERE 1 = 1
                AND jnr_mst.jnr_no = #f_jnr_no#
                AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
                AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
              <isNotEmpty property="f_jnr_tp">
                AND jnr_mst.jnr_tp = #f_jnr_tp#
              </isNotEmpty>
                AND jnr_mst.level = '1'
              GROUP BY jnr_dtl.JNR_SEQ
            ) Y
    </select>
    
    <!-- 생성된 DEPOSIT JOURNAL InvoiceList 조회 MANAGE   -->
    <select id="searchINV_JNR_LIST_MNG" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchINV_JNR_LIST_MNG */
		SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
            FROM (
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       <!-- 6885 : [STAR-MEX] DEPOSIT ENTRY & LIST - ADDING TAX INVOICE NO. -->
		       ,MAX(inv_mst.TAX_NO) AS tax_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) * -1
		             ELSE MAX(inv_dtl.inv_sum_amt)
		        END								AS inv_sum_amt	
			   ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		              WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		              ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END)	+ 
		        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		              WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		              ELSE MAX(jnr_dtl.pay_amt)
		        END)							AS bal_sum_amt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE MAX(jnr_dtl.pay_amt)
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             ELSE MAX(jnr_dtl.ttl_pay_amt)
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE MAX(jnr_dtl.pay_amt)
		        END								AS old_pay_amt	
		          
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       <!-- ,MAX(inv_dtl.inv_no)				AS inv_no -->
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       
				<!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
		 		 	ELSE 	  (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd)) 
	   			 END AS trdp_nm	   			 		      
		       
		       ,MAX(jnr_mst.RCVD_FM_NM)			AS rcvd_fm_nm
		       ,MAX(jnr_mst.RCVD_FM_CD)         AS rcvd_fm_cd <!-- OFVFOUR-7851: [JH LOGISTICS] TP: CARGO INTERNATIONAL (TP13613)  -->
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       <!-- //#6375 [Bug-Deposit/Payment Entry] Bank Field could be shown regardless of Use Flag -->
		       ,(SELECT bank.bank_nm FROM tb_bank bank WHERE MAX(jnr_mst.bank_seq) = bank.bank_seq) AS r_bank_nm
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(jnr_mst.level)				AS level
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE
		       
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD		 
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt		       

		       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
			   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
			   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
			   ,MAX(jnr_mst.ofc_blck_flg) AS ofc_blck_flg	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
			   ,max(jnr_mst.p_ofc_cd) as master_ofc_cd     <!-- 201601  추가  -->         
			   
			   <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
   				,(case 
   				 when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
   				 when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
   				 else MAX(TIDB.MODI_TMS) end) as   modi_tms
   				 
   			    ,MAX(jnr_dtl.POST_DT)			AS inv_xcrt_dt  <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경  MAX(jnr_mst.post_dt)>MAX(jnr_dtl.POST_DT) 변경  -->
			   <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
		        END								AS locl_ttl_amt					   
			   ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(jnr_dtl.locl_amt),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(jnr_dtl.locl_amt),0) * -1
		             ELSE MAX(jnr_dtl.locl_amt) 
		        END		 as locl_amt 

               ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(locl_bal.locl_bal_amt),0)
                     WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(locl_bal.locl_bal_amt),0) * -1
                END as locl_bal_amt


		       ,MAX(convert(float,jnr_mst.locl_amt)) as tot_locl_amt  	
			   ,MAX(convert(float,jnr_mst.locl_xcrt)) as tot_locl_xcrt	
			   <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
			   ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					   	ELSE 
					   		(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		 ELSE ''
					   		END) 
				END AS imp_ref_no  	   
			    
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_INV_DTL inv_dtl          
            	/*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
    		LEFT OUTER JOIN TB_INV inv_mst
            	ON inv_dtl.inv_seq = inv_mst.inv_seq
		    LEFT OUTER JOIN TB_FRT frt 
		     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
			LEFT OUTER JOIN TB_INTG_BL bl
		     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
			LEFT OUTER JOIN TB_OTH_SALES oth
		     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
			LEFT OUTER JOIN  TB_WM_DOC_MST wms         
            	ON frt.WMS_SEQ = wms.WM_DOC_SEQ 
			LEFT OUTER JOIN TB_ADD_INFO_BND bnd
		     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
		    LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		    	ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
		    	
		    <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->	
		    LEFT OUTER JOIN (SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK) TIDB
              ON TIDB.INV_SEQ = INV_DTL.INV_SEQ 
            LEFT OUTER JOIN (
                             select B.INV_SEQ
                                  , c.locl_ttl_amt - (sum(b.locl_amt) over(partition by b.inv_seq)) as locl_bal_amt
                                  , A.JNR_NO
                               from tb_jnr_mst a
                               join tb_jnr_dtl b
                                 on a.jnr_no = b.jnr_no
                                and a.delt_flg = b.delt_flg
                               join tb_inv_dtl c
                                 on c.inv_seq = b.inv_seq
                              where 1 = 1
                                and a.delt_flg = 'N'
                                AND b.inv_seq IN (select inv_seq from tb_jnr_dtl where jnr_no = #f_jnr_no#)
                            ) locl_bal
              ON jnr_dtl.inv_seq = locl_bal.INV_SEQ

		 WHERE jnr_mst.jnr_no = #f_jnr_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 <isNotEmpty property="f_jnr_tp">
		   AND jnr_mst.jnr_tp = #f_jnr_tp#
		 </isNotEmpty>
		   AND jnr_mst.level IN ('1','2')
		 GROUP BY jnr_dtl.JNR_SEQ
		 ) Y
    </select>
    
   
    
   
    
    <!-- 생성된 CHECK JOURNAL InvoiceList 조회  -->
    <select id="searchCHK_INV_JNR_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
        /* AccJorJournalSQL.xml > searchCHK_INV_JNR_LIST */
        SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
          FROM (
                SELECT MAX(jnr_dtl.POST_DT)            AS inv_post_dt
                      ,MAX(inv_dtl.INV_DT)             AS inv_dt
                      ,MAX(inv_dtl.INV_DUE_DT)         AS inv_due_dt
                      ,MAX(jnr_dtl.OFC_CD)             AS ofc_cd
                      ,MAX(inv_mst.INV_DEPT_CD)        AS inv_dept_cd
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
                       END                             AS inv_tp
                      ,MAX(jnr_dtl.INV_NO)             AS inv_no
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
                            WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
                            ELSE MAX(jnr_dtl.INV_NO)
                       END                             AS buy_inv_no
                      ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)           AS ref_no
                      ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)           AS bl_no
                      ,MAX(jnr_dtl.CURR_CD)            AS inv_aply_curr_cd
                      ,MAX(jnr_dtl.XCRT)               AS inv_aply_xcrt

                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt)
                            ELSE MAX(inv_dtl.inv_sum_amt)
                       END                             AS inv_sum_amt
                      ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
                            ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
                       END)    +
                       (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt)
                            ELSE MAX(jnr_dtl.pay_amt)
                       END)                            AS bal_sum_amt
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt)
                            ELSE MAX(jnr_dtl.pay_amt)
                       END                             AS pay_amt
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt)
                            ELSE MAX(jnr_dtl.ttl_pay_amt)
                       END                             AS ttl_pay_amt
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt)
                            ELSE MAX(jnr_dtl.pay_amt)
                       END                             AS old_pay_amt
                      ,MAX(jnr_dtl.GL_NO)              AS gl_no
                      ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
                      ,MAX(jnr_dtl.JNR_DESC)           AS jnr_desc
                      ,MAX(inv_dtl.inv_seq)            AS inv_seq
                      <!-- ,MAX(inv_dtl.inv_no)                AS inv_no -->
                      ,MAX(jnr_mst.trdp_cd)            AS trdp_cd

                       <!-- #3488 Accounting Multi Language 적용  -->
                       ,CASE
                           WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y'
                                THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
                           ELSE      (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
                        END AS trdp_nm

                      ,MAX(jnr_mst.RCVD_FM_NM)         AS rcvd_fm_nm
                      ,MAX(jnr_mst.payto_cd)           AS payto_cd

                       <!-- #3488 Accounting Multi Language 적용  -->
                       ,CASE
                           WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y'
                                THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
                           ELSE      (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
                        END AS payto_nm

                      ,MAX(jnr_mst.JNR_NO)             AS jnr_no
                      ,MAX(jnr_dtl.JNR_SEQ)            AS jnr_seq
                      ,MAX(jnr_mst.post_dt)            AS r_post_dt
                      ,MAX(jnr_mst.bank_seq)           AS r_bank_seq
                      <!-- //#6375 [Bug-Deposit/Payment Entry] Bank Field could be shown regardless of Use Flag -->
                      ,(SELECT bank.bank_nm FROM tb_bank bank WHERE MAX(jnr_mst.bank_seq) = bank.bank_seq) AS r_bank_nm
                      ,MAX(jnr_mst.clr_yn)             AS r_clr_yn
                      ,MAX(jnr_mst.clr_dt)             AS r_clr_dt
                      ,MAX(jnr_mst.void_yn)            AS r_void_yn
                      ,MAX(jnr_mst.void_dt)            AS r_void_dt
                      ,MAX(jnr_mst.chk_no)             AS r_chk_no
                      ,MAX(jnr_mst.amt)                AS r_amt
                      ,MAX(jnr_mst.curr_cd)            AS r_curr_cd
                      ,MAX(jnr_mst.rmk)                AS r_rmk
                      ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S'
                                THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
                                          ELSE '0'
                                     END
                            ELSE '1'
                       END                             AS clr_flag
                      ,MAX(inv_mst.sell_buy_tp_cd)     AS sell_buy_tp_cd
                      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG

                      ,MAX(jnr_dtl.INP_TYPE)           AS INP_TYPE
                      ,MAX(inv_mst.AIR_SEA_CLSS_CD)    AS AIR_SEA_CLSS_CD

                      ,MAX(jnr_mst.JNR_YN)             AS jnr_yn
                      ,MAX(jnr_mst.JNR_DT)             AS jnr_dt
                      ,MAX(jnr_mst.CLS_YN)             AS cls_yn
                      ,MAX(jnr_mst.CLS_DT)             AS cls_dt



                      ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
                      ,MAX(bl.biz_clss_cd)  as biz_clss_cd
                      ,MAX(bl.intg_bl_seq)  as intg_bl_seq
                      ,MAX(isnull(jnr_mst.chk_pnt_yn, 'N'))  as chk_pnt_yn

                      ,max(jnr_mst.p_ofc_cd) as master_ofc_cd             <!-- 201601  추가  -->


                      <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
                       ,(case
                        when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
                        when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
                        else MAX(TIDB.MODI_TMS) end) AS modi_tms

                       ,(case
                        when MAX(TJMB.MODI_TMS) IS null then MAX(jnr_mst.modi_tms)
                        when MAX(jnr_mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(jnr_mst.modi_tms)
                        else MAX(TJMB.MODI_TMS) end) AS jnr_modi_tms

                       ,MAX(jnr_dtl.POST_DT)           AS inv_xcrt_dt  <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경  MAX(jnr_mst.post_dt)>MAX(jnr_dtl.POST_DT) 변경  -->

                      <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0)
                       END                             AS locl_ttl_amt
                      ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(jnr_dtl.locl_amt),0) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(jnr_dtl.locl_amt),0)
                            ELSE MAX(jnr_dtl.locl_amt)
                       END      as locl_amt

                      ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(locl_bal.locl_bal_amt),0) * -1
                            WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(locl_bal.locl_bal_amt),0)
                       END as locl_bal_amt

                      ,MAX(convert(float,jnr_mst.locl_amt)) as tot_locl_amt
                      ,MAX(convert(float,jnr_mst.locl_xcrt)) as tot_locl_xcrt
                      <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
					  ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					   	ELSE 
					   		(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		 ELSE ''
					   		END) 
					   	END AS imp_ref_no  

          FROM TB_JNR_MST jnr_mst
          LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
              ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
          LEFT OUTER JOIN TB_INV_DTL inv_dtl
              /*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
              ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
          LEFT OUTER JOIN TB_INV inv_mst
              ON inv_dtl.inv_seq = inv_mst.inv_seq
          LEFT OUTER JOIN TB_FRT frt
              ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
          LEFT OUTER JOIN TB_INTG_BL bl
              ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
          LEFT OUTER JOIN TB_OTH_SALES oth
              ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
          LEFT OUTER JOIN TB_WM_DOC_MST wms
              ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
          LEFT OUTER JOIN TB_ADD_INFO_BND bnd
              ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
          LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK
              ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1

          <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
          LEFT OUTER JOIN (SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK) TIDB
            ON TIDB.INV_SEQ = INV_DTL.INV_SEQ

          LEFT OUTER JOIN (SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK) TJMB
            ON TJMB.JNR_NO = JNR_MST.JNR_NO

          LEFT OUTER JOIN (
                           select B.INV_SEQ
                                , c.locl_ttl_amt - (sum(b.locl_amt) over(partition by b.inv_seq)) as locl_bal_amt
                                , A.JNR_NO
                             from tb_jnr_mst a
                             join tb_jnr_dtl b
                               on a.jnr_no = b.jnr_no
                              and a.delt_flg = b.delt_flg
                             join tb_inv_dtl c
                               on c.inv_seq = b.inv_seq
                            where 1 = 1
                              and a.delt_flg = 'N'
                              AND b.inv_seq IN (select inv_seq from tb_jnr_dtl where jnr_no = #f_jnr_no#)
                          ) locl_bal
            ON jnr_dtl.inv_seq = locl_bal.INV_SEQ

         WHERE jnr_mst.jnr_no = #f_jnr_no#
           AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
           AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
         <isNotEmpty property="f_jnr_tp">
           AND jnr_mst.jnr_tp = #f_jnr_tp#
         </isNotEmpty>
           AND jnr_mst.level = '1'
         GROUP BY jnr_dtl.JNR_SEQ
         ) Y
    </select>


    <!-- 생성된 CHECK JOURNAL InvoiceList 조회 MANAGE  -->
    <select id="searchCHK_INV_JNR_LIST_MNG" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchCHK_INV_JNR_LIST_MNG */
		SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
            FROM (
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) 
		             ELSE MAX(inv_dtl.inv_sum_amt) 
		        END								AS inv_sum_amt	
			   ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END) + 
		        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END)							AS bal_sum_amt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS old_pay_amt
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       <!-- ,MAX(inv_dtl.inv_no)				AS inv_no -->
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       		       
 				<!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
		 		 	ELSE 	  (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
	   			 END AS trdp_nm
		       
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       
		        <!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
		 		 	ELSE 	  (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
	   			 END AS payto_nm 
		       
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		        <!-- //#6375 [Bug-Deposit/Payment Entry] Bank Field could be shown regardless of Use Flag -->
		       ,(SELECT bank.bank_nm FROM tb_bank bank WHERE MAX(jnr_mst.bank_seq) = bank.bank_seq) AS r_bank_nm		       
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(jnr_mst.level)				AS level
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE

		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt		       

		       
		       
		       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
			   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
			   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
			   ,MAX(isnull(jnr_mst.chk_pnt_yn, 'N'))  as chk_pnt_yn
			
			   ,MAX(jnr_mst.ofc_blck_flg) AS ofc_blck_flg	<!-- 201601  추가  -->        
			   ,max(jnr_mst.p_ofc_cd) as master_ofc_cd              <!-- 201601  추가  -->     
			   
			   
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
   				,(case 
   				 when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
   				 when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
   				 else MAX(TIDB.MODI_TMS) end)  modi_tms

   				,(case 
   				 when MAX(TJMB.MODI_TMS) IS null then MAX(jnr_mst.modi_tms)
   				 when MAX(jnr_mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(jnr_mst.modi_tms)
   				 else MAX(TJMB.MODI_TMS) end) AS jnr_modi_tms      
   				 
   				,MAX(jnr_dtl.POST_DT)			AS inv_xcrt_dt	<!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경  MAX(jnr_mst.post_dt)>MAX(jnr_dtl.POST_DT) 변경  -->
   				
			   <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) 
		        END								AS locl_ttl_amt					   
			   ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(jnr_dtl.locl_amt),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(jnr_dtl.locl_amt),0) 
		             ELSE MAX(jnr_dtl.locl_amt) 
		        END		 as locl_amt 

               ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(locl_bal.locl_bal_amt),0) * -1
                     WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(locl_bal.locl_bal_amt),0)
                END as locl_bal_amt


		       ,MAX(convert(float,jnr_mst.locl_amt)) as tot_locl_amt
			   ,MAX(convert(float,jnr_mst.locl_xcrt)) as tot_locl_xcrt
			   <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
			   ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
			    ELSE 
					(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   	  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					  ELSE ''
				     END) 
				END AS imp_ref_no  
		  FROM TB_JNR_MST jnr_mst
		  LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		    ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		  LEFT OUTER JOIN TB_INV_DTL inv_dtl          
              /*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
          LEFT OUTER JOIN TB_INV inv_mst          
            ON inv_dtl.inv_seq = inv_mst.inv_seq
		  LEFT OUTER JOIN TB_FRT frt 
		    ON inv_mst.INV_SEQ = frt.INV_SEQ
		  LEFT OUTER JOIN TB_INTG_BL bl
		    ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
		  LEFT OUTER JOIN TB_OTH_SALES oth
		    ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
	      LEFT OUTER JOIN TB_WM_DOC_MST wms
	        ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
		  LEFT OUTER JOIN TB_ADD_INFO_BND bnd
		    ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
		  LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		    ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1

		  <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		  LEFT OUTER JOIN (SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK) TIDB
            ON TIDB.INV_SEQ = INV_DTL.INV_SEQ 

		  LEFT OUTER JOIN (SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK) TJMB
            ON TJMB.JNR_NO = JNR_MST.JNR_NO

          LEFT OUTER JOIN (
                           select B.INV_SEQ
                                , c.locl_ttl_amt - (sum(b.locl_amt) over(partition by b.inv_seq)) as locl_bal_amt
                                , A.JNR_NO
                             from tb_jnr_mst a
                             join tb_jnr_dtl b
                               on a.jnr_no = b.jnr_no
                              and a.delt_flg = b.delt_flg
                             join tb_inv_dtl c
                               on c.inv_seq = b.inv_seq
                            where 1 = 1
                              and a.delt_flg = 'N'
                              AND b.inv_seq IN (select inv_seq from tb_jnr_dtl where jnr_no = #f_jnr_no#)
                          ) locl_bal
            ON jnr_dtl.inv_seq = locl_bal.INV_SEQ

		 WHERE jnr_mst.jnr_no = #f_jnr_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 <isNotEmpty property="f_jnr_tp">
		   AND jnr_mst.jnr_tp = #f_jnr_tp#
		 </isNotEmpty>
		   AND jnr_mst.level IN ('1','2')
		 GROUP BY jnr_dtl.JNR_SEQ
		 ) Y
    </select>
    
    
    
    <!-- 생성된 CHECK JOURNAL InvoiceList 조회  MANAGE2   -->
    <select id="searchCHK_INV_JNR_LIST_MNG2" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchCHK_INV_JNR_LIST_MNG2 */
		SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
            FROM (
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) 
		             ELSE MAX(inv_dtl.inv_sum_amt) 
		        END								AS inv_sum_amt	
			   ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END) +
		        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END)							AS bal_sum_amt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS old_pay_amt
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       <!-- ,MAX(inv_dtl.inv_no)				AS inv_no -->
		       
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       
		        <!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
		 		 	ELSE 	  (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd))
	   			 END AS trdp_nm
		       
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       
		        <!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT locl_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
		 		 	ELSE 	  (SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd))
	   			 END AS payto_nm 		
	   			 		       
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       <!-- //#6375 [Bug-Deposit/Payment Entry] Bank Field could be shown regardless of Use Flag -->
		       ,(SELECT bank.bank_nm FROM tb_bank bank WHERE MAX(jnr_mst.bank_seq) = bank.bank_seq) AS r_bank_nm
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(jnr_mst.level)				AS level
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE

		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt			       

		        
		       
		       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
			   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
			   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
			   ,MAX(isnull(jnr_mst.chk_pnt_yn, 'N'))  as chk_pnt_yn
			   
			   ,MAX(jnr_mst.ofc_blck_flg) AS ofc_blck_flg	<!-- 201601  추가  -->        
			   ,max(jnr_mst.p_ofc_cd) as master_ofc_cd           <!-- 201601  추가  -->   
			   
			   
			   
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 --> 
   				,(case 
   				 when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
   				 when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
   				 else MAX(TIDB.MODI_TMS) end)  modi_tms

   				,(case 
   				 when MAX(TJMB.MODI_TMS) IS null then MAX(jnr_mst.modi_tms)
   				 when MAX(jnr_mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(jnr_mst.modi_tms)
   				 else MAX(TJMB.MODI_TMS) end) AS jnr_modi_tms      
			   
			    ,MAX(jnr_dtl.POST_DT)			AS inv_xcrt_dt <!-- #1617 [CLT] Depsosit/Payment Entry - Ex.Rate Date 정의 기준변경  MAX(jnr_mst.post_dt)>MAX(jnr_dtl.POST_DT) 변경  -->
			    
			   <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.LOCL_TTL_AMT),0) 
		        END								AS locl_ttl_amt					   
			   ,MAX(inv_dtl.LOCL_XCRT) as locl_xcrt
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(jnr_dtl.locl_amt),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(jnr_dtl.locl_amt),0) 
		             ELSE MAX(jnr_dtl.locl_amt) 
		        END		 as locl_amt 

               ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(locl_bal.locl_bal_amt),0) * -1
                     WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(locl_bal.locl_bal_amt),0)
                END as locl_bal_amt

		       ,MAX(convert(float,jnr_mst.locl_amt)) as tot_locl_amt
			   ,MAX(convert(float,jnr_mst.locl_xcrt)) as tot_locl_xcrt
			   <!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
				,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
				 ELSE 
					(CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   	  WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					  ELSE ''
					 END) 
				  END AS imp_ref_no  

		  FROM TB_JNR_MST jnr_mst
		  LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		    ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		  LEFT OUTER JOIN TB_INV_DTL inv_dtl          
               /*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
    	  LEFT OUTER JOIN TB_INV inv_mst          
            ON inv_dtl.inv_seq = inv_mst.inv_seq
		  LEFT OUTER JOIN TB_FRT frt 
		    ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
		  LEFT OUTER JOIN TB_INTG_BL bl
		    ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
		  LEFT OUTER JOIN TB_OTH_SALES oth
		    ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
	      LEFT OUTER JOIN TB_WM_DOC_MST wms
	   		ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
		  LEFT OUTER JOIN TB_ADD_INFO_BND bnd
		    ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
		  LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		    ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1

		  <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		  LEFT OUTER JOIN (SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK) TIDB
		    ON TIDB.INV_SEQ = INV_DTL.INV_SEQ 

		  LEFT OUTER JOIN (SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK) TJMB
		    ON TJMB.JNR_NO = JNR_MST.JNR_NO 

          LEFT OUTER JOIN (
                           select B.INV_SEQ
                                , c.locl_ttl_amt - (sum(b.locl_amt) over(partition by b.inv_seq)) as locl_bal_amt
                                , A.JNR_NO
                             from tb_jnr_mst a
                             join tb_jnr_dtl b
                               on a.jnr_no = b.jnr_no
                              and a.delt_flg = b.delt_flg
                             join tb_inv_dtl c
                               on c.inv_seq = b.inv_seq
                            where 1 = 1
                              and a.delt_flg = 'N'
                              AND b.inv_seq IN (select inv_seq from tb_jnr_dtl where jnr_no = #f_jnr_no#)
                          ) locl_bal
            ON jnr_dtl.inv_seq = locl_bal.INV_SEQ

		 WHERE jnr_mst.jnr_no = #f_jnr_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 <isNotEmpty property="f_jnr_tp">
		   AND jnr_mst.jnr_tp = #f_jnr_tp#
		 </isNotEmpty>
		   AND jnr_mst.level IN ('1','2','3')
		 GROUP BY jnr_dtl.JNR_SEQ
		 ) Y
    </select>
    
    <!-- Journal Master PK생성   -->
    <select id="selectJNR_MST_SEQ_MAX" parameterClass="java.util.HashMap" resultClass="String">
        SELECT  isnull(max(jnr_no)+1, 1)
          FROM  tb_jnr_mst
    </select>
    
    
    <!-- Journal Detail PK생성   -->
    <select id="selectJNR_DTL_SEQ_MAX" parameterClass="java.util.HashMap" resultClass="String">
        SELECT  isnull(max(jnr_seq)+1, 1)
          FROM  tb_jnr_dtl
         WHERE  jnr_no = #jnr_no#
    </select>
    
    <!-- Journal Master 정보를 INSERT 한다.   -->
    <insert id="insertJournalMst" parameterClass="JournalVO">
    	INSERT INTO tb_jnr_mst(
			 jnr_no
			,jnr_tp
			,post_dt
			,trdp_cd
			,payto_cd
			,rcvd_fm_cd<!-- OFVFOUR-7851: [JH LOGISTICS] TP: CARGO INTERNATIONAL (TP13613) -->
			,rcvd_fm_nm
			,bank_seq
			,clr_yn
			,clr_dt
			,void_yn
			,void_dt
			,chk_no
			,chk_pnt_yn
			,chk_pnt_dt
			,chk_pnt_usrid
			,amt
			,curr_cd
			,level
			,rmk
			,delt_flg
			,slip_no
			,p_ofc_cd
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
			,ofc_blck_flg
			,grp_slip_no
			,vchr_tp_cd
			,vchr_no
			,rcv_tp_cd
			<!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			,locl_xcrt
			,locl_amt
		)VALUES(
			 #jnr_no#
			,#jnr_tp#
			,#post_dt#
			,#trdp_cd#
			,#payto_cd#
			,#rcvd_fm_cd#
			,#rcvd_fm_nm#
			,#bank_seq#
			,#clr_yn#
			,#clr_dt#
			,#void_yn#
			,#void_dt#
			,#chk_no#
			,#chk_pnt_yn#
			,#chk_pnt_dt#
			,#chk_pnt_usrid#
			,isnull(#amt#, 0)
			,#curr_cd#
			,#level#
			<!-- #3102 [IMPEX] AFTER V450, PAYMENT REMARK 소문자/대문자 입력 구분 필요 -->
			,upper(#rmk#)
			,'N'
			,#slip_no#
			,#p_ofc_cd#
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
			,#ofc_blck_flg#
			,#grp_slip_no#
			,#vchr_tp_cd#
			,#vchr_no#
			,#rcv_tp_cd#
			<!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			,CASE WHEN #locl_xcrt# = '' then 0 else convert(float,#locl_xcrt#) end  
			,CASE WHEN #locl_amt# = '' then 0 else convert(float,#locl_amt#) end     			
		)
    </insert>
    
    
    <!-- Journal Detail 정보를 INSERT 한다.   -->
    <insert id="insertJournalDtl" parameterClass="InvJorVO">
    	INSERT INTO tb_jnr_dtl(
			 jnr_no
			,jnr_seq
			,inv_no
			,inv_seq
			,ofc_cd
			,post_dt
			,gl_no
			,ref_no
			,bl_no
			,jnr_desc
			,curr_cd
			,xcrt
			,pay_amt
			,ttl_pay_amt
			,inp_type
			,p_ofc_cd
			,delt_flg
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
			,sls_usrid
			<!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			,locl_amt
		)VALUES(
			 #jnr_no#
			,#jnr_seq#
			,#inv_no#
			,#inv_seq#
			,#ofc_cd#
			,#inv_post_dt#
			,#gl_no#
			,#ref_no#
			,#bl_no#
			,#jnr_desc#
			,#inv_aply_curr_cd#
			,#inv_aply_xcrt#
			,#pay_amt#
			,#ttl_pay_amt#
			,#inp_type#
			,#p_ofc_cd#
			,'N'
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
			,#sls_usrid#
			<!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			,CASE WHEN #locl_amt# = '' then 0 else convert(float,#locl_amt#) end   			
		)
    
    
    </insert>
    
    <!-- JOURNAL MASTER UPDATE   -->
    <update id="updateJournalMst" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET post_dt 		= #post_dt#
    	      ,bank_seq 	= #bank_seq#
    	      ,clr_yn		= #clr_yn#
    	      ,clr_dt		= #clr_dt#
    	      ,void_yn		= #void_yn#
    	      ,void_dt		= #void_dt#
    	      ,chk_no		= #chk_no#
    	      ,amt			= isnull(#amt#, 0)
    	      ,curr_cd		= #curr_cd#
    	      ,rmk			= UPPER(#rmk#)
    	      ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
    	WHERE jnr_no = #jnr_no#
    </update>
    
    <!-- JOURNAL MASTER UPDATE   -->
    <!-- jsjang 2013.9.5 #20755  : [GPL]Deposit Journal Update Error modify -->
    <update id="updateJournalMst_Manage" parameterClass="JournalVO">
    	/* updateJournalMst_Manage */
    	UPDATE TB_JNR_MST
    	   SET post_dt 		= #post_dt#
    	   	  ,trdp_cd 	= #trdp_cd#
    	      ,bank_seq 	= #bank_seq#
    	      ,clr_yn		= #clr_yn#
    	      ,clr_dt		= #clr_dt#
    	      ,void_yn		= #void_yn#
    	      ,void_dt		= #void_dt#
    	      ,chk_no		= #chk_no#
    	      ,amt			= isnull(#amt#, 0)
    	      ,curr_cd		= #curr_cd#
    	      <!-- #3102 [IMPEX] AFTER V450, PAYMENT REMARK 소문자/대문자 입력 구분 필요 -->
    	      ,rmk			= upper(#rmk#)
    	      ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			 <isNotEmpty property="rcvd_fm_nm">
			 	<isNotEmpty property="rcvd_fm_nm">
			 		,rcvd_fm_nm   = #rcvd_fm_nm#
			 	</isNotEmpty>
			 </isNotEmpty>	
			 <isNotEmpty property="rcvd_fm_cd">
			 	,rcvd_fm_cd   = #rcvd_fm_cd#
			 </isNotEmpty>
			 <isNotEmpty property="payto_cd">
			 	<isNotEmpty property="payto_cd">
			 		,payto_cd   = #payto_cd#
			 	</isNotEmpty>
			 </isNotEmpty>	
			  ,modi_tms		= GETUTCDATE()
			  ,p_ofc_cd		= #p_ofc_cd#
			  ,vchr_tp_cd	= #vchr_tp_cd#
			  ,vchr_no		= #vchr_no#
			  ,rcv_tp_cd	= #rcv_tp_cd#
			  <!-- #3505_ [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			  ,locl_xcrt    = CASE WHEN #locl_xcrt# = '' then 0 else convert(float,#locl_xcrt#) end  
			  ,locl_amt     = CASE WHEN #locl_amt# = '' then 0 else convert(float,#locl_amt#) end         			  
			  
    	WHERE jnr_no = #jnr_no#
    </update>    
    
    
    <!-- JOURNAL MASTER UPDATE   -->
    <update id="updateJournalMst_Mng" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET post_dt 		= #post_dt#
    	      ,bank_seq 	= #bank_seq#
    	      ,clr_yn		= #clr_yn#
    	      ,clr_dt		= #clr_dt#
    	      ,void_yn		= #void_yn#
    	      ,void_dt		= #void_dt#
    	      ,chk_no		= #chk_no#
    	      ,amt			= isnull(#amt#, 0)
    	      ,curr_cd		= #curr_cd#
    	      ,rmk			= UPPER(#rmk#)
    	      ,level		= #level#
    	      ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
    	WHERE jnr_no = #jnr_no#
    </update>
    
    <!-- JOURNAL MASTER UPDATE   -->
    <!-- jsjang 2013.9.5 #20755  : [GPL]Deposit Journal Update Error modify -->
    <update id="updateJournalMst_Mng_Manage" parameterClass="JournalVO">
    	/* updateJournalMst_Mng_Manage */
    	UPDATE TB_JNR_MST
    	   SET post_dt 		= #post_dt#
    	      ,trdp_cd 	= #trdp_cd#
    	      ,bank_seq 	= #bank_seq#
    	      ,clr_yn		= #clr_yn#
    	      ,clr_dt		= #clr_dt#
    	      ,void_yn		= #void_yn#
    	      ,void_dt		= #void_dt#
    	      ,chk_no		= #chk_no#
    	      ,amt			= isnull(#amt#, 0)
    	      ,curr_cd		= #curr_cd#
    	      ,rmk			= UPPER(#rmk#)
    	      ,level		= #level#
    	      ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,ofc_blck_flg	= #ofc_blck_flg#
			 <isNotEmpty property="rcvd_fm_nm">
			 	<isNotEmpty property="rcvd_fm_nm">
			 		,rcvd_fm_nm   = #rcvd_fm_nm#
			 	</isNotEmpty>
			 </isNotEmpty>	
			 <isNotEmpty property="rcvd_fm_nm">
			 	,rcvd_fm_cd   = #rcvd_fm_cd#
			 </isNotEmpty>
			 
			 <isNotEmpty property="payto_cd">
			 	<isNotEmpty property="payto_cd">
			 		,payto_cd   = #payto_cd#
			 	</isNotEmpty>
			 </isNotEmpty>	
			  ,modi_tms		= GETUTCDATE()
			  ,p_ofc_cd		= #p_ofc_cd#
			  
			  <!-- #3505_ [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			  ,locl_xcrt    = CASE WHEN #locl_xcrt# = '' then 0 else convert(float,#locl_xcrt#) end  
			  ,locl_amt     = CASE WHEN #locl_amt# = '' then 0 else convert(float,#locl_amt#) end          			  
			  			  
    	WHERE jnr_no = #jnr_no#
    </update>    
    
    <!-- Journal Detail 정보를 UPADTE 한다.   -->
    <update id="updateJournalDtl" parameterClass="InvJorVO">
    	UPDATE TB_JNR_DTL
    	   SET pay_amt		= #pay_amt#
			  ,ttl_pay_amt	= #ttl_pay_amt#
			  ,ref_no		= #ref_no#
			  ,ofc_cd		= #ofc_cd#
			  ,post_dt		= #inv_post_dt#
			  ,gl_no		= #gl_no#
			  ,jnr_desc		= #jnr_desc#
			  ,xcrt			= #inv_aply_xcrt#
			  ,inv_no       = #inv_no#
			  ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
			  ,p_ofc_cd		= #p_ofc_cd#
			  ,sls_usrid	= #sls_usrid#
			  <!-- #3505 [JTC]ACCT - Local Currency 금액 환산 & SLIP 반영 -->
			  ,locl_amt     = CASE WHEN #locl_amt# = '' then 0 else convert(float,#locl_amt#) end     
		 WHERE jnr_no = #jnr_no#
		   AND jnr_seq = #jnr_seq#
    </update>
    
    
    <!-- Journal Detail 정보를 DELETE 한다.   -->
    <update id="deleteJournalDtl_DEL" parameterClass="InvJorVO">
    	<!--  
    	DELETE FROM TB_JNR_DTL
		 WHERE jnr_no = #jnr_no#
		   AND jnr_seq = #jnr_seq#
		  -->
		UPDATE TB_JNR_DTL
		   SET DELT_FLG = 'Y'
		      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
		      ,p_ofc_cd		= #p_ofc_cd#
		 WHERE jnr_no = #jnr_no#
		   AND jnr_seq = #jnr_seq# 
    </update>
    
    
    <!-- Journal Detail_ALL 정보를 DELETE 한다.   -->
    <update id="deleteJournalDtl_ALL" parameterClass="java.util.HashMap">
    	<!--  
    	DELETE FROM TB_JNR_DTL
		 WHERE jnr_no = #jnr_no#
		  -->
		UPDATE TB_JNR_DTL
		   SET DELT_FLG = 'Y' 
		      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
		 WHERE jnr_no = #jnr_no# 
    </update>
    
    
    <!-- 인보이스 별 G/L No 조회  -->
    <select id="searchINV_GLNO" parameterClass="java.util.HashMap" resultClass="String">
    	SELECT CASE WHEN #inv_tp# = 'A/R'  THEN GL_AR
		            WHEN #inv_tp# = 'A/P'    THEN GL_AP
					WHEN #inv_tp# = 'CREDIT' THEN GL_AGENT_AR
					WHEN #inv_tp# = 'DEBIT'  THEN GL_AGENT_AR
			   END GL_NO
		  FROM TB_OFC
		 WHERE OFC_CD = #inv_ofc_cd#
    </select>
    
    <!-- 인보이스 별 CLEAR G/L No 조회  -->
    <select id="searchINV_CLR_GLNO" parameterClass="java.util.HashMap" resultClass="String">
    	SELECT CASE WHEN #clr_gl# = 'EL' THEN GL_EX_LOSS
		            WHEN #clr_gl# = 'ML' THEN GL_MISC_LOSS
					WHEN #clr_gl# = 'EP' THEN GL_EX_PROFIT
					WHEN #clr_gl# = 'MP' THEN GL_MISC_PROFIT
			   END GL_NO
		  FROM TB_OFC
		 WHERE OFC_CD = #inv_ofc_cd#
    </select>
    
    
    
    <!-- Journal Detail 정보를 UPDATE 한다.   -->
    <update id="upateInvDtl" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) + #pay_amt#
		      ,PAY_FRGN_AMT = isnull(pay_frgn_amt,0) + #pay_frgn_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) - #pay_amt#
		      ,BAL_FRGN_AMT = isnull(bal_frgn_amt,0) - #bal_frgn_amt#
		      ,LAST_PAY_DT  = #post_dt#
		      ,LAST_CHK_NO  = #last_chk_no#
			  ,modi_tms		= GETUTCDATE()
			    
		 WHERE inv_seq = #inv_seq#
    </update>
    
    
    
    <!-- Journal Detail 정보를 UPDATE 한다.   -->
    <update id="deleteInvDtl_DEL" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #pay_amt#
		      ,PAY_FRGN_AMT = isnull(pay_frgn_amt,0) - #pay_frgn_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #pay_amt#
		      ,BAL_FRGN_AMT = isnull(bal_frgn_amt,0) + #bal_frgn_amt#
		      ,LAST_PAY_DT  = null
		      ,LAST_CHK_NO  = null
			    ,modi_tms			= GETUTCDATE()
		 WHERE  inv_seq = #inv_seq#
    </update>
    
    
    <!-- Journal Detail 정보를 UPDATE 한다. VOID CHECK 용  -->
    <update id="upateInvDtlVoidCheck" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #pay_amt#
		      ,PAY_FRGN_AMT = isnull(pay_frgn_amt,0) - #pay_frgn_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #pay_amt#
		      ,BAL_FRGN_AMT = isnull(bal_frgn_amt,0) + #bal_frgn_amt#
			    ,modi_tms			= GETUTCDATE()
		 WHERE inv_seq = #inv_seq#
    </update>
    
    
    <!-- Invoice Detail 정보를 UPDATE 한다. VOID CHECK 용 JOURNAL DELETE(부분삭제)  -->
    <update id="deleteInvDtlVoidCheck" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #pay_amt#
		      ,PAY_FRGN_AMT = isnull(pay_frgn_amt,0) - #pay_frgn_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #pay_amt#
		      ,BAL_FRGN_AMT = isnull(bal_frgn_amt,0) + #bal_frgn_amt#
		      ,LAST_PAY_DT  = null
		      ,LAST_CHK_NO  = null
			    ,modi_tms			= GETUTCDATE()
		 WHERE inv_seq = #inv_seq#
    </update>
    
    
    <!-- Journal Detail 정보를 UPDATE 한다. VOID CHECK 후 DELETE 함  -->
    <update id="upateInvDtlInvSts" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,LAST_PAY_DT  = null
		      ,LAST_CHK_NO  = null
			    ,modi_tms			= GETUTCDATE()
		 WHERE inv_seq = #inv_seq#
    </update>
    
    
    <!-- TB_TRDP CUR_LMT_AMT 금액을 UPDATE 한다.   -->
    <update id="upateTrdpCurLmtAmt" parameterClass="InvJorVO">
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = isnull(cur_lmt_amt,0) - #cur_lmt_amt#
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    <!-- TB_TRDP CUR_LMT_AMT 금액을 UPDATE 한다. VOID CHECK 용  -->
    <update id="upateTrdpCurLmtAmtVoidCheck" parameterClass="InvJorVO">
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = isnull(cur_lmt_amt,0) + #cur_lmt_amt#
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    
    <!-- TB_TRDP CUR_LMT_AMT 금액을 ADD 한다.   -->
    <update id="upateTrdpCurLmtAmtAdd" parameterClass="InvJorVO">
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = isnull(cur_lmt_amt,0) + #cur_lmt_amt#
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    <!-- TB_TRDP CUR_LMT_AMT 금액을 DELETE 한다.   -->
    <update id="upateTrdpCurLmtAmtDelete" parameterClass="InvJorVO">
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = isnull(cur_lmt_amt,0) - #cur_lmt_amt#
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    <!-- #  : cur_amt 로직 변경 / replication Error 처리    -->
    <update id="updateTrdpCurAmt" parameterClass="String" >
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = (
					    	SELECT SUM(ISNULL(D.BAL_AMT, 0)) AS CUR_AMT 
							  FROM TB_INV_DTL D 
							  LEFT OUTER JOIN TB_INV M ON D.INV_SEQ = M.INV_SEQ 
							   AND ISNULL(M.DELT_FLG, '') != 'Y' 
							 WHERE D.DELT_FLG = 'N' 
							   AND M.SELL_BUY_TP_CD IN ('S', 'D') 
							   AND M.DELT_FLG = 'N' 
							   AND M.TRDP_CD = #trdp_cd#
							)
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    <!-- JOURNAL DETAIL DELETE   -->
    <update id="deleteJournalDtl" parameterClass="java.util.HashMap">
    	UPDATE tb_jnr_dtl
    	   SET delt_flg = 'Y'
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE jnr_no = #jnr_no#
    </update>
    
    
    <!-- JOURNAL MASTER DELETE   -->
    <update id="deleteJournalMst" parameterClass="java.util.HashMap">
    	UPDATE tb_jnr_mst
    	   SET delt_flg = 'Y'
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE jnr_no = #jnr_no# 
    </update>
    
    
    
    <!-- Deposit Journal List 조회  -->
    <select id="searchJNR_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchJNR_LIST */
    	<!-- 
    	SELECT mst.post_dt
		      ,mst.rcvd_fm_nm
		      ,mst.chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE mst.bank_seq = bk.bank_seq) AS bank_seq
		      ,mst.amt
		      ,mst.curr_cd
		      ,mst.clr_dt
		      ,mst.void_yn
		      ,mst.void_dt
		      ,mst.p_ofc_cd
		      ,mst.rgst_usrid
		      ,mst.jnr_no
		      ,mst.trdp_cd
		  FROM TB_JNR_MST mst
		 WHERE mst.DELT_FLG = 'N'
		   AND JNR_TP = 'D'
		   AND LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		 	AND mst.RCVD_FM_NM LIKE '%' + #s_rcv_from_nm# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO = #s_chk_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
	  ORDER BY mst.post_dt desc, mst.jnr_no desc	
    	   -->
    select * from (
    	SELECT MAX(mst.post_dt)		AS post_dt
		      ,MAX(mst.rcvd_fm_nm)	AS rcvd_fm_nm
		      ,MAX(mst.chk_no)		AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)			AS amt
		      ,MAX(mst.curr_cd)		AS curr_cd
		      ,MAX(mst.clr_yn)		AS clr_yn
		      ,MAX(mst.clr_dt)		AS clr_dt
		      ,MAX(mst.void_yn)		AS void_yn
		      ,MAX(mst.void_dt)		AS void_dt
		      ,MAX(mst.p_ofc_cd)	AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)	AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)		AS trdp_cd
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)		AS ref_no
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
			  ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. Deposit List remark 삽입 -->
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  
			  ,MAX(mst.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		        ,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms      			  
			  ,MAX(inv_dtl.slip_no) 							 AS slip_no  
			  ,MAX(TJMB.bloked_by) 								 AS bloked_by
			  ,MAX(issued_usr.locl_usr_nm) 						 AS issued_by
			  ,MAX(TJMB.block_dt) 								 AS block_dt
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc,     MAX(mst.post_dt) desc,     mst.jnr_no desc) as ROWNUM
			  </isEmpty>
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
			  ,COUNT(*) OVER() tot_cnt
			  <!-- 6486 [Zencon] Upload email  (Zen#2608) -->	
			  ,CASE WHEN EXISTS(
				SELECT 	palt_doc_seq 
				FROM TB_PALT_SHP_DOC 
				WHERE  intg_bl_seq = MAX(mst.jnr_no)
				AND  palt_mnu_cd = 'DPS'
				)
				THEN 'O'
				ELSE 'X'
				END AS file_exists
			  
			FROM TB_JNR_MST mst
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN TB_OTH_SALES oth 
			ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
			
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT 
			 jmb.MODI_TMS
			,jmb.JNR_NO 
			,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN 
				blcked_usr.LOCL_USR_NM
                ELSE '' END AS BLOKED_BY
            ,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN
		     	ISNULL(CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.BLOCK_DT), 110), CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.MODI_TMS), 110))
		     ELSE '' END AS BLOCK_DT
		FROM TB_JNR_MST_BLCK   jmb
		LEFT OUTER JOIN tb_usr blcked_usr
			 ON jmb.rgst_usrid = blcked_usr.usrid   
		) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr
			ON mst.RGST_USRID = issued_usr.USRID 	
			
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND JNR_TP = 'D'
		   AND LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>		 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
 
	) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
    </select>
    
    <!-- Deposit Journal List 조회  -->  <!-- #2374 [LBS] Deposit/Payment List 에 Excel (All) 버튼 추가 -->
    <select id="searchJNR_LIST_EXCEL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > searchJNR_LIST_EXCEL */
    select (case when a1.post_dt = '' THEN '' when ISNULL(a1.post_dt,'') = '' then '' else substring(a1.post_dt,5,2)  + '-' +substring(a1.post_dt,7,2) + '-' +substring(a1.post_dt,1,4)END) as post_dt
		      ,a1.rcvd_fm_nm
		      ,a1.chk_no
		      ,a1.bank_seq
		      ,a1.amt
		      ,a1.curr_cd
		      ,a1.clr_yn
		      ,(case when a1.clr_dt = '' THEN '' when ISNULL(a1.clr_dt,'') = '' then '' else substring(a1.clr_dt,5,2)  + '-' +substring(a1.clr_dt,7,2) + '-' +substring(a1.clr_dt,1,4)END) as clr_dt
		      ,a1.void_yn
		      ,(case when a1.void_dt = '' THEN '' when ISNULL(a1.void_dt,'') = '' then '' else substring(a1.void_dt,5,2)  + '-' +substring(a1.void_dt,7,2) + '-' +substring(a1.void_dt,1,4)END) as void_dt
		      ,a1.p_ofc_cd
		      ,a1.rgst_usrid
		      ,a1.jnr_no
		      ,a1.trdp_cd
		      ,a1.hbl_no
		      ,a1.mbl_no
			  ,a1.ref_no
			  ,a1.clt_cmpl_flg
			  ,a1.rmk
			  ,a1.oth_ref_no
			  ,CONVERT(varchar(10), a1.modi_tms, 110) + ' ' + CONVERT(varchar(5), a1.modi_tms, 108) as modi_tms
			  ,CONVERT(varchar(10), a1.trx_modi_tms, 110) + ' ' + CONVERT(varchar(5), a1.trx_modi_tms, 108) as trx_modi_tms	    			  
			  ,a1.slip_no  
			  ,a1.bloked_by
			  ,a1.issued_by
			  ,a1.block_dt
			  ,a1.ROWNUM
	 from (
    	SELECT MAX(mst.post_dt)		AS post_dt
		      ,MAX(mst.rcvd_fm_nm)	AS rcvd_fm_nm
		      ,MAX(mst.chk_no)		AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)			AS amt
		      ,MAX(mst.curr_cd)		AS curr_cd
		      ,MAX(mst.clr_yn)		AS clr_yn
		      ,MAX(mst.clr_dt)		AS clr_dt
		      ,MAX(mst.void_yn)		AS void_yn
		      ,MAX(mst.void_dt)		AS void_dt
		      ,MAX(mst.p_ofc_cd)	AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)	AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)		AS trdp_cd
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)		AS ref_no
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS clt_cmpl_flg
			  ,MAX(mst.rmk) AS rmk	<!-- 20150709 추가. Deposit List remark 삽입 -->
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  
			  ,MAX(mst.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		        ,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms      			  
			  ,MAX(inv_dtl.slip_no) 							 AS slip_no  
			  ,MAX(TJMB.bloked_by) 								 AS bloked_by
			  ,MAX(issued_usr.locl_usr_nm) 						 AS issued_by
			  ,MAX(TJMB.block_dt) 								 AS block_dt
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc,     MAX(mst.post_dt) desc,     mst.jnr_no desc) as ROWNUM
			  </isEmpty>
			FROM TB_JNR_MST mst
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN TB_OTH_SALES oth 
			ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
			
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT 
			 jmb.MODI_TMS
			,jmb.JNR_NO 
			,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN 
				blcked_usr.LOCL_USR_NM
                ELSE '' END AS BLOKED_BY
            ,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN
		     	ISNULL(CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.BLOCK_DT), 110), CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.MODI_TMS), 110))
		     ELSE '' END AS BLOCK_DT
		FROM TB_JNR_MST_BLCK   jmb
		LEFT OUTER JOIN tb_usr blcked_usr
			 ON jmb.rgst_usrid = blcked_usr.usrid   
		) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr
			ON mst.RGST_USRID = issued_usr.USRID 	
			
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND JNR_TP = 'D'
		   AND LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )		                
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>		 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
 
	) a1
    </select>
    
    <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
	<select id="searchJNR_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
    select count(*) from (
    	SELECT MAX(mst.post_dt)		AS post_dt
		      ,MAX(mst.rcvd_fm_nm)	AS rcvd_fm_nm
		      ,MAX(mst.chk_no)		AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)			AS amt
		      ,MAX(mst.curr_cd)		AS curr_cd
		      ,MAX(mst.clr_yn)		AS clr_yn
		      ,MAX(mst.clr_dt)		AS clr_dt
		      ,MAX(mst.void_yn)		AS void_yn
		      ,MAX(mst.void_dt)		AS void_dt
		      ,MAX(mst.p_ofc_cd)	AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)	AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)		AS trdp_cd
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)		AS ref_no
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
			  ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. Deposit List remark 삽입 -->
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  
			  ,MAX(mst.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		        ,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms      			  
			  ,MAX(inv_dtl.slip_no) 							 AS slip_no  
			  ,MAX(TJMB.bloked_by) 								 AS bloked_by
			  ,MAX(issued_usr.locl_usr_nm) 						 AS issued_by
			  ,MAX(TJMB.block_dt) 								 AS block_dt
			FROM TB_JNR_MST mst
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN TB_OTH_SALES oth 
			ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
			
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT 
			 jmb.MODI_TMS
			,jmb.JNR_NO 
			,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN 
				blcked_usr.LOCL_USR_NM
                ELSE '' END AS BLOKED_BY
            ,CASE WHEN jmb.CLT_CMPL_FLG = 'Y' THEN
		     	ISNULL(CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.BLOCK_DT), 110), CONVERT(VARCHAR(23), CONVERT(DATETIME, jmb.MODI_TMS), 110))
		     ELSE '' END AS BLOCK_DT
		FROM TB_JNR_MST_BLCK   jmb
		LEFT OUTER JOIN tb_usr blcked_usr
			 ON jmb.rgst_usrid = blcked_usr.usrid   
		) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr
			ON mst.RGST_USRID = issued_usr.USRID 	
			
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND JNR_TP = 'D'
		   AND LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>		 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
 
	) a1
	</select>    
    
    
    <!-- Deposit Journal List 조회 MANAGE  -->
    <select id="searchJNR_LIST_MNG" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchJNR_LIST_MNG */
		select * from(
    	SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)				AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END AS block
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)		AS ref_no -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. Deposit Lv2 List remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      
		       ,MAX(mst.modi_tms) AS MODI_TMS
						       
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  <!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->			       
		      ,MAX(inv_dtl.slip_no)         AS slip_no        
		      ,MAX(TJMB.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)        AS issued_by      
		      ,MAX(TJMB.block_dt)          AS block_dt  
		      
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, mst.jnr_no desc) as ROWNUM
			  </isEmpty>		
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
			  ,COUNT(*) OVER() tot_cnt
			  <!-- 6486 [Zencon] Upload email  (Zen#2608) -->	
			  ,CASE WHEN EXISTS(
				SELECT 	palt_doc_seq 
				FROM TB_PALT_SHP_DOC 
				WHERE  intg_bl_seq = MAX(mst.jnr_no)
				AND  palt_mnu_cd = 'DPS'
				)
				THEN 'O'
				ELSE 'X'
				END AS file_exists
			  			  	      
		  FROM TB_JNR_MST mst
		  LEFT JOIN TB_JNR_DTL dtl 
				ON mst.JNR_NO = dtl.JNR_NO	
		  LEFT JOIN TB_INV_DTL inv_dtl 
				ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		<!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->
		LEFT OUTER JOIN
        (
            SELECT
                jmb.MODI_TMS    ,
                jmb.JNR_NO     ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
            ) TJMB           
                ON TJMB.JNR_NO = MST.JNR_NO    
        LEFT OUTER JOIN
            TB_USR issued_usr    
                ON mst.RGST_USRID = issued_usr.USRID    
				  	
		<!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N' -->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND JNR_TP = 'D'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )		                
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.level = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND LEVEL  IN('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!--#5634 [Great Luck] To be able to search by Remark on Deposit, Payment List  -->
		  <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
	) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>	
				  
    </select>
    
    
    <!-- #2374 [LBS] Deposit/Payment List 에 Excel (All) 버튼 추가 -->
    <select id="searchJNR_LIST_MNG_EXCEL" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchJNR_LIST_MNG_EXCEL */
		select * from(
    	SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)				AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END AS block
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS clt_cmpl_flg
		      ,MAX(mst.rmk) AS rmk	<!-- 20150709 추가. Deposit Lv2 List remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      
		       ,MAX(mst.modi_tms) AS MODI_TMS
						       
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  <!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->			       
		      ,MAX(inv_dtl.slip_no)         AS slip_no        
		      ,MAX(TJMB.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)        AS issued_by      
		      ,MAX(TJMB.block_dt)          AS block_dt  
		      
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, mst.jnr_no desc) as ROWNUM
			  </isEmpty>			      
		  FROM TB_JNR_MST mst
		  LEFT JOIN TB_JNR_DTL dtl 
				ON mst.JNR_NO = dtl.JNR_NO	
		  LEFT JOIN TB_INV_DTL inv_dtl 
				ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		<!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->
		LEFT OUTER JOIN
        (
            SELECT
                jmb.MODI_TMS    ,
                jmb.JNR_NO     ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
            ) TJMB           
                ON TJMB.JNR_NO = MST.JNR_NO    
        LEFT OUTER JOIN
            TB_USR issued_usr    
                ON mst.RGST_USRID = issued_usr.USRID    
				  	
		<!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N' -->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND JNR_TP = 'D'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )		                
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.level = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND LEVEL  IN('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
	) a1
    </select>
    
    <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
	<select id="searchJNR_LIST_MNG_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
		/* AccJorJournalSQL.xml > searchJNR_LIST_MNG_CNT */
		select count(*) from(
    	SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE MAX(mst.bank_seq) = bk.bank_seq) AS bank_seq
		      ,MAX(mst.amt)				AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,mst.jnr_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END AS block
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)		AS ref_no -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. Deposit Lv2 List remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      
		       ,MAX(mst.modi_tms) AS MODI_TMS
						       
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  <!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->			       
		      ,MAX(inv_dtl.slip_no)         AS slip_no        
		      ,MAX(TJMB.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)        AS issued_by      
		      ,MAX(TJMB.block_dt)          AS block_dt  
		      
		  FROM TB_JNR_MST mst
		  LEFT JOIN TB_JNR_DTL dtl 
				ON mst.JNR_NO = dtl.JNR_NO	
		  LEFT JOIN TB_INV_DTL inv_dtl 
				ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 
		LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		<!-- #964 [SHINE] Account Slip 기능 보완 - 전체 Accounting 기능 -->
		LEFT OUTER JOIN
        (
            SELECT
                jmb.MODI_TMS    ,
                jmb.JNR_NO     ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             ,
                CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
            ) TJMB           
                ON TJMB.JNR_NO = MST.JNR_NO    
        LEFT OUTER JOIN
            TB_USR issued_usr    
                ON mst.RGST_USRID = issued_usr.USRID    
				  	
		<!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N' -->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND JNR_TP = 'D'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <!-- <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND (
		                	trd.ENG_NM LIKE #s_rcv_from_nm# + '%'
							//#3488 Accounting Multi Language 적용
		                	OR
		                	trd.LOCL_NM LIKE #s_rcv_from_nm# + '%'
		                	)
		              )
		 </isNotEmpty> -->
		 <isEqual property="s_search_rcv_type" compareValue="RCV">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_CD">
			 <isNotEmpty property="s_rcv_from_cd">
			    AND mst.rcvd_fm_cd = #s_rcv_from_cd#
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="s_search_rcv_type" compareValue="RCV_NM">
			 <isNotEmpty property="s_rcv_from_nm">
			    AND mst.rcvd_fm_nm LIKE #s_rcv_from_nm# + '%'
			 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.level = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND LEVEL  IN('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.jnr_no
	) a1	
	</select>    
    
    <!-- Check Journal List 조회  -->
    <select id="searchCHK_JNR_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST */
	 	select * from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      <!-- ,(select eng_nm from tb_trdp x where x.trdp_cd = MAX(mst.trdp_cd)) AS trdp_nm -->
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm				      
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no 
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
			  ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment list remark 삽입 -->   
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  ,MAX(oth.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			  </isEmpty>				      
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
			  ,COUNT(*) OVER() tot_cnt
			  <!-- 6486 [Zencon] Upload email  (Zen#2608) -->	
			  ,CASE WHEN EXISTS(
				SELECT 	palt_doc_seq 
				FROM TB_PALT_SHP_DOC 
				WHERE  intg_bl_seq = MAX(mst.jnr_no)
				AND  palt_mnu_cd = 'PMT'
				)
				THEN 'O'
				ELSE 'X'
				END AS file_exists			
			  			  
		  FROM TB_JNR_MST mst
	LEFT JOIN  TB_JNR_DTL dtl 
		ON mst.JNR_NO = dtl.JNR_NO
	LEFT JOIN TB_INV_DTL inv_dtl 
		ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
	LEFT JOIN TB_FRT frt 
		ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
	LEFT JOIN TB_INTG_BL bl 
		ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
	LEFT JOIN TB_OTH_SALES oth 
		ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
	LEFT JOIN tb_intg_bl_rlt rlt
		ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
	LEFT JOIN tb_intg_bl mbl
	    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
	LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
	) BLCK 
		ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		
	<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
	LEFT OUTER JOIN
	(	
		SELECT MODI_TMS, JNR_NO FROM TB_JNR_MST_BLCK     
	) TJMB       
	ON TJMB.JNR_NO = MST.JNR_NO 		
	LEFT OUTER JOIN TB_USR issued_usr    
            ON mst.RGST_USRID = issued_usr.USRID   	
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>			 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
			AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>						
	ORDER BY a1.ROWNUM ASC		
    </select>
    
    <!-- Check Journal List 조회  -->
    <select id="searchCHK_JNR_LIST_EXCEL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_EXCEL */
    	
	 	select (case when a1.post_dt = '' THEN '' when ISNULL(a1.post_dt,'') = '' then '' else substring(a1.post_dt,5,2)  + '-' +substring(a1.post_dt,7,2) + '-' +substring(a1.post_dt,1,4)END) as post_dt
		      ,a1.rcvd_fm_nm
		      ,a1.chk_no
		      ,a1.trdp_cd
			<!-- //#3488 Accounting Multi Language 적용 -->
		 		,a1.trdp_nm	
		      ,a1.bank_seq
		      ,a1.bank_nm
		      ,a1.amt
		      ,a1.curr_cd
		      ,a1.clr_yn
		      ,(case when a1.clr_dt = '' THEN '' when ISNULL(a1.clr_dt,'') = '' then '' else substring(a1.clr_dt,5,2)  + '-' +substring(a1.clr_dt,7,2) + '-' +substring(a1.clr_dt,1,4)END) as clr_dt
		      ,a1.void_yn
		      ,(case when a1.void_dt = '' THEN '' when ISNULL(a1.void_dt,'') = '' then '' else substring(a1.void_dt,5,2)  + '-' +substring(a1.void_dt,7,2) + '-' +substring(a1.void_dt,1,4)END) as void_dt
		      ,a1.chk_pnt_yn
		      ,a1.p_ofc_cd
		      ,a1.rgst_usrid
		      ,a1.jnr_no
		      ,a1.dtl_cnt
		      ,a1.rider_yn
		      ,a1.hbl_no
		      ,a1.mbl_no
			  ,a1.ref_no 
			  ,a1.clt_cmpl_flg
			  ,a1.rmk	<!-- 20150709 추가. payment list remark 삽입 -->   
			  ,a1.oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  ,CONVERT(varchar(10), a1.modi_tms, 110) + ' ' + CONVERT(varchar(5), a1.modi_tms, 108) as modi_tms
			  ,CONVERT(varchar(10), a1.trx_modi_tms, 110) + ' ' + CONVERT(varchar(5), a1.trx_modi_tms, 108) as trx_modi_tms	 
			  ,a1.bloked_by     
		      ,a1.issued_by      
		      ,a1.block_dt  
			  ,a1.ROWNUM
	 from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
			<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no 
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS clt_cmpl_flg
			  ,MAX(mst.rmk) AS rmk	<!-- 20150709 추가. payment list remark 삽입 -->   
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  ,MAX(oth.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			  </isEmpty>				      
		  FROM TB_JNR_MST mst
	LEFT JOIN  TB_JNR_DTL dtl 
		ON mst.JNR_NO = dtl.JNR_NO
	LEFT JOIN TB_INV_DTL inv_dtl 
		ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
	LEFT JOIN TB_FRT frt 
		ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
	LEFT JOIN TB_INTG_BL bl 
		ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
	LEFT JOIN TB_OTH_SALES oth 
		ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
	LEFT JOIN tb_intg_bl_rlt rlt
		ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
	LEFT JOIN tb_intg_bl mbl
	    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
	LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
	) BLCK 
		ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		
	<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
	LEFT OUTER JOIN
	(	
		SELECT MODI_TMS, JNR_NO FROM TB_JNR_MST_BLCK     
	) TJMB       
	ON TJMB.JNR_NO = MST.JNR_NO 		
	LEFT OUTER JOIN TB_USR issued_usr    
            ON mst.RGST_USRID = issued_usr.USRID   	
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD 
		                AND 
		                ( trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                  OR
		                  trd.LOCL_NM LIKE #s_vendor_nm# + '%' )
		               )
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>			 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
			AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1
	ORDER BY a1.ROWNUM ASC		
    </select>
    
    
    <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
	<select id="searchCHK_JNR_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">	
	/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_CNT */
	 	select count(*) from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,(select eng_nm from tb_trdp x where x.trdp_cd = MAX(mst.trdp_cd)) AS trdp_nm
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no 
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
			  ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment list remark 삽입 -->   
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  ,MAX(oth.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
		  FROM TB_JNR_MST mst
	LEFT JOIN  TB_JNR_DTL dtl 
		ON mst.JNR_NO = dtl.JNR_NO
	LEFT JOIN TB_INV_DTL inv_dtl 
		ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
	LEFT JOIN TB_FRT frt 
		ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
	LEFT JOIN TB_INTG_BL bl 
		ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
	LEFT JOIN TB_OTH_SALES oth 
		ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
	LEFT JOIN tb_intg_bl_rlt rlt
		ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
	LEFT JOIN tb_intg_bl mbl
	    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
	LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
	) BLCK 
		ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		
	<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
	LEFT OUTER JOIN
	(	
		SELECT MODI_TMS, JNR_NO FROM TB_JNR_MST_BLCK     
	) TJMB       
	ON TJMB.JNR_NO = MST.JNR_NO 		
	LEFT OUTER JOIN TB_USR issued_usr    
            ON mst.RGST_USRID = issued_usr.USRID   	
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>			 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
			AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!-- #598 [BNX] Payment List, Deposit List to have Remark Search Box added -->
		 <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1	
	
	</select>    
    
    
    
    <!-- Check Journal List 조회 MANAGE  -->
    <select id="searchCHK_JNR_LIST_MNG" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG */
		select * from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm				   		      
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
			  ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn		
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV2 list remark 삽입 -->  
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms
		      
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		      ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			  </isEmpty>		
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
			  ,COUNT(*) OVER() tot_cnt
			  <!-- 6486 [Zencon] Upload email  (Zen#2608) -->	
			  ,CASE WHEN EXISTS(
				SELECT 	palt_doc_seq 
				FROM TB_PALT_SHP_DOC 
				WHERE  intg_bl_seq = MAX(mst.jnr_no)
				AND  palt_mnu_cd = 'PMT'
				)
				THEN 'O'
				ELSE 'X'
				END AS file_exists	
			  			  		      
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
		) TJMB       
		ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID           	
		  <!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N' -->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  IN ('1','2')
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!--#5634 [Great Luck] To be able to search by Remark on Deposit, Payment List  -->
		  <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>			

    </select>
    
    
    <!-- #2374 [LBS] Deposit/Payment List 에 Excel (All) 버튼 추가 -->
    <select id="searchCHK_JNR_LIST_MNG_EXCEL" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG_EXCEL */
		select * from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
			  ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn		
		    
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV2 list remark 삽입 -->  
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms
		      
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		      ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
			  <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			  <isNotEmpty property="f_orderByInfo">
			  ,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			  </isNotEmpty> 
			  <isEmpty property="f_orderByInfo"> 
			  ,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			  </isEmpty>				      
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
		) TJMB       
		ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID           	
		
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  IN ('1','2')
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1

    </select>
    
    <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
	<select id="searchCHK_JNR_LIST_MNG_CNT" parameterClass="java.util.HashMap" resultClass="Integer">	
	/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG_CNT */
	
		select count(*) from (
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
			  ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn		
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV2 list remark 삽입 -->  
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms
		      
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		      ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  	
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		  	
		<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		LEFT OUTER JOIN
		(
		SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
		) TJMB       
		ON TJMB.JNR_NO = MST.JNR_NO 
		LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID           	
		  <!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N' -->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!-- ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		   AND mst.LEVEL  IN ('1','2')
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  = '2'
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1	
	</select>    
    
    
    <!-- Check Journal List 조회  MANAGE2   -->
    <select id="searchCHK_JNR_LIST_MNG2" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG2 */
		select * from(
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no  -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV3 list remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			,(case 
			when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
			when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
			else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		    ,MAX(BLCK.bloked_by)          AS bloked_by     
	        ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
	        ,MAX(BLCK.block_dt)           AS block_dt  	  
			<!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			<isNotEmpty property="f_orderByInfo">
			,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			</isNotEmpty> 
			<isEmpty property="f_orderByInfo"> 
			,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			</isEmpty>			
			<!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
			,COUNT(*) OVER() tot_cnt
			<!-- 6486 [Zencon] Upload email  (Zen#2608) -->	
			,CASE WHEN EXISTS(
				SELECT 	palt_doc_seq 
				FROM TB_PALT_SHP_DOC 
				WHERE  intg_bl_seq = MAX(mst.jnr_no)
				AND  palt_mnu_cd = 'PMT'
				)
				THEN 'O'
				ELSE 'X'
				END AS file_exists				
			  			        
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			LEFT OUTER JOIN
			(
			SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
			) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
			LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID 
			
		<!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'-->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!--ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  IN ('2','3')
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2','3')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
		 <!--#5634 [Great Luck] To be able to search by Remark on Deposit, Payment List  -->
		  <isNotEmpty property="s_rmk">
			AND mst.rmk LIKE #s_rmk# + '%'
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>			
    </select>
    
    <!-- #2374 [LBS] Deposit/Payment List 에 Excel (All) 버튼 추가 -->
    <select id="searchCHK_JNR_LIST_MNG2_EXCEL" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG2_EXCEL */
		select * from(
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV3 list remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			,(case 
			when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
			when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
			else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		    ,MAX(BLCK.bloked_by)          AS bloked_by     
	        ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
	        ,MAX(BLCK.block_dt)           AS block_dt  	  
			<!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 --> 
			<isNotEmpty property="f_orderByInfo">
			,ROW_NUMBER() OVER (ORDER BY $f_orderByInfo$) as ROWNUM
			</isNotEmpty> 
			<isEmpty property="f_orderByInfo"> 
			,ROW_NUMBER() OVER (ORDER BY MAX(mst.modi_tms) desc, MAX(mst.post_dt) desc, MAX(mst.jnr_no) desc) as ROWNUM
			</isEmpty>			        
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			LEFT OUTER JOIN
			(
			SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
			) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
			LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID 
			
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!--ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  IN ('2','3')
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2','3')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1
    </select>
    
    <!-- #2341 [LBS] Deposit/Payment List 속도 개선을 위한 paging 처리 -->
	<select id="searchCHK_JNR_LIST_MNG2_CNT" parameterClass="java.util.HashMap" resultClass="Integer">	
	/* AccJorJournalSQL.xml > searchCHK_JNR_LIST_MNG2_CNT */
		select count(*) from(
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
				<!-- //#3488 Accounting Multi Language 적용 -->
		 		,CASE WHEN EXISTS(
				SELECT 1
				FROM TB_SYS_OPT
				WHERE 1=1
				AND OPT_KEY = 'MULTI_LANGUAGE'
				AND OPT_VAL = 'Y'
				)
				THEN (SELECT LOCL_NM FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				ELSE (SELECT eng_nm FROM TB_TRDP x WHERE x.trdp_cd = MAX(mst.trdp_cd))
				END AS trdp_nm	
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,CASE WHEN MAX(mst.level) IN ('2','3') THEN 'Y'
		      	    WHEN MAX(mst.level) = '1' THEN 'N'
		       END 						AS block
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      <!-- ZOOT::TODO 215-01-08
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no  -->
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		      ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment LV3 list remark 삽입 -->
		      ,MAX(mst.ofc_blck_flg) AS OFC_BLCK_FLG	<!-- 201601  추가. OFFICE 접근 권한 추가 -->
		      ,MAX(mst.level) AS LEVEL_VALUE	<!-- 201601  추가. OFFICE 접근 권한 추가 --> 
		      ,MAX(mst.modi_tms) AS modi_tms

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			,(case 
			when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
			when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
			else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 		      
		    ,MAX(BLCK.bloked_by)          AS bloked_by     
	        ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
	        ,MAX(BLCK.block_dt)           AS block_dt  	  
		  FROM TB_JNR_MST mst
		LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid
		) BLCK 
			ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1

			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
			LEFT OUTER JOIN
			(
			SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
			) TJMB       
			ON TJMB.JNR_NO = MST.JNR_NO 
			LEFT OUTER JOIN TB_USR issued_usr    
             ON mst.RGST_USRID = issued_usr.USRID 
			
		<!-- ZOOT::TODO 215-01-08
		LEFT JOIN TB_JNR_DTL dtl 
			ON mst.JNR_NO = dtl.JNR_NO	
		LEFT JOIN TB_INV_DTL inv_dtl 
			ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
		LEFT JOIN TB_FRT frt 
			ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
		LEFT JOIN TB_INTG_BL bl 
			ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
		LEFT JOIN tb_intg_bl_rlt rlt
			ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'-->
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   <!--ZOOT::TODO 215-01-08
		   AND isnull(dtl.DELT_FLG,'N') = 'N' -->
		   AND mst.JNR_TP = 'C'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_vendor_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD
		                <!-- //#3488 Accounting Multi Language 적용 --> 
		                AND (
		                	trd.ENG_NM LIKE #s_vendor_nm# + '%'
		                	OR
		                	trd.LOCL_NM LIKE #s_vendor_nm# + '%')
		                )
		 </isNotEmpty>
		 
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_print_yn">
				AND isnull(mst.chk_pnt_yn, 'N') = #s_print_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_block_yn">
		 	<isEqual property="s_block_yn" compareValue="Y">
		 		AND mst.LEVEL  IN ('2','3')
		 	</isEqual>
		 	<isEqual property="s_block_yn" compareValue="N">
		 		AND mst.level = '1'
		 	</isEqual>
		 </isNotEmpty>
		 <isEmpty property="s_block_yn">
			 AND mst.LEVEL  IN ('1','2','3')
		 </isEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	) a1	
	
	</select>    
    
    <!-- JOURNAL MST POST DATE UPDATE  -->
    <update id="updateJNR_POSTDATE" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET POST_DT = #post_dt#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE JNR_NO = #jnr_no#
    </update>
    
    <!-- JOURNAL DTL POST DATE UPDATE  -->
    <update id="updateJNR_DTL_POSTDATE" parameterClass="JournalVO">
    	UPDATE TB_JNR_DTL
    	   SET POST_DT = #post_dt#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE JNR_NO = #jnr_no#
    	    AND LTRIM(INV_SEQ) =''
    </update>
    
    
    <!-- GENERAL JOURNAL POST DATE UPDATE  -->
    <update id="updateGNR_JNR_POSTDATE" parameterClass="GeneralVO">
    	UPDATE TB_SLIP_MST
    	   SET POST_DT = #post_dt#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE SLIP_NO = #slip_no#
    </update>
    
    <!-- Journal Master Info 조회  -->
    <select id="searchJNR_MST_INFO" parameterClass="java.util.HashMap" resultClass="JournalVO">
    	SELECT  jnr.jnr_no
    		   ,isnull(jnr.void_yn,'N') as void_yn	
    	  FROM TB_JNR_MST jnr
    	 WHERE jnr.JNR_NO = #jnr_no#
    	   AND isnull(jnr.DELT_FLG,'N') = 'N'
    </select>
    
    <!-- Journal Detail List 조회  -->
    <select id="searchJNR_DTL_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
    	SELECT  jnr_dtl.inv_no
    		   ,jnr_dtl.pay_amt	
    	 	   ,jnr_dtl.ttl_pay_amt
    	 	   ,jnr_dtl.curr_cd
    	 	   ,inv_mst.inv_seq
    	 	   ,inv_mst.sell_buy_tp_cd
    	 	   ,jnr_dtl.xcrt AS inv_aply_xcrt
    	  FROM TB_JNR_DTL jnr_dtl
	      JOIN TB_INV_DTL inv_dtl ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
	      JOIN TB_INV inv_mst     ON inv_dtl.INV_SEQ = inv_mst.INV_SEQ
    	 WHERE jnr_dtl.JNR_NO = #jnr_no#
    	   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
    </select>
    
    
    
    <!-- Journal Detail 정보를 UPDATE 한다. VOID CHECK 용  -->
    <update id="upateInvDtlJnrDelete" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #ttl_pay_amt#
		      ,PAY_FRGN_AMT = isnull(pay_frgn_amt,0) - #pay_frgn_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #ttl_pay_amt#
		      ,BAL_FRGN_AMT = isnull(bal_frgn_amt,0) + #bal_frgn_amt#
			    ,modi_tms			= GETUTCDATE()
		 WHERE INV_NO = #inv_no#  
		   <isNotEmpty property="inv_seq">
		   	   AND inv_seq = #inv_seq#
		   </isNotEmpty>
    </update>
    
    
    <!-- TB_TRDP CUR_LMT_AMT 금액을 UPDATE 한다.  -->
    <update id="upateTrdpCurLmtAmtJnrDelete" parameterClass="InvJorVO">
    	UPDATE TB_TRDP
    	   SET CUR_LMT_AMT = isnull(cur_lmt_amt,0) + #cur_lmt_amt#
    	 WHERE TRDP_CD = #trdp_cd#
    </update>
    
    
    
    <!-- Check Journal Print 정보를 UPDATE 한다.  -->
    <update id="updateChkPntDt" parameterClass="java.util.HashMap">
   		UPDATE TB_JNR_MST
   		   SET CHK_PNT_YN = 'Y'
   		      ,CHK_PNT_DT = convert(varchar(8), getdate(), 112)
   		      ,CHK_PNT_USRID = #proc_usrid#
   		      <isEqual property="f_list_yn" compareValue="Y">
   		      ,MODI_TMS = GETUTCDATE()
   		      </isEqual>
   		 WHERE JNR_NO = #f_jnr_no#   		     
    </update>
    
    <!-- Check Journal Print 정보를 UPDATE 한다.  -->
    <!-- #1106 [UFF] PAYMENT CHECK BATCH PRINT -->
    <update id="updateChkPntDtIn" parameterClass="java.util.HashMap">
   		UPDATE TB_JNR_MST
   		   SET CHK_PNT_YN = 'Y'
   		      ,CHK_PNT_DT = convert(varchar(8), getdate(), 112)
   		      ,CHK_PNT_USRID = #proc_usrid#
   		      <isEqual property="f_list_yn" compareValue="Y">
   		      ,MODI_TMS = GETUTCDATE()
   		      </isEqual>
   		 WHERE JNR_NO in ($in_jnr_no$)   		     
    </update>
    
     <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
    <select id="searchJnrModiTms" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		/*  AccInvInvoiceSQL.xml > searchJnrModiTms  */
		SELECT MAX(MODI_TMS) AS MODI_TMS
		FROM (
			SELECT MODI_TMS
			  FROM TB_JNR_MST
			 WHERE JNR_NO = #jnr_no#
			 
			union all
			 
			 SELECT MODI_TMS
			  FROM TB_JNR_MST_BLCK /* 52320 */
			 WHERE JNR_NO = #jnr_no#
			 
			 
		) INVAL
    </select>
    
    <!-- GL_NO 로  BANK INFO 조회  -->
    <select id="searchGlBankInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	
    	SELECT gl.gl_cd 
		      ,gl.rmk
		  FROM TB_GL_CD gl
		 WHERE USE_FLG = 'Y'
		   AND gl_cd = #gl_no#
		   <isNull property="block_all_yn">
		    <isNotNull property="usrid">
		   AND (BLOCK_YN = 'N' OR BLOCK_YN = (SELECT
			  ISNULL(MAX(A.USE_FLG), 'N') AS AUTH_BLOCK
			 FROM TB_ROLE_FNC A, TB_USR B
			 WHERE A.ROLE_CD = B.ROLE_CD
			 AND ROLE_FNC_CD = 'G01' 
			 AND B.USRID  = #usrid#))
			 </isNotNull>
			</isNull>
		<!--  
		SELECT   bank_seq
    			,bank_nm
    			,gl_cd
    	  FROM TB_BANK
    	 WHERE GL_CD = #gl_no#
    	   -->
    </select>
    
    
    <!-- BANK_NAME으로 BANK_SEQ 조회  -->
    <select id="searchBankNm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT   bank_seq
    			,bank_nm
    	  FROM TB_BANK
    	 WHERE bank_nm = #com_nm#
    </select>
    
    <!-- GL 정보로 BANK INFO 조회  -->
    <select id="searchBankInfoByGL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT   bank.bank_seq
    			,bank.bank_nm
    			,bank.gl_cd
    			,gl.rmk
    			,gl.gl_type        <!-- #2500 [PATENT]Journal Entry Amendment -->
    	  FROM tb_bank bank
    	       LEFT OUTER JOIN tb_gl_cd gl ON gl.gl_cd = bank.gl_cd
    	 WHERE bank.use_flg = 'Y' 
    	   <isNotNull property="usrid">
		   AND (gl.BLOCK_YN = 'N' OR gl.BLOCK_YN = (SELECT
			  ISNULL(MAX(A.USE_FLG), 'N') AS AUTH_BLOCK
			 FROM TB_ROLE_FNC A, TB_USR B
			 WHERE A.ROLE_CD = B.ROLE_CD
			 AND ROLE_FNC_CD = 'G01' 
			 AND B.USRID  = #usrid#))
			</isNotNull>
    	 <dynamic>
    	 	<isNotNull property="gl_no">
    	 		AND bank.gl_cd = #gl_no#
    	 	</isNotNull>
    	 	<isNotNull property="bank_nm">
    	 		AND bank.bank_nm = #bank_nm#
    	 	</isNotNull>
    	 	<isNotNull property="bank_seq">
    	 		AND bank.bank_seq = #bank_seq#
    	 	</isNotNull>
    	 	<isNotNull property="gl_rmk">
    	 		AND gl.rmk = #gl_rmk#
    	 	</isNotNull>
    	 </dynamic>
    </select>
    
    <!-- GL_NO 으로 GL_RMK 를 검색한다.  -->
    <select id="getGlInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	SELECT gl_cd
	,rmk, gl_pty_tp_cd
	,gl_type  <!-- #2500 [PATENT]Journal Entry Amendment -->
	FROM tb_gl_cd
	WHERE use_flg = 'Y'
		<isNotNull property="usrid">
			AND (BLOCK_YN = 'N' OR BLOCK_YN = (SELECT
			ISNULL(MAX(A.USE_FLG), 'N') AS AUTH_BLOCK
			FROM TB_ROLE_FNC A, TB_USR B
			WHERE A.ROLE_CD = B.ROLE_CD
			AND ROLE_FNC_CD = 'G01'
			AND B.USRID = #usrid#))
		</isNotNull>
         
         <dynamic>
    	 	<isNotNull property="gl_no">
    	 		AND gl_cd = #gl_no#
    	 	</isNotNull>
    	 	<isNotNull property="gl_rmk">
    	 		AND rmk = #gl_rmk#
    	 	</isNotNull>
    	 </dynamic>
    </select>
    
    
    <!-- CUST_NAME으로 CUST_CD 조회  -->
    <select id="searchCustNm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT   trdp_cd
    			,eng_nm
    	  FROM TB_TRDP
    	 WHERE eng_nm = #com_nm#
    </select>
    
    
    
    <!-- GL_NO 으로 GL_RMK 를 검색한다.  -->
    <select id="getGlRmk" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT  gl_cd
       		   ,rmk
          FROM TB_GL_CD
         WHERE GL_CD   = #s_gl_no#
           AND USE_FLG = 'Y' 
		<isNotNull property="usrid">
			AND (BLOCK_YN = 'N' OR BLOCK_YN = (SELECT
			ISNULL(MAX(A.USE_FLG), 'N') AS AUTH_BLOCK
			FROM TB_ROLE_FNC A, TB_USR B
			WHERE A.ROLE_CD = B.ROLE_CD
			AND ROLE_FNC_CD = 'G01'
			AND B.USRID = #usrid#))
		</isNotNull>
		<isEqual property="jnr_tp" compareValue="P">
	 	    AND gl_pay_flg = 'Y'
	    </isEqual>
	    <isEqual property="jnr_tp" compareValue="D">
	 	    AND gl_dept_flg = 'Y'
	    </isEqual>
    </select>
    
    
    
    <!-- General Master PK생성   -->
    <select id="selectSLIP_MST_SEQ_MAX" parameterClass="java.util.HashMap" resultClass="String">
        SELECT  isnull(max(slip_no)+1, 1)
          FROM  tb_slip_mst
    </select>
    
    
    <!-- General Master DT_SEQ   -->
    <select id="selectSLIP_DT_SEQ_MAX" parameterClass="java.util.HashMap" resultClass="String">
        SELECT  isnull(max(dt_seq)+1, 1)
          FROM  tb_slip_mst
         WHERE  post_dt = #post_dt#
    </select>
    
    
    <!-- General Detaile PK생성   -->
    <select id="selectSLIP_DTL_SEQ_MAX" parameterClass="java.util.HashMap" resultClass="String">
        SELECT  isnull(max(slip_seq)+1, 1)
          FROM  tb_slip_dtl
    </select>
    
    <!-- Select Count Slip No. -->
    <select id="selectSlipNoCountRSQL" parameterClass="java.util.HashMap" resultClass="Integer">
    	/* AccInvInvoiceSQL.xml > selectSlipNoCountRSQL */
        SELECT  COUNT(*)
		FROM  TB_SLIP_MST
		WHERE SLIP_NO = #f_slip_no#
    </select>
    
    <!-- General Master 정보를 INSERT 한다.   -->
    <insert id="insertGeneralMst" parameterClass="GeneralVO">
    	INSERT INTO TB_SLIP_MST(
			 slip_no
			,slip_tp
			,slip_2nd_tp
			,ref_no
			,post_dt
			,reserve_field01
			,dt_seq
			,g_debit
			,g_credit
			,curr_cd
			,rmk
			,delt_flg
			,p_ofc_cd
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
			<!-- #1799 [PATENT] VOUCHER 양식 - Deposit/Payment for CHINA Account Slip [Form] -->
			,vchr_no
			,vchr_tp_cd
		)VALUES(
			 #slip_no#
			,#slip_tp#
			,#slip_2nd_tp#
			,#ref_no#
			,#post_dt#
			,#post_dt#
			,#dt_seq#
			,#g_debit#
			,#g_credit#
			,#curr_cd#
			,UPPER(#rmk#)
			,'N'
			,#p_ofc_cd#
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
			<!-- #1799 [PATENT] VOUCHER 양식 - Deposit/Payment for CHINA Account Slip [Form] -->
			,#vchr_no#
			,#vchr_tp_cd#
		)
    </insert>
    
    
    <!-- General Detail 정보를 INSERT 한다.   -->
    <insert id="insertGeneralDtl" parameterClass="GeneralVO">
    	INSERT INTO TB_SLIP_DTL(
			 slip_no
			,slip_seq
			,gl_no
			,com_tp
			,com_cd
			,com_nm
			,gl_sub
			,debit
			,credit
			,curr_cd
			,xcrt
			,ttl_debit
			,ttl_credit
			,slip_desc
			,p_ofc_cd
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
			,sls_usrid
			,sls_usrnm
			,amt  <!-- #2500 [PATENT]Journal Entry Amendment  -->
		)VALUES(
			 #slip_no#
			,#slip_seq#
			,#gl_no#
			,#com_tp#
			,#com_cd#
			,#com_nm#
			,#gl_sub#
			,#debit#
			,#credit#
			,#curr_cd#
			,#xcrt#
			,#ttl_debit#   <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
			,#ttl_credit#  <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
			,#slip_desc#
			,#p_ofc_cd#
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
			,#sls_usrid#
			,#sls_usrnm#
			,#amt#   <!-- #2500 [PATENT]Journal Entry Amendment  -->
		)
    </insert>
    
    
    <!-- General Master 정보를 UPDATE 한다.   -->
    <update id="updateGeneralMst" parameterClass="GeneralVO">
    	UPDATE TB_SLIP_MST
		   SET post_dt		= #post_dt#
		      ,reserve_field01 = #post_dt#
			  ,g_debit		= #g_debit#
			  ,g_credit		= #g_credit#
			  ,curr_cd		= #curr_cd#
			  ,rmk			= UPPER(#rmk#)
			  ,p_ofc_cd		= #p_ofc_cd#
			  ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
			  <!-- #1799 [PATENT] VOUCHER 양식 - Deposit/Payment for CHINA Account Slip [Form] -->
			  ,vchr_no		= #vchr_no#
			  ,vchr_tp_cd	= #vchr_tp_cd#
		WHERE slip_no = #slip_no#
    </update>
    
    
    <!-- General Detail 정보를 UPDATE 한다.   -->
    <update id="updateGeneralDtl" parameterClass="GeneralVO">
    	UPDATE TB_SLIP_DTL
    	   SET   gl_no			= #gl_no#
				,com_tp			= #com_tp#
				,com_cd			= #com_cd#
				,com_nm			= #com_nm#
				,gl_sub			= #gl_sub#
				,debit			= #debit#
				,credit			= #credit#
				,curr_cd		= #curr_cd#
				,ttl_debit		= #ttl_debit#  <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
				,ttl_credit		= #ttl_credit# <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
				,slip_desc		= #slip_desc#
				,p_ofc_cd		= #p_ofc_cd#
				,modi_usrid		= #proc_usrid#
			    ,modi_ofc_cd	= #proc_ofccd#
			    ,modi_tms		= GETUTCDATE()
			    ,sls_usrid		= #sls_usrid#
				,sls_usrnm		= #sls_usrnm#
				,xcrt           = #xcrt#   <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
				,amt          = #amt#  <!-- #2500 [PATENT]Journal Entry Amendment -->
		WHERE slip_no  = #slip_no#
		  AND slip_seq = #slip_seq#
    </update>
    
    <!-- General Detail 정보를 개별삭제 한다.   -->
    <update id="deleteGeneralDtl" parameterClass="GeneralVO">
    	DELETE FROM TB_SLIP_DTL
    	 WHERE slip_no  = #slip_no#
		   AND slip_seq = #slip_seq# 
    </update>
    
    
    <!-- General Master 정보를 삭제 한다.   -->
    <update id="deleteGeneralMst" parameterClass="GeneralVO">
    	UPDATE TB_SLIP_MST
		   SET delt_flg		= 'Y'
			  ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
		WHERE slip_no = #slip_no#
    </update>
    
    
    <!-- General Journal 조회  -->
    <select id="searchGENERAL_JOURNAL" parameterClass="java.util.HashMap" resultClass="GeneralVO">
    	SELECT mst.SLIP_NO
		      ,mst.POST_DT
		      ,mst.DT_SEQ
		      ,mst.G_DEBIT
		      ,mst.G_CREDIT
		      ,mst.CURR_CD
		      ,mst.RMK
		      ,mst.P_OFC_CD
		      ,dtl.SLIP_SEQ
		      ,dtl.GL_NO
		      ,GL.RMK as GL_RMK
		      ,dtl.COM_TP
		      ,dtl.COM_CD
		      ,dtl.COM_NM
		      ,dtl.GL_SUB
		      ,dtl.DEBIT
		      ,dtl.CREDIT
		      ,dtl.SLIP_DESC
		      ,mst.ACCT_DT
		      ,ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG) AS CLT_CMPL_FLG1
		      ,mst.JNR_YN
		      ,mst.CLS_YN
		      ,mst.DELT_FLG
		      ,mst.SLIP_TP
		      ,dtl.sls_usrid
		      ,dtl.sls_usrnm
		      ,mst.VCHR_NO
		      ,mst.VCHR_TP_CD
		      
		      <!-- #2149 [PATENT] JOURNAL ENTRY 화면 조정 - VOUCHER FORM 조정 -->
		      ,dtl.curr_cd as fr_curr_cd
		      ,mst.curr_cd as to_curr_cd
		      ,dtl.ttl_debit as  ttl_debit
		      ,dtl.ttl_credit as  ttl_credit
		      ,dtl.xcrt as  ex_rate
		      ,mst.post_dt as ex_date
		      <!-- #2500 [PATENT]Journal Entry Amendment -->
		      ,gl.gl_type         
		      ,ISNULL(dtl.amt,
						(case when  gl.gl_type = 'AS' or
								   gl.gl_type = 'CO' or
								   gl.gl_type = 'EX' or
								   gl.gl_type = 'OE' then   (case when dtl.DEBIT > dtl.CREDIT then dtl.DEBIT else dtl.CREDIT*-1 end)
							 when  gl.gl_type = 'EQ' or    
								   gl.gl_type = 'IN' or 
								   gl.gl_type = 'IT' or 
								   gl.gl_type = 'LI' or 
								   gl.gl_type = 'OI' then   (case when dtl.CREDIT > dtl.DEBIT then dtl.CREDIT else dtl.DEBIT*-1 end)
						end)
		        ) as amt  
		        ,ISNULL((select CLT_CMPL_FLG from TB_SLIP_MST_BLCK blk where blk.SLIP_NO = mst.SLIP_NO and blk.p_ofc_cd = mst.p_ofc_cd),'') as CLT_CMPL_FLG	      
		  FROM TB_SLIP_MST mst
		 LEFT JOIN TB_SLIP_DTL dtl ON mst.SLIP_NO = dtl.SLIP_NO
		 LEFT OUTER JOIN (SELECT SLIP_NO AS SLIP_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_SLIP_MST) BLCK 
		 	ON MST.SLIP_NO = BLCK.SLIP_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
	     LEFT OUTER JOIN TB_GL_CD GL on gl.GL_CD = dtl.GL_NO  <!-- #2500 [PATENT]Journal Entry Amendment -->    		 	
		 WHERE mst.SLIP_NO = #f_slip_no#
		     	 <!-- 
    	 	//2016.04.18 C.W.Park Modified
    	 	#52109 ofc별 block 일자 확인 
    	 -->
    	 <!-- #554 [BINEX] General Journal 조회 오류
    	 <isNotEmpty property="ofc_cd">
			AND mst.P_OFC_CD = #ofc_cd#
		 </isNotEmpty>
		 -->
    </select>
    
    
    
    <!-- General Journal List 조회  -->
    <select id="searchGENERAL_JOURNAL_LIST" parameterClass="java.util.HashMap" resultClass="GeneralVO">
		/* AccJorJournalSQL.xml > searchGENERAL_JOURNAL_LIST */
    	SELECT mst.SLIP_NO
		      ,MAX(mst.POST_DT)		AS POST_DT
		      ,MAX(mst.DT_SEQ)		AS DT_SEQ 
		      ,MAX(mst.G_DEBIT)		AS G_DEBIT
		      ,MAX(mst.G_CREDIT)	AS G_CREDIT
		      ,MAX(mst.CURR_CD)		AS CURR_CD
		      ,MAX(mst.RMK)			AS RMK
		      ,MAX(mst.P_OFC_CD)	AS P_OFC_CD
		      ,MAX(mst.rgst_usrid)  AS rgst_usrid
		      ,MAX(dtl.SLIP_SEQ)	AS SLIP_SEQ
		      ,MAX(dtl.GL_NO)		AS GL_NO
		      ,MAX(dtl.COM_TP)		AS COM_TP
		      ,MAX(dtl.COM_CD)		AS COM_CD
		      ,MAX(dtl.COM_NM)		AS COM_NM
		      ,MAX(mst.ACCT_DT)		AS ACCT_DT
		  FROM TB_SLIP_MST mst
		 LEFT JOIN TB_SLIP_DTL dtl ON mst.SLIP_NO = dtl.SLIP_NO
		 WHERE delt_flg = 'N'
		   AND mst.slip_tp = 'SL'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND dtl.COM_CD = #s_vendor_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
	    GROUP BY mst.slip_no
	    ORDER BY MAX(mst.post_dt) desc
    </select>
    
    
    <!-- CLEAR 처리를 위한 INVOICE 금액조회   -->
    <select id="selectCLR_INV_AMT" parameterClass="InvJorVO" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > selectCLR_INV_AMT */
    	SELECT isnull(INV_SUM_AMT,0)						AS inv_sum_amt
		      ,isnull(BAL_AMT,0)  							AS bal_sum_amt
		  FROM TB_INV_DTL
		 WHERE INV_NO = #inv_no#
		   <isNotEmpty property="inv_seq">
		 	  AND inv_seq = #inv_seq#
		   </isNotEmpty>
    </select>
    
    <!-- INVOICE CLEAR 정보를 UPDATE 한다.   -->
    <update id="upateCLR_INV_STS" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
    	   SET inv_sts_cd   = #inv_sts_cd#
			    ,modi_tms			= GETUTCDATE()
    	 WHERE inv_no = #inv_no#
    	   <isNotEmpty property="inv_seq">
		 	AND inv_seq = #inv_seq#
		 </isNotEmpty>
    </update>
    
    
    
    <!-- BATCH ACCOUNTING LIST 조회   -->
    <select id="searchBAT_ACC_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchBAT_ACC_LIST */
    	SELECT mst.POST_DT
		      ,mst.TRDP_CD
		      ,CASE WHEN mst.LEVEL = '3' THEN '*******************'
		            ELSE 
 						<!-- #3488 Accounting Multi Language 적용  -->		            
		            	CASE
							WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
					 			THEN (SELECT x.LOCL_NM FROM TB_TRDP x WHERE x.TRDP_CD = mst.TRDP_CD) 
			 		 		ELSE 	 (SELECT x.ENG_NM FROM TB_TRDP x WHERE x.TRDP_CD = mst.TRDP_CD)
		 		 		END  
		       END AS TRDP_NM
		      ,mst.CHK_NO
		      ,mst.CURR_CD
		      ,(SELECT COUNT(dtl.JNR_NO) FROM TB_JNR_DTL dtl WHERE mst.JNR_NO = dtl.JNR_NO) AS items
		      ,mst.AMT
		      ,mst.VOID_YN
		      ,mst.VOID_DT
		      ,mst.CLR_YN
		      ,mst.CLR_DT
		      ,mst.JNR_NO
		      ,mst.JNR_TP
		      ,mst.BANK_SEQ
		      ,(SELECT x.bank_nm FROM tb_bank x where x.bank_seq = mst.BANK_SEQ) as BANK_NM
		      ,mst.P_OFC_CD
		      ,mst.OFC_BLCK_FLG
		      ,mst.LEVEL <!-- #51951 -->
		      ,ISNULL(mst.CLT_CMPL_FLG , blck.CLT_CMPL_FLG) as  CLT_CMPL_FLG <!--[#5772] [ZEN CON] Authorizaiton to remove clear date by Operatin Accounting Role -->
		  FROM TB_JNR_MST mst
		  <!--[#5772] [ZEN CON] Authorizaiton to remove clear date by Operatin Accounting Role -->
		  LEFT OUTER JOIN TB_JNR_MST_BLCK blck
	ON MST.JNR_NO = BLCK.JNR_NO AND MST.P_OFC_CD = BLCK.P_OFC_CD
		 WHERE 1 = 1
		 <isEqual property="act_radio" compareValue="1">
		 	AND mst.DELT_FLG = 'N'
		    AND mst.VOID_YN  = 'N'
		    AND mst.CLR_YN   = 'N'
		    AND mst.JNR_TP   IN('D','B')
			 <isNotEmpty property="s_post_strdt">
			 	<isNotEmpty property="s_post_enddt">
			 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
			 	</isNotEmpty>
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="act_radio" compareValue="2">
		 	AND mst.DELT_FLG = 'N'
		    AND mst.VOID_YN  = 'N'
		    AND mst.CLR_YN   = 'N'
		    AND mst.JNR_TP   IN('C','V')
			 <isNotEmpty property="s_post_strdt">
			 	<isNotEmpty property="s_post_enddt">
			 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
			 	</isNotEmpty>
			 </isNotEmpty>
		 </isEqual>
		 <isEqual property="act_radio" compareValue="3">
		 	AND mst.DELT_FLG = 'N'
		    AND mst.VOID_YN  = 'N'
		    AND mst.CLR_YN   = 'Y'
		    AND mst.JNR_TP   IN('D','B')
		    <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.CLR_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 </isEqual>
		 <isEqual property="act_radio" compareValue="4">
		 	AND mst.DELT_FLG = 'N'
		    AND mst.VOID_YN  = 'N'
		    AND mst.CLR_YN   = 'Y'
		    AND mst.JNR_TP   IN('C','V')
		    <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.CLR_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 </isEqual>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd# 
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 ORDER BY mst.POST_DT, mst.CHK_NO
    </select>
    
    
    
    
    <!-- BATCH ACCOUNTING EXCEL LIST 조회   -->
    <select id="searchBAT_ACC_LIST_EXCEL" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchBAT_ACC_LIST_EXCEL */
    	SELECT jnr_mst.JNR_NO							AS JNR_NO
    	      ,MAX(jnr_mst.CLR_DT)						AS CLR_DT
		      ,ISNULL(MAX(inv_dtl.INV_NO), MAX(inv_dtl.BUY_INV_NO))	AS INV_NO
		      ,CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) = 'S' THEN 'A/R'
		      		WHEN MAX(inv_mst.SELL_BUY_TP_CD) = 'B' THEN 'A/P'
		      		WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('C','D') THEN 'DB/CR'
		       END 										AS INV_TP
		      ,MAX(jnr_mst.TRDP_CD) 					AS TRDP_CD
		       
		      <!-- #3488 Accounting Multi Language 적용  --> 	   			 
	   			,CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN (SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD = MAX(jnr_mst.TRDP_CD))
		 		 	ELSE 	  (SELECT ENG_NM FROM TB_TRDP WHERE TRDP_CD = MAX(jnr_mst.TRDP_CD))
	   			 END AS TRDP_NM
		      
		      ,MAX(inv_dtl.INV_DT) 						AS INV_DT
		      ,ISNULL(MAX(bl.BL_NO),  MAX(oth.HBL_NO)) 	AS BL_NO
		      ,ISNULL(MAX(bl.REF_NO), MAX(oth.REF_NO)) 	AS REF_NO
		      ,CASE WHEN MAX(jnr_mst.JNR_TP) = 'D' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT)
		                                                     ELSE MAX(inv_dtl.INV_SUM_AMT) * -1
		                                                END 
		            WHEN MAX(jnr_mst.JNR_TP) = 'C' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT)
		                                                     ELSE MAX(inv_dtl.INV_SUM_AMT) * -1
		                                                END
		       END										AS INV_SUM_AMT
		      ,CASE WHEN MAX(jnr_mst.JNR_TP) = 'D' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('S','D') THEN MAX(jnr_dtl.TTL_PAY_AMT)
		                                                     ELSE MAX(jnr_dtl.TTL_PAY_AMT) * -1
		                                                END 
		            WHEN MAX(jnr_mst.JNR_TP) = 'C' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('B','C') THEN MAX(jnr_dtl.TTL_PAY_AMT)
		                                                     ELSE MAX(jnr_dtl.TTL_PAY_AMT) * -1
		                                                END
		       END										AS PAY_AMT
		      ,CASE WHEN MAX(jnr_mst.JNR_TP) = 'D' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('S','D') THEN MAX(inv_dtl.BAL_AMT)
		                                            ELSE MAX(inv_dtl.BAL_AMT) * -1
		                                       END 
		            WHEN MAX(jnr_mst.JNR_TP) = 'C' THEN CASE WHEN MAX(inv_mst.SELL_BUY_TP_CD) IN ('B','C') THEN MAX(inv_dtl.BAL_AMT)
		                                            ELSE MAX(inv_dtl.BAL_AMT) * -1
		                                       END
		       END										AS BAL_AMT
		  FROM TB_JNR_MST jnr_mst
		      ,TB_JNR_DTL jnr_dtl
		  LEFT JOIN TB_INV_DTL inv_dtl ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND ISNULL(inv_dtl.DELT_FLG, 'N') = 'N'
		  JOIN TB_INV inv_mst ON inv_dtl.INV_SEQ = inv_mst.INV_SEQ AND ISNULL(inv_mst.DELT_FLG, 'N') = 'N'
		  JOIN TB_FRT frt ON inv_dtl.INV_SEQ = frt.INV_SEQ AND ISNULL(frt.DELT_FLG, 'N') = 'N'     
		  LEFT JOIN TB_INTG_BL bl ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ AND ISNULL(bl.DELT_FLG, 'N') = 'N'     
		  LEFT JOIN TB_OTH_SALES oth ON frt.OTH_SEQ = oth.OTH_SEQ AND ISNULL(oth.DELT_FLG, 'N') = 'N'
		 WHERE 1=1
		   AND jnr_mst.JNR_NO = jnr_dtl.JNR_NO
		   AND ISNULL(jnr_mst.DELT_FLG, 'N') = 'N'          
		   AND ISNULL(jnr_dtl.DELT_FLG, 'N') = 'N'
		   AND jnr_mst.JNR_NO IN $f_param_val$
		GROUP BY jnr_mst.JNR_NO, inv_dtl.INV_SEQ 
		ORDER BY jnr_mst.JNR_NO, inv_dtl.INV_SEQ
    </select>
    
    
    <!-- BATCH ACCOUNTING CLEAR UPDATE 한다.   -->
    <update id="updateBAT_ACC_CLEAR" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET CLR_YN       = 'Y'
    	      ,CLR_DT       = #deposit_dt#
    	      ,BATCH_SEQ    = #batch_seq#
    	      ,BANK_SEQ		= #bank_seq#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE jnr_no = #jnr_no#
    	   AND jnr_tp = #jnr_tp#
    </update>
    
    
    
    <!-- BATCH ACCOUNTING CANCEL UPDATE 한다.   -->
    <update id="updateBAT_ACC_CANCEL" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET CLR_YN    	= 'N'
    	      ,CLR_DT    	= ''
    	      ,BATCH_SEQ 	= #batch_seq#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE jnr_no = #jnr_no#
    	   AND jnr_tp = #jnr_tp#
    </update>
    
    
    
    
    <!-- BANK OUTSTANDING 조회  -->
    <!-- #2818 [Patson] AR Invoices are still reflected in Ageing Report even though Deposit has been fully completed -->
    <select id="searchBankOutstanding" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > searchBankOutstanding */
	    SELECT bank_nm,
		       bank_seq,
		       <isEqual property="s_ofc_cd" compareValue="">
	        	<isEqual property="f_grp_by_ofc" compareValue="G">
	        		ofc_cd,
	        	</isEqual>
	        	<isNotEqual property="f_grp_by_ofc" compareValue="G">
	        		'ALL' AS ofc_cd,
	        	</isNotEqual>
	           </isEqual>
		       <isNotEqual property="s_ofc_cd" compareValue="">
	        		MAX(ofc_cd) AS ofc_cd,
	        	</isNotEqual>
		       CASE 
		            WHEN A.bank_seq IS NULL THEN 1          
		            ELSE 0      
		        END AS order_seq,
		       SUM(d_amt) AS d_amt,
		       SUM(c_amt) AS c_amt,
		       SUM(t_amt) AS t_amt       
		  FROM (
		    	SELECT
					  CASE WHEN M.bank_seq is not null THEN '*' + B.bank_nm
					       ELSE B.bank_nm
					  END bank_nm,
					  M.bank_seq,
					  D.OFC_CD,
					  M.jnr_tp,
					  CASE WHEN MAX(M.JNR_TP) IN ('D','B') THEN SUM(CASE WHEN I.SELL_BUY_TP_CD IN ('S', 'D') THEN D.PAY_AMT
					                                                     WHEN I.SELL_BUY_TP_CD IN ('B', 'C') THEN D.PAY_AMT * -1
					                                                     ELSE D.PAY_AMT 
					                                                END)
					       ELSE 0
					  END AS d_amt,
					  CASE WHEN MAX(M.JNR_TP) IN ('C','V') THEN SUM(CASE WHEN I.SELL_BUY_TP_CD IN ('S', 'D') THEN D.PAY_AMT * -1
					                                                     WHEN I.SELL_BUY_TP_CD IN ('B', 'C') THEN D.PAY_AMT
					                                                     ELSE D.PAY_AMT 
					                                                END)
					       ELSE 0
					  END AS c_amt,
					  (CASE WHEN MAX(M.JNR_TP) IN ('D','B') THEN SUM(CASE WHEN I.SELL_BUY_TP_CD IN ('S', 'D') THEN D.PAY_AMT
					                                                      WHEN I.SELL_BUY_TP_CD IN ('B', 'C') THEN D.PAY_AMT * -1
					                                                      ELSE D.PAY_AMT 
					                                                 END) 
					        ELSE 0 
					   END) - (CASE WHEN MAX(M.JNR_TP) IN ('C','V') THEN SUM(CASE WHEN I.SELL_BUY_TP_CD IN ('S', 'D') THEN D.PAY_AMT * -1
							                                                      WHEN I.SELL_BUY_TP_CD IN ('B', 'C') THEN D.PAY_AMT
							                                                      ELSE D.PAY_AMT 
							                                                 END) 
							        ELSE 0 
							   END) AS t_amt
				FROM TB_JNR_MST M
			JOIN TB_JNR_DTL D ON M.JNR_NO = D.JNR_NO
			LEFT OUTER JOIN TB_INV I ON D.INV_SEQ = I.INV_SEQ AND I.DELT_FLG = 'N'
			RIGHT OUTER JOIN TB_BANK B ON M.BANK_SEQ = B.BANK_SEQ
			   WHERE 1=1
			     AND isnull(M.DELT_FLG,'N') = 'N'
			     AND isnull(D.DELT_FLG,'N') = 'N'
			   <![CDATA[
			     AND M.POST_DT <= #f_deposit_dt#
			     AND (ISNULL(M.CLR_DT,'') = '' OR M.CLR_DT  > #f_deposit_dt#)
			     AND (NOT(ISNULL(M.VOID_YN,'N') = 'Y' AND ISNULL(VOID_DT,'') <=  #f_deposit_dt#) OR  M.BANK_SEQ IS NULL)
			   ]]>
			   	 <isNotEqual property="s_ofc_cd" compareValue="">
				 	AND D.OFC_CD = #s_ofc_cd#
				 </isNotEqual>
			   GROUP BY B.BANK_NM, M.BANK_SEQ, D.OFC_CD, M.JNR_TP, M.JNR_NO   
     		) A                 
	    GROUP BY
	        A.BANK_NM,
	        A.BANK_SEQ
	        <isEqual property="s_ofc_cd" compareValue="">
	        	<isEqual property="f_grp_by_ofc" compareValue="G">
	        		,A.OFC_CD
	        	</isEqual>
	        </isEqual>
	        
	    ORDER BY
	        ORDER_SEQ,
	        A.BANK_NM ASC
	        <isEqual property="s_ofc_cd" compareValue="">
	        	<isEqual property="f_grp_by_ofc" compareValue="G">
	        		,A.OFC_CD
	        	</isEqual>
	        </isEqual>
    </select>
    
    
    
    <!-- Beginning Statement Balance   -->
    <!--   CLEAR DATE 기준으로, FROM 날짜 이전의 모든 DEPOSIT - CHECK + SLIP DEBIT - SLIP CREDIT   -->
    <!--   1.1 JOURNAL 에서 DEPOSIT, CHECK AMOUNT 를 가져온다.    -->
    <select id="calcBankReconciliation1_1" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT
			'1-1' AS TP,
			(ISNULL(SUM((CASE 
							WHEN JNR_TP IN ('D','B') AND MD = 'M' THEN AMT
			                WHEN JNR_TP IN ('C','V') AND MD = 'D' THEN AMT
			                ELSE 0
					      END)), 0) 
			 +	    
			 ISNULL((SELECT INIT_AMT FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#), 0)
			 ) AS DEBIT1_1,
			SUM(
			(CASE
				WHEN JNR_TP IN ('C','V') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('D','B') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS CREDIT1_1
			FROM
			(
				SELECT
				'M' AS MD, JNR_NO, JNR_TP, POST_DT, CLR_YN, CLR_DT, AMT, CURR_CD, P_OFC_CD
				FROM
				TB_JNR_MST
				WHERE 1=1
				<![CDATA[
				AND ISNULL(DELT_FLG,'N') <> 'Y'
				AND (
					(ISNULL(CLR_DT,'') < #s_strdt# AND ISNULL(VOID_YN,'')<>'Y') OR
					(ISNULL(CLR_DT,'') < #s_strdt# AND ISNULL(VOID_DT,'')>#s_strdt#)
				)				
				AND ISNULL(CLR_DT,'') <> ''
				AND BANK_SEQ = #s_bank_cd#
				]]>
				
				/* SDKANG 추가 2014-08-10 */
	            UNION ALL
				
				SELECT
				'D' AS MD, M.JNR_NO, M.JNR_TP, M.POST_DT, M.CLR_YN, M.CLR_DT, D.TTL_PAY_AMT AS  AMT, M.CURR_CD, M.P_OFC_CD
				FROM
				TB_JNR_MST M,
	            TB_JNR_DTL D
				WHERE 1=1
				<![CDATA[
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
	            AND ISNULL(D.DELT_FLG,'N') <> 'Y'
	            AND M.JNR_NO = D.JNR_NO
				AND (
					(ISNULL(M.CLR_DT,'') < #s_strdt# AND ISNULL(M.VOID_YN,'')<>'Y') OR
					(ISNULL(M.CLR_DT,'') < #s_strdt# AND ISNULL(M.VOID_DT,'')>#s_strdt#)
				)				
				AND ISNULL(M.CLR_DT,'') <> ''
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
			) A
    </select>
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation1_2" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation1_2 */
    	/* SLIP 에서 DEBIT, CREDIT 금액을 가져온다. */
    	SELECT
			'1.2' AS TP,
			SUM(TTL_DEBIT) AS DEBIT1_2,
			SUM(TTL_CREDIT) AS CREDIT1_2
			FROM
			(
				SELECT
				M.SLIP_NO, M.SLIP_TP, M.SLIP_2ND_TP, M.POST_DT, M.G_DEBIT, M.G_CREDIT, M.CURR_CD, M.P_OFC_CD,
				D.GL_NO, D.COM_TP, D.COM_CD, D.TTL_DEBIT, D.TTL_CREDIT
				FROM
				TB_SLIP_MST M,
				TB_SLIP_DTL D
				WHERE 1=1
				<![CDATA[
				AND M.SLIP_NO = D.SLIP_NO
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND M.POST_DT < #s_strdt#
				AND ISNULL(M.POST_DT,'') <> ''
				AND M.SLIP_TP = 'SL'
				/* SDKANG 추가 2014-08-10 */
				/* AND D.COM_TP = 'B' */
				/* AND D.COM_CD = s_bank_cd */
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
			) A
    </select>
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation2_1" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation2_1 */
    	/* 2. Total Deposit/Credit (+), Total Check/Debit (-) */
    	/* CLEAR DATE 기준으로, 입력일자 구간의 DEPOSIT + SLIP DEBIT */
    	/* 2-1 JOURNAL 에서 DEPOSIT, CHECK AMOUNT 를 가져온다. */
    	SELECT
			'2-1' AS TP,
			SUM(
			(CASE
				WHEN JNR_TP IN ('D','B') AND MD = 'M' THEN AMT
		        WHEN JNR_TP IN ('C','V') AND MD = 'D' THEN AMT
		        ELSE 0
			END)) AS DEBIT2_1,
			SUM(
			(CASE
				WHEN JNR_TP IN ('C','V') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('D','B') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS CREDIT2_1
			FROM
			(
				SELECT
				'M' AS MD, JNR_NO, JNR_TP, POST_DT, CLR_YN, CLR_DT, AMT, CURR_CD, P_OFC_CD
				FROM
				TB_JNR_MST
				WHERE 1=1
				<![CDATA[
				AND ISNULL(DELT_FLG,'N') <> 'Y'
				AND (
					(ISNULL(CLR_DT,'') BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(VOID_YN,'')<>'Y') OR
					(ISNULL(CLR_DT,'') BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(VOID_YN,'')='Y' AND ISNULL(VOID_DT,'') > #s_enddt#)
				)				
				AND ISNULL(CLR_DT,'') <> ''
				AND BANK_SEQ = #s_bank_cd#
				]]>
				
				/* SDKANG 2014-08-10 */
	            UNION ALL
	            
	            SELECT
				'D' AS MD, M.JNR_NO, M.JNR_TP, M.POST_DT, M.CLR_YN, M.CLR_DT, D.TTL_PAY_AMT AS  AMT, M.CURR_CD, M.P_OFC_CD
				FROM
				TB_JNR_MST M,
				TB_JNR_DTL D
				WHERE 1=1 
				<![CDATA[
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND ISNULL(D.DELT_FLG,'N') <> 'Y'
				AND M.JNR_NO = D.JNR_NO
				AND (
					(ISNULL(M.CLR_DT,'') BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(M.VOID_YN,'')<>'Y') OR
					(ISNULL(M.CLR_DT,'') BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(M.VOID_YN,'')='Y' AND ISNULL(M.VOID_DT,'') > #s_enddt#)
				)				
				AND ISNULL(M.CLR_DT,'') <> ''
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
	            
			) A
    </select>
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation2_2" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation2_2 */
    	/* 2.2 SLIP 에서 DEBIT, CREDIT 금액을 가져온다. */
    	SELECT
			'2-2' AS TP,
			SUM(TTL_DEBIT) AS DEBIT2_2,
			SUM(TTL_CREDIT) AS CREDIT2_2
			FROM
			(
				SELECT
				M.SLIP_NO, M.SLIP_TP, M.SLIP_2ND_TP, M.POST_DT, M.G_DEBIT, M.G_CREDIT, M.CURR_CD, M.P_OFC_CD,
				D.GL_NO, D.COM_TP, D.COM_CD, D.TTL_DEBIT, D.TTL_CREDIT
				FROM
				TB_SLIP_MST M,
				TB_SLIP_DTL D
				WHERE 1=1
				<![CDATA[
				AND M.SLIP_NO = D.SLIP_NO
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND M.POST_DT BETWEEN #s_strdt# AND #s_enddt#
				AND ISNULL(M.POST_DT,'') <> ''
				AND M.SLIP_TP = 'SL'
				/* SDKANG 2014-08-10 */
				/* AND D.COM_TP = 'B' */
				/* AND D.COM_CD = s_bank_cd */
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
			) A
    </select>
    
    
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation4" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation4 */
    	/* 4. Outstanding Deposit/Credit (+), Outstanding Total Check/Debit (-) */
    	/* CLR 안된, 혹은 TO 일자 기준으로 CLR DT 가 큰 자료 */
    	SELECT
			'4' AS TP,
			SUM(
			(CASE
				WHEN JNR_TP IN ('D','B') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('C','V') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS DEBIT4,
			SUM(
			(CASE
				WHEN JNR_TP IN ('C','V') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('D','B') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS CREDIT4
			FROM
			(
				SELECT
				'M' AS MD, JNR_NO, JNR_TP, POST_DT, CLR_YN, CLR_DT, AMT, CURR_CD, P_OFC_CD
				FROM
				TB_JNR_MST
				WHERE 1=1
				<![CDATA[
				AND ISNULL(DELT_FLG,'N') <> 'Y'	
				AND (
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_YN,'') <> 'Y') OR
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_DT,'') > #s_enddt#)
				)				
				AND BANK_SEQ = #s_bank_cd#
				]]>
				
				/* SDKANG 2014-08-10 */
				UNION ALL
				
				SELECT
				'D' AS MD, M.JNR_NO, M.JNR_TP, M.POST_DT, M.CLR_YN, M.CLR_DT, D.TTL_PAY_AMT AS AMT, M.CURR_CD, M.P_OFC_CD
				FROM
				TB_JNR_MST M,
	            TB_JNR_DTL D
				WHERE 1=1
				<![CDATA[
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND ISNULL(D.DELT_FLG,'N') <> 'Y'
				AND M.JNR_NO = D.JNR_NO
				AND (
					(ISNULL(M.POST_DT,'') <= #s_enddt# AND (M.CLR_DT > #s_enddt# OR ISNULL(M.CLR_DT,'') = '') AND ISNULL(M.VOID_YN,'') <> 'Y') OR
					(ISNULL(M.POST_DT,'') <= #s_enddt# AND (M.CLR_DT > #s_enddt# OR ISNULL(M.CLR_DT,'') = '') AND ISNULL(M.VOID_DT,'') > #s_enddt#)
				)	
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)			
				]]>	
	
			) A
    </select>
    
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation6_1" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation6_1 */
    	/* 6. Beginning Book Balance */
    	/* POST DATE 기준으로, FROM 날짜 이전의 모든 DEPOSIT - CHECK + SLIP DEBIT - SLIP CREDIT */
    	/* 6.1 JOURNAL 에서 DEPOSIT, CHECK AMOUNT 를 가져온다. */
    	SELECT
			'6-1' AS TP,
			(ISNULL(SUM((CASE
							 WHEN JNR_TP IN ('D','B') AND MD = 'M' THEN AMT
							 WHEN JNR_TP IN ('C','V') AND MD = 'D' THEN AMT
							 ELSE 0
						 END)), 0)
            +
            ISNULL((SELECT INIT_AMT FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#), 0)
            ) AS DEBIT6_1,
			SUM(
			(CASE
				WHEN JNR_TP IN ('C','V') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('D','B') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS CREDIT6_1
			FROM
			(
				SELECT
				'M' AS MD, JNR_NO, JNR_TP, POST_DT, CLR_YN, CLR_DT, AMT, CURR_CD, P_OFC_CD
				FROM
				TB_JNR_MST
				WHERE 1=1
				<![CDATA[
				AND ISNULL(DELT_FLG,'N') <> 'Y'
				AND (
					(ISNULL(POST_DT,'') < #s_strdt# AND ISNULL(VOID_YN,'')<>'Y') OR
					(ISNULL(POST_DT,'') < #s_strdt# AND ISNULL(VOID_DT,'')>=#s_strdt#)
				)				
				AND ISNULL(POST_DT,'') <> ''
				AND BANK_SEQ = #s_bank_cd#
				]]>
				
				/* SDKANG 2014-08-10 */
				UNION ALL
				
				SELECT
				'D' AS MD, M.JNR_NO, M.JNR_TP, M.POST_DT, M.CLR_YN, M.CLR_DT, D.TTL_PAY_AMT AS AMT, M.CURR_CD, M.P_OFC_CD
				FROM
				TB_JNR_MST M,
				TB_JNR_DTL D
				WHERE 1=1
				<![CDATA[
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND ISNULL(D.DELT_FLG,'N') <> 'Y'
				AND M.JNR_NO = D.JNR_NO
				AND (
					(ISNULL(M.POST_DT,'') < #s_strdt# AND ISNULL(M.VOID_YN,'')<>'Y') OR
					(ISNULL(M.POST_DT,'') < #s_strdt# AND ISNULL(M.VOID_DT,'')>=#s_strdt#)
				)				
				AND ISNULL(M.POST_DT,'') <> ''
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
				
			) A
    </select>
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation6_2" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation6_2 */
    	/* SLIP 에서 DEBIT, CREDIT 금액을 가져온다. */
    	SELECT
			'6.2' AS TP,
			SUM(TTL_DEBIT) AS DEBIT6_2,
			SUM(TTL_CREDIT) AS CREDIT6_2
			FROM
			(
				SELECT
				M.SLIP_NO, M.SLIP_TP, M.SLIP_2ND_TP, M.POST_DT, M.G_DEBIT, M.G_CREDIT, M.CURR_CD, M.P_OFC_CD,
				D.GL_NO, D.COM_TP, D.COM_CD, D.TTL_DEBIT, D.TTL_CREDIT
				FROM
				TB_SLIP_MST M,
				TB_SLIP_DTL D
				WHERE 1=1
				<![CDATA[
				AND M.SLIP_NO = D.SLIP_NO
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND M.POST_DT < #s_strdt#
				AND ISNULL(M.POST_DT,'') <> ''
				AND M.SLIP_TP = 'SL'
				/* SDKANG 2014-08-10 */
				/* AND D.COM_TP = 'B' */
				/* AND D.COM_CD = s_bank_cd */
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
			) A
    </select>
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation7_1" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation7_1 */
    	/* 7. Total Deposit/Credit (+), Total Check/Debit (-) */
    	/* POST DATE 기준으로, 입력일자 구간의 DEPOSIT + SLIP DEBIT */
    	/* 7-1 JOURNAL 에서 DEPOSIT, CHECK AMOUNT 를 가져온다. */
    	SELECT
			'7-1' AS TP,
			SUM(
			(CASE
				WHEN JNR_TP IN ('D','B') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('C','V') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS DEBIT7_1,
			SUM(
			(CASE
				WHEN JNR_TP IN ('C','V') AND MD = 'M' THEN AMT
				WHEN JNR_TP IN ('D','B') AND MD = 'D' THEN AMT
				ELSE 0
			END)) AS CREDIT7_1
			FROM
			(
			    <![CDATA[
				SELECT
				'M' AS MD, JNR_NO, JNR_TP, POST_DT, CLR_YN, CLR_DT, 
				(CASE WHEN ISNULL(VOID_YN,'')='Y' AND (POST_DT < #s_strdt# OR  POST_DT > #s_enddt#)
				      THEN AMT*-1 
				      ELSE AMT 
				 END) AS AMT,
				CURR_CD, P_OFC_CD
				FROM
				TB_JNR_MST
				WHERE 1=1
				AND ISNULL(DELT_FLG,'N') <> 'Y'
				AND (
					(POST_DT BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(VOID_YN,'')<>'Y') OR
					(POST_DT BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(VOID_DT,'00000000') > #s_enddt#) OR
					((POST_DT < #s_strdt# OR  POST_DT > #s_enddt#) AND ISNULL(VOID_DT,'99999999') BETWEEN  #s_strdt# AND #s_enddt#)
				)				
				AND ISNULL(POST_DT,'') <> ''
				AND BANK_SEQ = #s_bank_cd#
				]]>
				
				/* SDKANG 2014-08-10 */
				UNION ALL
				
				<![CDATA[
				SELECT
				'D' AS MD, M.JNR_NO, M.JNR_TP, M.POST_DT, M.CLR_YN, M.CLR_DT,
				(CASE WHEN ISNULL(M.VOID_YN,'')='Y' AND (M.POST_DT < #s_strdt# OR  M.POST_DT > #s_enddt#)
				      THEN D.TTL_PAY_AMT*-1
					  ELSE D.TTL_PAY_AMT
				 END) AS AMT,
	            M.CURR_CD, M.P_OFC_CD
				FROM
				TB_JNR_MST M,
				TB_JNR_DTL D 
				WHERE 1=1
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND ISNULL(D.DELT_FLG,'N') <> 'Y'
				AND M.JNR_NO = D.JNR_NO
				AND (
					(M.POST_DT BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(M.VOID_YN,'')<>'Y') OR
					(M.POST_DT BETWEEN #s_strdt# AND #s_enddt# AND ISNULL(M.VOID_DT,'00000000') > #s_enddt#) OR
					((M.POST_DT < #s_strdt# OR  M.POST_DT > #s_enddt#) AND ISNULL(M.VOID_DT,'99999999') BETWEEN  #s_strdt# AND #s_enddt#)
				)				
				AND ISNULL(M.POST_DT,'') <> ''
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
	
			) A
    </select>
    
    
    <!-- Beginning Statement Balance   -->
    <select id="calcBankReconciliation7_2" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > calcBankReconciliation7_2 */
    	/* 7.2 SLIP 에서 DEBIT, CREDIT 금액을 가져온다. */
    	SELECT
			'7-2' AS TP,
			SUM(TTL_DEBIT) AS DEBIT7_2,
			SUM(TTL_CREDIT) AS CREDIT7_2
			FROM
			(
				SELECT
				M.SLIP_NO, M.SLIP_TP, M.SLIP_2ND_TP, M.POST_DT, M.G_DEBIT, M.G_CREDIT, M.CURR_CD, M.P_OFC_CD,
				D.GL_NO, D.COM_TP, D.COM_CD, D.TTL_DEBIT, D.TTL_CREDIT
				FROM
				TB_SLIP_MST M,
				TB_SLIP_DTL D
				WHERE 1=1
				<![CDATA[
				AND M.SLIP_NO = D.SLIP_NO
				AND ISNULL(M.DELT_FLG,'N') <> 'Y'
				AND M.POST_DT BETWEEN #s_strdt# AND #s_enddt#
				AND ISNULL(M.POST_DT,'') <> ''
				AND M.SLIP_TP = 'SL'
				/* SDKANG 2014-08-10 */
				/* AND D.COM_TP = 'B' */
				/* AND D.COM_CD = s_bank_cd */
				AND D.GL_NO = (SELECT GL_CD FROM TB_BANK WHERE BANK_SEQ = #s_bank_cd#)
				]]>
			) A
    </select>
    
    
    <!-- Bank Reconciliation  Deposit And Credits 조회  -->
    <select id="searchDepositAndCreditsList" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchDepositNCreditsList */
    	/* 1. DEPOSIT AND CREDITS */
			<![CDATA[
			SELECT M.POST_DT
			     , M.CHK_NO
			     , M.RCVD_FM_NM
			     , M.CURR_CD
			     , M.AMT
			     , M.P_OFC_CD
			     , M.CLR_YN
			     , M.CLR_DT
			     , ISNULL(M.VOID_YN, 'N') AS VOID_YN
			     , M.VOID_DT
			  FROM TB_JNR_MST M
			 WHERE 1=1
			   AND ISNULL(DELT_FLG,'N') <> 'Y'	
			   AND (
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_YN,'') <> 'Y') OR
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_DT,'') > #s_enddt#)
				)				
				AND BANK_SEQ = #s_bank_cd#
				AND M.JNR_TP IN ('D','B')
			   ]]>   	
    </select>
    
    
    <!-- Bank Reconciliation Checks And Debits 조회  -->
    <select id="searchChecksAndDebitsList" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchChecksAndDebitsList */
    	/* 2. CHECKS AND DEBITS  */
		<![CDATA[
			SELECT M.POST_DT
			     , M.CHK_NO
			     , (SELECT LOCL_NM
			          FROM TB_TRDP
			         WHERE TRDP_CD = M.PAYTO_CD) AS PAYTO_NM
			     , M.CURR_CD
			     , M.AMT
			     , M.P_OFC_CD
			     , M.CLR_YN
			     , M.CLR_DT
			     , ISNULL(M.VOID_YN, 'N') AS VOID_YN
			     , M.VOID_DT
			  FROM TB_JNR_MST M
			 WHERE 1=1
			   AND ISNULL(DELT_FLG,'N') <> 'Y'	
			   AND (
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_YN,'') <> 'Y') OR
					(ISNULL(POST_DT,'') <= #s_enddt# AND (CLR_DT > #s_enddt# OR ISNULL(CLR_DT,'') = '') AND ISNULL(VOID_DT,'') > #s_enddt#)
				)				
				AND BANK_SEQ = #s_bank_cd#
				AND M.JNR_TP IN ('C','V')
    	]]> 
    </select>
    
    
    <!-- Tax Bill Deposit InvoiceList 조회  -->
    <select id="searchTAX_INV_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchTAX_INV_LIST */
    	SELECT  MAX(inv_mst.INV_DT)				AS inv_post_dt
		       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)+MAX(inv_mst.BND_CLSS_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(inv_mst.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_mst.BUY_INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(inv_mst.INV_APLY_CURR_CD)   AS inv_aply_curr_cd
		       ,MAX(inv_mst.INV_APLY_XCRT)		AS inv_aply_xcrt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_mst.INV_SUM_AMT)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_mst.INV_SUM_AMT) * -1
		        END								AS inv_sum_amt	
			   
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_mst.BAL_AMT),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_mst.BAL_AMT),0) * -1
		        END								AS bal_sum_amt
		        
		       ,MAX(inv_mst.cmb_inv_seq)	    AS inv_seq
		       ,MAX(inv_mst.inv_no)				AS inv_no
		       ,MAX(inv_mst.trdp_cd)			AS trdp_cd

		       ,CASE WHEN isnull(MAX(inv_mst.BAL_AMT),0) = 0 THEN '1'
		             ELSE '0'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		  FROM TB_CMB_INV inv_mst
		 WHERE inv_mst.TRDP_CD = #s_cust_cd#
		   <isNotEmpty property="f_curr_cd">
		   AND inv_mst.INV_APLY_CURR_CD = #f_curr_cd#
		   </isNotEmpty>
		   AND inv_mst.BAL_AMT != 0
		   <isNotEmpty property="s_inv_no">
		       AND inv_mst.INV_NO = #s_inv_no#	
		   </isNotEmpty>
		   <isNotEmpty property="s_v_inv_no">
		       AND inv_mst.BUY_INV_NO = #s_v_inv_no#	
		   </isNotEmpty>
		   <isEqual property="dept_chk1" compareValue="Y">
		       <isEqual property="dept_chk2" compareValue="Y">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
		       	   </isEqual>
		       </isEqual>
		       <isEqual property="dept_chk2" compareValue="N">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
		       	   </isEqual>
		       </isEqual>	    		
		   </isEqual>
		   
		   <isEqual property="dept_chk1" compareValue="N">
		       <isEqual property="dept_chk2" compareValue="Y">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
		       	   </isEqual>
		       </isEqual>
		       <isEqual property="dept_chk2" compareValue="N">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('')
		       	   </isEqual>
		       </isEqual>	    		
		   </isEqual>
		 GROUP BY inv_mst.CMB_INV_SEQ     
     
    </select>
    
    
    
    
    <!-- TAX BILL 생성된 DEPOSIT JOURNAL InvoiceList 조회  -->
    <select id="searchTAX_INV_JNR_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchTAX_INV_JNR_LIST */
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)+MAX(inv_mst.BND_CLSS_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_mst.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(jnr_dtl.REF_NO)				AS ref_no
		       ,MAX(jnr_dtl.BL_NO)				AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_mst.inv_sum_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_mst.inv_sum_amt) * -1
		             ELSE MAX(inv_mst.inv_sum_amt)
		        END								AS inv_sum_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_mst.BAL_AMT),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_mst.BAL_AMT),0) * -1
		             ELSE isnull(MAX(inv_mst.BAL_AMT),0)
		        END								AS bal_sum_amt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE MAX(jnr_dtl.pay_amt)
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             ELSE MAX(jnr_dtl.ttl_pay_amt)
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             ELSE MAX(jnr_dtl.ttl_pay_amt)
		        END								AS old_pay_amt	
		          
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_mst.cmb_inv_seq)		AS inv_seq
		       ,MAX(inv_mst.inv_no)				AS inv_no
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_mst.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) as CLT_CMPL_FLG
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N' AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_CMB_INV inv_mst          
            	ON jnr_dtl.INV_NO = inv_mst.INV_NO AND jnr_dtl.INV_SEQ = inv_mst.CMB_INV_SEQ
            LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
            	ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1            
		 WHERE jnr_mst.jnr_no = #f_jnr_no#
		 <isNotEmpty property="f_jnr_tp">
		   AND jnr_mst.jnr_tp = #f_jnr_tp#
		 </isNotEmpty>
		   AND jnr_mst.level = '1'
		 GROUP BY jnr_dtl.JNR_SEQ
		 
    </select>
    
    
    <!-- Tax Bill Journal Detail 정보를 UPDATE 한다.   -->
    <update id="upateTaxInvDtl" parameterClass="InvJorVO">
    	UPDATE TB_CMB_INV
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) + #ttl_pay_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) - #ttl_pay_amt#
		 WHERE INV_NO = #inv_no#  
		 <isNotEmpty property="inv_seq">
		 	AND cmb_inv_seq = #inv_seq#
		 </isNotEmpty>
    </update>
    
    
    
    <!-- Tax Bill Journal Detail 정보를 UPDATE 한다. VOID CHECK 용  -->
    <update id="upateTaxInvDtlVoidCheck" parameterClass="InvJorVO">
    	UPDATE TB_CMB_INV
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #ttl_pay_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #ttl_pay_amt#
		 WHERE INV_NO = #inv_no#    
		   <isNotEmpty property="inv_seq">
		 	AND cmb_inv_seq = #inv_seq#
		 </isNotEmpty>
    </update>
    
    
    <!-- Tax Bill INVOICE CLEAR 정보를 UPDATE 한다.   -->
    <update id="upateTAX_CLR_INV_STS" parameterClass="InvJorVO">
    	UPDATE TB_CMB_INV
    	   SET inv_sts_cd   = #inv_sts_cd#
    	 WHERE inv_no = #inv_no#
    	   <isNotEmpty property="inv_seq">
		 	AND cmb_inv_seq = #inv_seq#
		 </isNotEmpty>
    </update>
    
    
    <!-- TAX BILL Journal Detail 정보를 UPDATE 한다. VOID CHECK 후 DELETE 함  -->
    <update id="upateTaxInvDtlInvSts" parameterClass="InvJorVO">
    	UPDATE TB_CMB_INV
		   SET INV_STS_CD	= #inv_sts_cd#
		 WHERE INV_NO = #inv_no#    
		   <isNotEmpty property="inv_seq">
		 	AND cmb_inv_seq = #inv_seq#
		 </isNotEmpty>
    </update>
    
    
    <!-- Tax Bill Check InvoiceList 조회  -->
    <select id="searchTAX_CHK_INV_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchTAX_CHK_INV_LIST */
    	SELECT  MAX(inv_mst.INV_DT)				AS inv_post_dt
		       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)+MAX(inv_mst.BND_CLSS_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(inv_mst.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_mst.BUY_INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(inv_mst.INV_APLY_CURR_CD)   AS inv_aply_curr_cd
		       ,MAX(inv_mst.INV_APLY_XCRT)		AS inv_aply_xcrt
		       
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_mst.INV_SUM_AMT) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_mst.INV_SUM_AMT) 
		        END								AS inv_sum_amt	
			   
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_mst.BAL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_mst.BAL_AMT),0)
		        END								AS bal_sum_amt

		       ,MAX(inv_mst.cmb_inv_seq)		AS inv_seq
		       ,MAX(inv_mst.inv_no)				AS inv_no
		       ,MAX(inv_mst.trdp_cd)			AS trdp_cd

		       ,CASE WHEN isnull(MAX(inv_mst.BAL_AMT),0) = 0 THEN '1'
		             ELSE '0'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		  FROM TB_CMB_INV inv_mst
		 WHERE inv_mst.TRDP_CD = #s_cust_cd#
		   <isNotEmpty property="f_curr_cd">
		   AND inv_mst.INV_APLY_CURR_CD = #f_curr_cd#
		   </isNotEmpty>
		   AND inv_mst.BAL_AMT != 0
		   <isNotEmpty property="s_inv_no">
		       AND inv_mst.BUY_INV_NO = #s_inv_no#	
		   </isNotEmpty>
		   <isEqual property="dept_chk1" compareValue="Y">
		       <isEqual property="dept_chk2" compareValue="Y">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
		       	   </isEqual>
		       </isEqual>
		       <isEqual property="dept_chk2" compareValue="N">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
		       	   </isEqual>
		       </isEqual>	    		
		   </isEqual>
		   
		   <isEqual property="dept_chk1" compareValue="N">
		       <isEqual property="dept_chk2" compareValue="Y">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
		       	   </isEqual>
		       </isEqual>
		       <isEqual property="dept_chk2" compareValue="N">
		       	   <isEqual property="dept_chk3" compareValue="Y">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
		       	   </isEqual>
		       	   <isEqual property="dept_chk3" compareValue="N">
		       	   	   AND inv_mst.sell_buy_tp_cd IN('')
		       	   </isEqual>
		       </isEqual>	    		
		   </isEqual>
		 GROUP BY inv_mst.CMB_INV_SEQ     
     
    </select>
    
    
    
    <!-- 생성된 TAX BILL CHECK JOURNAL InvoiceList 조회  -->
    <select id="searchTAX_CHK_INV_JNR_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchTAX_CHK_INV_JNR_LIST */
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)+MAX(inv_mst.BND_CLSS_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_mst.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_mst.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(jnr_dtl.REF_NO)				AS ref_no
		       ,MAX(jnr_dtl.BL_NO)				AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_mst.inv_sum_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_mst.inv_sum_amt) 
		             ELSE MAX(inv_mst.inv_sum_amt) 
		        END								AS inv_sum_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_mst.BAL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_mst.BAL_AMT),0)
		             ELSE isnull(MAX(inv_mst.BAL_AMT),0)
		        END								AS bal_sum_amt
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS old_pay_amt
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_mst.cmb_inv_seq)		AS inv_seq
		       ,MAX(inv_mst.inv_no)				AS inv_no
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_mst.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N' AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_CMB_INV inv_mst          
            	ON jnr_dtl.INV_NO = inv_mst.INV_NO AND jnr_dtl.INV_SEQ = inv_mst.CMB_INV_SEQ
            LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
            	ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
		 WHERE jnr_mst.jnr_no = #f_jnr_no#
		 <isNotEmpty property="f_jnr_tp">
		   AND jnr_mst.jnr_tp = #f_jnr_tp#
		 </isNotEmpty>
		   AND jnr_mst.level = '1'
		 GROUP BY jnr_dtl.JNR_SEQ
		 
    </select>
    
    
    
    
    <!-- Tax Bill Deposit Journal List 조회  -->
    <select id="searchTAX_JNR_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchTAX_JNR_LIST */
    	SELECT mst.post_dt
		      ,mst.rcvd_fm_nm
		      ,mst.chk_no
		      ,(SELECT bk.BANK_NM FROM TB_BANK bk WHERE mst.bank_seq = bk.bank_seq) AS bank_seq
		      ,mst.amt
		      ,mst.curr_cd
		      ,mst.clr_yn
		      ,mst.clr_dt
		      ,mst.void_yn
		      ,mst.void_dt
		      ,mst.p_ofc_cd
		      ,mst.rgst_usrid
		      ,mst.jnr_no
		      ,mst.trdp_cd
		      ,ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG) AS CLT_CMPL_FLG
		  FROM TB_JNR_MST mst
		  LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		  	ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		 WHERE mst.DELT_FLG = 'N'
		   AND JNR_TP = 'B'
		   AND LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEqual property="s_amt_fr" compareValue="0">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEqual>
	  ORDER BY mst.post_dt desc, mst.jnr_no desc
    </select>
    
    
    
    <!-- Tax Bill Check Journal List 조회  -->
    <select id="searchTAX_CHK_JNR_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchTAX_CHK_JNR_LIST */
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,(select eng_nm from tb_trdp x where x.trdp_cd = MAX(mst.trdp_cd) and delt_flg = 'N') AS trdp_nm
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		  FROM TB_JNR_MST mst
	LEFT JOIN  TB_JNR_DTL dtl ON mst.JNR_NO = dtl.JNR_NO
	LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND mst.JNR_TP = 'V'
		   AND mst.LEVEL  = '1'
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_vendor_cd">
		 	AND mst.TRDP_CD = #s_vendor_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEqual property="s_amt_fr" compareValue="0">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEqual>
	  GROUP BY mst.JNR_NO
	  ORDER BY post_dt desc, jnr_no desc
	   
    </select>
    
    
    
    <!-- TAX BILL Journal Detail 정보를 UPDATE 한다. VOID CHECK 용  -->
    <update id="upateTaxInvDtlJnrDelete" parameterClass="InvJorVO">
    	UPDATE TB_CMB_INV
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= isnull(pay_amt,0) - #ttl_pay_amt#
		      ,BAL_AMT		= isnull(bal_amt,0) + #ttl_pay_amt#
		 WHERE INV_NO = #inv_no#  
		   <isNotEmpty property="inv_seq">
		   	   AND cmb_inv_seq = #inv_seq#
		   </isNotEmpty>
    </update>
    
    
    
    <!-- TAX BILL Journal Detail List 조회  -->
    <select id="searchTAX_JNR_DTL_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
    	SELECT  jnr_dtl.inv_no
    		   ,jnr_dtl.pay_amt	
    	 	   ,jnr_dtl.ttl_pay_amt
    	 	   ,jnr_dtl.curr_cd
    	 	   ,inv_mst.cmb_inv_seq AS inv_seq
    	 	   ,inv_mst.sell_buy_tp_cd
    	  FROM TB_JNR_DTL jnr_dtl
	      JOIN TB_CMB_INV inv_mst ON jnr_dtl.INV_NO  = inv_mst.INV_NO  AND jnr_dtl.inv_seq = inv_mst.cmb_inv_seq
    	 WHERE jnr_dtl.JNR_NO = #jnr_no#
    	   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N' 
    </select>
    
    
    <!-- INVOICE의 연결된 JOURNAL중 가장큰 POST_DT를 가져온다.   -->
    <select id="selectMaxPostDate" parameterClass="InvJorVO" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > selectMaxPostDate */
    	SELECT
			'$inv_seq$' AS INV_SEQ,
			POST_DT AS LAST_PAY_DT,
			CHK_NO AS LAST_CHK_NO
		FROM
			TB_JNR_MST
		WHERE
			JNR_NO = 
			(
				SELECT TOP 1 M.JNR_NO
				FROM
				TB_JNR_MST M,
				TB_JNR_DTL D
				WHERE 1=1
				AND M.JNR_NO = D.JNR_NO
				AND ISNULL(M.DELT_FLG,'N') = 'N'
				AND ISNULL(D.DELT_FLG,'N') = 'N'
				AND ISNULL(M.VOID_YN,'N') = 'N'
				AND D.INV_SEQ = CAST('$inv_seq$' AS VARCHAR)
				ORDER BY M.POST_DT DESC, M.MODI_TMS DESC
			)
    </select>
    
    
    
    
    <!-- INVOICE의 연결된 JOURNAL중 가장큰 POST_DT를 가져온다.   -->
    <select id="selectJnrMaxPostDate" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > selectJnrMaxPostDate */
    	SELECT
			#inv_seq# AS INV_SEQ,
			POST_DT AS LAST_PAY_DT,
			CHK_NO AS LAST_CHK_NO
		FROM
			TB_JNR_MST
		WHERE
			JNR_NO = 
			(
				SELECT TOP 1 M.JNR_NO
				FROM
				TB_JNR_MST M,
				TB_JNR_DTL D
				WHERE 1=1
				AND M.JNR_NO = D.JNR_NO
				AND ISNULL(M.DELT_FLG,'N') = 'N'
				AND ISNULL(D.DELT_FLG,'N') = 'N'
				AND ISNULL(M.VOID_YN,'N') = 'N'
				AND D.INV_SEQ = #inv_seq#
				AND D.JNR_NO != #jnr_no#
				ORDER BY M.POST_DT DESC, M.MODI_TMS DESC
			)
    </select>
    
    
    <!-- INVOICE의 LAST_PAID_DT와 LAST_CHK_NO를 UPDATE 한다.   -->
    <update id="updateInvLastInfo" parameterClass="java.util.HashMap">
    	UPDATE TB_INV_DTL
		   SET LAST_PAY_DT  = #last_pay_dt#
		      ,LAST_CHK_NO  = #last_chk_no#
			    ,modi_tms			= GETUTCDATE()
		 WHERE inv_seq = #inv_seq#
    </update>
    
    <!-- INVOICE의 LAST_PAID_DT와 LAST_CHK_NO를 UPDATE 한다.   -->
    <update id="updateJnrInvLastInfo" parameterClass="java.util.HashMap">
    	UPDATE TB_INV_DTL
		   SET LAST_PAY_DT  = #last_pay_dt#
		      ,LAST_CHK_NO  = #last_chk_no#
		      ,INV_STS_CD	= #inv_sts_cd#
			    ,modi_tms			= GETUTCDATE()
		 WHERE inv_seq = #inv_seq#
    </update>
    
    
    <select id="searchBankChkForm" parameterClass="java.util.HashMap" resultClass="String">
    	SELECT   chk_form
    	  FROM TB_BANK
    	 WHERE bank_seq = #bank_seq#
    </select>
    
    <select id="searchBankCurChkNo" parameterClass="java.util.HashMap" resultClass="String">
    	SELECT   cur_chk_no + '@' + lst_chk_no
    	  FROM TB_BANK
    	 WHERE bank_seq = #bank_seq#
    </select>
    
    <update id="increaseBankCurChkNo" parameterClass="java.util.HashMap">
    	UPDATE TB_BANK
		   SET   cur_chk_no  = cur_chk_no + 1
		WHERE  bank_seq = #bank_seq#
    </update>
    
    <!-- Payment 조회   -->
    <select id="searchPaymentByBankCheck" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchPaymentByBankCheck */
    	SELECT mst.POST_DT
			      ,mst.TRDP_CD
			      ,(SELECT x.ENG_NM FROM TB_TRDP x WHERE x.TRDP_CD = mst.TRDP_CD) AS TRDP_NM
			      ,mst.CHK_NO
			      ,mst.CURR_CD
			      ,mst.AMT AS pay_amt
			      ,mst.AMT
			      ,mst.CLR_YN
			      ,mst.CLR_DT
			      ,mst.JNR_NO
			      ,mst.JNR_TP
			      ,mst.BANK_SEQ
			      ,mst.P_OFC_CD
		  FROM TB_JNR_MST mst
		 WHERE 1 = 1
		 AND mst.DELT_FLG = 'N'
		    AND mst.VOID_YN  = 'N'
		    AND mst.JNR_TP   IN('C','V')
			AND mst.BANK_SEQ = #bank_seq#
			AND mst.CHK_NO = #chk_no#
    </select>
    
    <!-- Bank Balance CLEAR By Excel 처리   -->
    <update id="updateBankBalClrByExl" parameterClass="JournalVO">
    	UPDATE TB_JNR_MST
    	   SET CLR_YN       = 'Y'
    	      ,CLR_DT       = #deposit_dt#
    	      ,BANK_SEQ		= #bank_seq#
    	      ,MODI_OFC_CD	= #proc_ofccd#
		      ,MODI_USRID	= #proc_usrid#
		      ,MODI_TMS		= GETUTCDATE()
    	 WHERE jnr_no = #jnr_no#
    	     AND jnr_tp = #jnr_tp#
    </update>




    <!-- Payment History   -->
    <select id="searchPaymentHistory" parameterClass="java.util.HashMap" resultClass="JournaHistoryVO">
/* AccJorJournalSQL.xml > searchPaymentHistory */
<![CDATA[
SELECT DENSE_RANK() over (order by inv_aply_curr_cd asc, inv_dt desc, trdp_nm asc, dept_nm asc, inv_tp asc, inv_seq asc) as rnum,        
       z.* 
  FROM (
SELECT inv_dtl.inv_dt, 
       inv_dtl.inv_due_dt,
       
 		CASE
	 		WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
	 			 THEN (select locl_nm from tb_trdp where trdp_cd = inv_mst.trdp_cd)
		 	ELSE 	  (select eng_nm from tb_trdp where trdp_cd = inv_mst.trdp_cd)
 		END AS trdp_nm,
	   			 
       inv_mst.inv_dept_cd as dept_nm,
       CASE WHEN inv_mst.sell_buy_tp_cd = 'S' THEN 'A/R'
             WHEN inv_mst.sell_buy_tp_cd = 'D' THEN 'DEBIT'
             WHEN inv_mst.sell_buy_tp_cd = 'C' THEN 'CREDIT'
             WHEN inv_mst.sell_buy_tp_cd = 'B' THEN 'A/P'
       END AS inv_tp,
       CASE WHEN inv_mst.sell_buy_tp_cd = 'B' THEN inv_dtl.buy_inv_no
             ELSE inv_dtl.inv_no
       END AS inv_no,
       CASE WHEN isnull(frt.intg_bl_seq,'') != '' THEN bl.ref_no
            WHEN isnull(frt.oth_seq,'') != '' THEN oth.ref_no
       END AS ref_no,
       bl.bl_no AS bl_no,
       inv_dtl.inv_aply_curr_cd AS inv_aply_curr_cd,
       inv_dtl.inv_seq,
       /* OFVFOUR-6967 [STAR MEX] OPUS PAYMENT LV2 HISTORY - TAX INVOICE NO 칼럼 추가 (Zen4494) */
       inv_mst.TAX_NO AS tax_no, 
       (CASE WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.inv_sum_amt
			                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.inv_sum_amt * -1
			                                             ELSE inv_dtl.inv_sum_amt
			                                        END)
		     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.inv_sum_amt * -1
					                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.inv_sum_amt
					                                     ELSE inv_dtl.inv_sum_amt 
					                                END) 
		     ELSE (
													CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.inv_sum_amt
			                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.inv_sum_amt * -1
			                                             ELSE inv_dtl.inv_sum_amt
			                                        END		     
		     )
         END) AS inv_sum_amt,
       (CASE WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.bal_amt
			                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.bal_amt * -1
			                                             ELSE inv_dtl.bal_amt
			                                        END)
		     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.bal_amt * -1
					                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.bal_amt
					                                     ELSE inv_dtl.bal_amt
					                                END) 
		    ELSE (
													CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.bal_amt
			                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.bal_amt * -1
			                                             ELSE inv_dtl.bal_amt
			                                        END		    
		    )
        END) AS bal_sum_amt,
       (CASE WHEN jnr_mst.void_yn = 'Y' THEN null
             WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN jnr_dtl.pay_amt
			                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN jnr_dtl.pay_amt * -1
			                                             ELSE jnr_dtl.pay_amt
			                                        END)
		     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN jnr_dtl.pay_amt * -1
					                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN jnr_dtl.pay_amt
					                                     ELSE jnr_dtl.pay_amt 
					                                END) 
		     ELSE 0
        END) AS pay_amt,  
       jnr_mst.post_dt,
       (select x.bank_nm from tb_bank x where x.bank_seq = jnr_mst.bank_seq) as bank_nm,
       jnr_mst.chk_no,
       jnr_mst.clr_dt,
       jnr_mst.void_dt,
       RANK() OVER(partition by inv_dtl.inv_seq ORDER BY frt.FRT_SEQ) AS rank_no
  FROM TB_INV inv_mst
       JOIN TB_INV_DTL inv_dtl ON inv_mst.inv_seq = inv_dtl.inv_seq and inv_dtl.delt_flg = 'N'
       JOIN TB_FRT frt ON inv_dtl.INV_SEQ = frt.INV_SEQ AND frt.delt_flg = 'N'
       LEFT JOIN TB_INTG_BL bl ON frt.intg_bl_seq = bl.intg_bl_seq AND bl.delt_flg = 'N'
       LEFT JOIN TB_OTH_SALES oth ON frt.oth_seq = oth.oth_seq AND oth.delt_flg = 'N'
       LEFT JOIN TB_JNR_DTL jnr_dtl ON jnr_dtl.inv_seq = inv_dtl.inv_seq  AND isnull(jnr_dtl.delt_flg,'N') = 'N'
       LEFT JOIN TB_JNR_MST jnr_mst ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.delt_flg,'N') = 'N'
 WHERE isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
   AND inv_mst.DELT_FLG = 'N'
]]>
   <isNotEmpty property="f_ofc_cd">
   	   AND inv_mst.ofc_cd = #f_ofc_cd#
   </isNotEmpty>
   
   <isNotEmpty property="f_start_date">
	   <isEqual property="f_date_flag" compareValue="A">
	   	   AND inv_dtl.inv_dt between #f_start_date# and #f_end_date#
	   </isEqual>
	   <isEqual property="f_date_flag" compareValue="B">
	   	   AND inv_dtl.inv_due_dt between #f_start_date# and #f_end_date#
	   </isEqual>
	   <isEqual property="f_date_flag" compareValue="C">
	   	   AND jnr_mst.post_dt between #f_start_date# and #f_end_date#
	   </isEqual>
   </isNotEmpty>
   
   AND inv_mst.air_sea_clss_cd != 'G'
   
   AND ( 1=2
   <isEqual property="f_sell_buy_tp_cd_s" compareValue="A">
   	   OR inv_mst.sell_buy_tp_cd = 'S'
   </isEqual>
   <isEqual property="f_sell_buy_tp_cd_b" compareValue="A">
   	   OR inv_mst.sell_buy_tp_cd = 'B'
   </isEqual>
   <isEqual property="f_sell_buy_tp_cd_d" compareValue="A">
   	   OR inv_mst.sell_buy_tp_cd = 'D'
   </isEqual>
      <isEqual property="f_sell_buy_tp_cd_c" compareValue="A">
   	   OR inv_mst.sell_buy_tp_cd = 'C'
   </isEqual>
      )

   AND ( 1=2
   <isEqual property="f_dpt_tp_1" compareValue="A">
   	   OR inv_mst.inv_dept_cd  = 'OTH'
   </isEqual>
   <isEqual property="f_dpt_tp_2" compareValue="A">
   	   OR inv_mst.inv_dept_cd IN ('AOM', 'AOH')
   </isEqual>
   <isEqual property="f_dpt_tp_3" compareValue="A">
   	   OR inv_mst.inv_dept_cd IN ('AIM', 'AIH')
   </isEqual>
   <isEqual property="f_dpt_tp_4" compareValue="A">
   	   OR inv_mst.inv_dept_cd IN ('SOM', 'SOH')
   </isEqual>
   <isEqual property="f_dpt_tp_5" compareValue="A">
   	   OR inv_mst.inv_dept_cd IN ('SIM', 'SIH')
   </isEqual>
   )

   <isNotEmpty property="f_inv_aply_curr_cd">
   	   AND inv_dtl.inv_aply_curr_cd = #f_inv_aply_curr_cd#
   </isNotEmpty>
   
   <isEqual property="s_cust_flag" compareValue="A">
	   <isNotEmpty property="f_trdp_cd">
	   	   AND inv_mst.trdp_cd = #f_trdp_cd#
	   </isNotEmpty>
   </isEqual>
   <isEqual property="s_cust_flag" compareValue="B">
	   <isNotEmpty property="f_grp_id_cd">
	   	   AND EXISTS (SELECT 'X' FROM TB_TRDP X WHERE X.GRP_ID_CD = #f_grp_id_cd# AND X.TRDP_CD = inv_mst.trdp_cd)
	   </isNotEmpty>
   </isEqual>

   <isEqual property="s_inv_sts_cd" compareValue="O">
		AND inv_dtl.INV_STS_CD != 'IE'
		AND inv_dtl.BAL_AMT != 0
   </isEqual>
) Z
WHERE rank_no = 1
order by inv_aply_curr_cd asc, inv_dt desc, trdp_nm asc, dept_nm asc, inv_tp asc, inv_no asc, post_dt asc
    </select>

   
	<!-- Payment History Level 2 -->
    <select id="searchPaymentHistoryLev2" parameterClass="java.util.HashMap" resultClass="JournaHistoryVO">
		/* AccJorJournalSQL.xml > searchPaymentHistoryLev2 */
		<![CDATA[
		SELECT  (CASE WHEN num = 1 THEN amt
		              ELSE 0
		         END) AS sub_total_amt  
		       ,z.* 
		  FROM (
		SELECT RANK()  OVER(partition by jnr_mst.bank_seq, jnr_mst.jnr_no order by jnr_mst.bank_seq asc, jnr_mst.jnr_no asc, jnr_dtl.jnr_seq asc) AS num,
		       jnr_mst.bank_seq,
		       jnr_mst.post_dt,
		       CASE WHEN jnr_mst.JNR_TP = 'D' THEN 'Deposit'
		             WHEN jnr_mst.JNR_TP = 'C' THEN 'Payment'
		       END AS jnr_tp,
		       bank.bank_nm as bank_nm,
		       jnr_mst.p_ofc_cd,
		       
	   			CASE
				 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
				 		 THEN trdp.locl_nm
		 		 	ELSE 	  trdp.eng_nm
	   			END AS trdp_nm,
		       
		       (CASE WHEN ISNULL(jnr_mst.chk_no, '') = '' THEN ' ' ELSE jnr_mst.chk_no END) AS chk_no,
		       jnr_mst.jnr_no,
		       jnr_mst.amt,
		       jnr_mst.curr_cd,
		       (CASE WHEN LEN(ISNULL(jnr_mst.clr_dt, '')) = 8 
		             THEN substring(jnr_mst.clr_dt, 5, 2) + '-' + substring(jnr_mst.clr_dt, 7, 2) + '-' + substring(jnr_mst.clr_dt, 1, 4)
		             ELSE ' ' 
		        END)  AS clr_dt,
		       (CASE WHEN LEN(ISNULL(jnr_mst.void_dt, '')) = 8 
		             THEN substring(jnr_mst.void_dt, 5, 2) + '-' + substring(jnr_mst.void_dt, 7, 2) + '-' + substring(jnr_mst.void_dt, 1, 4)
		             ELSE ' '
		        END) AS void_dt,
		       CASE WHEN inv_mst.sell_buy_tp_cd = 'B' THEN inv_dtl.buy_inv_no
		             ELSE inv_dtl.inv_no
		       END AS inv_no,       
		       jnr_dtl.post_dt AS inv_post_dt,
		       inv_dtl.inv_dt, 
       		   inv_dtl.inv_due_dt,
       		   inv_dtl.inv_aply_curr_cd,
		       jnr_dtl.ofc_cd,
		       /* OFVFOUR-6967 [STAR MEX] OPUS PAYMENT LV2 HISTORY - TAX INVOICE NO 칼럼 추가 (Zen4494) */
		       inv_mst.TAX_NO AS tax_no,
		       CASE WHEN inv_mst.sell_buy_tp_cd = 'S' AND inv_mst.air_sea_clss_cd != 'G' THEN 'A/R'
		             WHEN inv_mst.sell_buy_tp_cd = 'D' AND inv_mst.air_sea_clss_cd != 'G' THEN 'DEBIT'
		             WHEN inv_mst.sell_buy_tp_cd = 'C' AND inv_mst.air_sea_clss_cd != 'G' THEN 'CREDIT'
		             WHEN inv_mst.sell_buy_tp_cd = 'B' AND inv_mst.air_sea_clss_cd != 'G' THEN 'A/P'
		             WHEN inv_mst.sell_buy_tp_cd = 'S' AND inv_mst.air_sea_clss_cd = 'G' THEN 'A/R(G&A)'
		             WHEN inv_mst.sell_buy_tp_cd = 'B' AND inv_mst.air_sea_clss_cd = 'G' THEN 'A/P(G&A)'
		             WHEN jnr_dtl.INP_TYPE = 'M' THEN 'N/A'
		       END AS inv_tp,
		       (CASE WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.inv_sum_amt
					                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.inv_sum_amt * -1
					                                             ELSE inv_dtl.inv_sum_amt
					                                        END)
				     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.inv_sum_amt * -1
							                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.inv_sum_amt
							                                     ELSE inv_dtl.inv_sum_amt 
							                                END) 
				     ELSE 0
		         END) AS inv_sum_amt,
		       (CASE WHEN jnr_mst.void_yn = 'Y' THEN null
		             WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN jnr_dtl.pay_amt
					                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN jnr_dtl.pay_amt * -1
					                                             ELSE jnr_dtl.pay_amt
					                                        END)
				     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN jnr_dtl.pay_amt * -1
							                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN jnr_dtl.pay_amt
							                                     ELSE jnr_dtl.pay_amt 
							                                END) 
				     ELSE 0
		        END) AS pay_amt,  
		       (CASE WHEN jnr_mst.jnr_tp IN ('D','B') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.bal_amt
					                                             WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.bal_amt * -1
					                                             ELSE inv_dtl.bal_amt
					                                        END)
				     WHEN jnr_mst.jnr_tp IN ('C','V') THEN (CASE WHEN inv_mst.sell_buy_tp_cd IN ('S', 'D') THEN inv_dtl.bal_amt * -1
							                                     WHEN inv_mst.sell_buy_tp_cd IN ('B', 'C') THEN inv_dtl.bal_amt
							                                     ELSE inv_dtl.bal_amt
							                                END) 
				    ELSE 0
		       END) AS bal_sum_amt,
		       jnr_dtl.gl_no,
		       gl_cd.rmk AS gl_nm,
		       jnr_dtl.jnr_desc		       
		  FROM TB_JNR_MST jnr_mst 
		  	   JOIN TB_JNR_DTL jnr_dtl ON jnr_dtl.jnr_no = jnr_mst.jnr_no  AND ISNULL(jnr_dtl.delt_flg,'N') = 'N'
		       LEFT OUTER JOIN TB_INV inv_mst ON inv_mst.inv_seq = jnr_dtl.inv_seq AND inv_mst.delt_flg = 'N' AND ISNULL(inv_mst.tax_bil_flg, 'N') != 'Y'
		       LEFT OUTER JOIN TB_INV_DTL inv_dtl ON inv_dtl.inv_seq = inv_mst.inv_seq AND inv_dtl.delt_flg = 'N'
		       LEFT OUTER JOIN TB_TRDP trdp ON trdp.trdp_cd = jnr_mst.trdp_cd
		       LEFT OUTER JOIN TB_BANK bank ON bank.bank_seq = jnr_mst.bank_seq
		       LEFT OUTER JOIN TB_GL_CD gl_cd ON gl_cd.gl_cd = jnr_dtl.gl_no
		 WHERE isnull(jnr_mst.delt_flg,'N') = 'N'            
		]]>
		   <isNotEmpty property="f_ofc_cd">
		   	   AND jnr_mst.p_ofc_cd = #f_ofc_cd#
		   </isNotEmpty>
		   
		   <isNotEmpty property="f_bank_cd">
		   	   AND jnr_mst.bank_seq = #f_bank_cd#
		   </isNotEmpty>
		   
		   <isNotEmpty property="f_start_date">
			   <isEqual property="f_date_flag" compareValue="A">
			   	   AND jnr_mst.post_dt between #f_start_date# and #f_end_date#
			   </isEqual>
			   <isEqual property="f_date_flag" compareValue="B">
			   	   AND jnr_mst.clr_dt between #f_start_date# and #f_end_date#
			   </isEqual>
		   </isNotEmpty>
		   
		   AND ( 1=2
		   <isEqual property="f_payment_tp_d" compareValue="A">
		   	   OR (jnr_mst.JNR_TP = 'D')
		   </isEqual>
		   <isEqual property="f_payment_tp_p" compareValue="A">
		   	   OR (jnr_mst.JNR_TP = 'C')
		   </isEqual>
		      )   
		      
		   <isEqual property="s_cust_flag" compareValue="A">
			   <isNotEmpty property="f_trdp_cd">
			   	   AND jnr_mst.trdp_cd = #f_trdp_cd#
			   </isNotEmpty>
		   </isEqual>
		   <isEqual property="s_cust_flag" compareValue="B">
			   <isNotEmpty property="f_grp_id_cd">
			   	   AND EXISTS (SELECT 'X' FROM TB_TRDP X WHERE X.GRP_ID_CD = #f_grp_id_cd# AND X.TRDP_CD = jnr_mst.trdp_cd)
			   </isNotEmpty>
		   </isEqual>
		   
		   <isNotEmpty property="f_gl_no">
		   	   AND jnr_dtl.gl_no = #f_gl_no#
		   </isNotEmpty>
		      
		   AND ( 1=2
		   <isEqual property="f_sell_buy_tp_cd_s" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'S' and inv_mst.air_sea_clss_cd != 'G')
		   </isEqual>
		   <isEqual property="f_sell_buy_tp_cd_b" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'B' and inv_mst.air_sea_clss_cd != 'G')
		   </isEqual>
		   <isEqual property="f_sell_buy_tp_cd_d" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'D' and inv_mst.air_sea_clss_cd != 'G')
		   </isEqual>
		    <isEqual property="f_sell_buy_tp_cd_c" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'C' and inv_mst.air_sea_clss_cd != 'G')
		   </isEqual>
		   <isEqual property="f_sell_buy_tp_cd_ar_gnr" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'S' and inv_mst.air_sea_clss_cd = 'G')
		   </isEqual>
		   <isEqual property="f_sell_buy_tp_cd_ap_gnr" compareValue="A">
		   	   OR (inv_mst.sell_buy_tp_cd = 'B' and inv_mst.air_sea_clss_cd = 'G')
		   </isEqual>
		   <isEqual property="f_sell_buy_tp_cd_na" compareValue="A">
		   	   OR (jnr_dtl.INP_TYPE = 'M')
		   </isEqual>
		      )
		) Z
		WHERE 1 = 1
		order by  bank_seq asc, post_dt asc, jnr_tp asc, p_ofc_cd asc, trdp_nm asc, jnr_no asc, chk_no asc
	</select>    


        
    <select id="selectJournalHistory" parameterClass="HashMap" resultClass="com.clt.apps.fis.acc.jor.journal.dto.JnrHisVO">
    	SELECT 
			MST.JNR_NO,
			MST.MODI_SEQ, 
			
	 		<!-- #3488 Accounting Multi Language 적용  --> 	   			 
  			CASE
		 	WHEN (SELECT opt_val FROM TB_SYS_OPT WHERE opt_key = 'MULTI_LANGUAGE' ) = 'Y' 
		 		 THEN (SELECT X.LOCL_NM FROM TB_TRDP X WHERE X.TRDP_CD = MST.TRDP_CD)
 		 	ELSE 	  (SELECT X.ENG_NM FROM TB_TRDP X WHERE X.TRDP_CD = MST.TRDP_CD)
  			END AS TRDP_CD,
	   			 
			<isEqual property="jnr_tp" compareValue="D">
			MST.RCVD_FM_NM,
			</isEqual>
			<isEqual property="jnr_tp" compareValue="C">
			(SELECT X.LOCL_NM FROM TB_TRDP X WHERE X.TRDP_CD = MST.PAYTO_CD) AS RCVD_FM_NM,
			</isEqual>
			MST.POST_DT,
			MST.CURR_CD,
			(SELECT X.BANK_NM FROM TB_BANK X WHERE X.BANK_SEQ = MST.BANK_SEQ) AS BANK_SEQ,
			MST.CHK_NO,
			MST.AMT,
			MST.CLR_DT,
			MST.VOID_DT,
			MST.MODI_USRID,
			MST.MODI_OFC_CD,
			
			<!-- CONVERT(VARCHAR(10),MODI_TMS,110)+' '+CONVERT(VARCHAR(5),MODI_TMS,108) AS MODI_TMS, --> 
			
            <!-- CONVERT(VARCHAR(10),DATEADD(MINUTE,60*CONVERT( float,isnull (ccd.RMK ,'0')), MST.MODI_TMS ),110)+' '+
            CONVERT(VARCHAR(5),DATEADD(MINUTE,60*CONVERT( float,isnull (ccd.RMK ,'0')), MST.MODI_TMS ),108) AS MODI_TMS, --><!--  local time 으로변경 16.03 #52300 [BNX] Opus forwarding Time Zone 설정 -->
	        
	        DATEADD(MINUTE,60*CONVERT( float,isnull (ccd.RMK ,'0')), MST.MODI_TMS ) AS MODI_TMS,
			
			(SELECT DELT_FLG FROM TB_JNR_MST X WHERE X.JNR_NO = MST.JNR_NO) AS DELT_FLG,
			CASE WHEN MST.JNR_NO LIKE 'JNR%' THEN 'Y' ELSE 'N' END MIG_YN
    	  FROM TB_JNR_HIS_MST MST
    	  
    	   LEFT OUTER JOIN
		        TB_OFC TOF     
		            ON MST.RGST_OFC_CD = TOF.OFC_CD            
		    LEFT OUTER JOIN
		        TB_COM_CD_DTL CCD     
		            ON CCD.COM_CD = 'TIMEZN'     
		            AND TOF.TIME_ZONE = CCD.CD_VAL   
            
    	 WHERE JNR_NO = #jnr_no# 
    	 ORDER BY MODI_SEQ DESC    	 
    </select>
    
        
    <select id="selectJournalDetailHistory" parameterClass="HashMap" resultClass="InvJorVO">
    	SELECT 
		  JNR.JNR_NO
	      ,JNR.JNR_SEQ
	      ,JNR.MODI_SEQ
	      ,JNR.DTL_SEQ
	      ,JNR.INV_NO
	      ,JNR.BUY_INV_NO
	      ,JNR.OFC_CD
	      ,JNR.INV_POST_DT
	      ,JNR.INV_DEPT_CD
	      ,JNR.INV_TP
	      ,JNR.REF_NO
	      ,JNR.BL_NO
	      ,JNR.INV_POST_DT
	      ,JNR.INV_APLY_CURR_CD
	      ,JNR.INV_APLY_XCRT
	      ,JNR.INV_SUM_AMT
	      ,JNR.BAL_SUM_AMT
	      ,JNR.PAY_AMT
	      ,JNR.TTL_PAY_AMT
	      ,JNR.OLD_PAY_AMT
	      ,JNR.GL_NO
	      ,JNR.GL_RMK
	      ,JNR.JNR_DESC
	      ,JNR.TRDP_CD
	      ,JNR.TRDP_NM
	      ,JNR.RCVD_FM_NM
	      ,JNR.PAYTO_CD
	      ,JNR.RGST_USRID
	      ,JNR.RGST_OFC_CD
	      ,JNR.RGST_TMS
	      ,JNR.MODI_USRID
	      ,JNR.MODI_OFC_CD
	      ,JNR.MODI_TMS
	      ,JNR.INV_SEQ
	      ,INV.INV_DT
	      ,JNR.INV_SUM_AMT * JNR.INV_APLY_XCRT AS INV_XCRT_SUM_AMT
    	  FROM TB_JNR_HIS_DTL JNR
    	  LEFT OUTER JOIN TB_INV_DTL INV ON JNR.INV_SEQ = INV.INV_SEQ AND INV.DELT_FLG = 'N'
    	 WHERE JNR.JNR_NO = #jnr_no# 
    	  AND JNR.modi_seq = #modi_seq# 
    	 ORDER BY JNR.MODI_SEQ DESC    	 
    </select>
    
    
    <insert id="insertJournalHistory" parameterClass="HashMap">
		INSERT INTO TB_JNR_HIS_MST
           (JNR_NO
           ,MODI_SEQ
           ,JNR_TP
           ,POST_DT
           ,TRDP_CD
           ,PAYTO_CD
           ,RCVD_FM_CD
           ,RCVD_FM_NM
           ,BANK_SEQ
           ,CLR_YN
           ,CLR_DT
           ,BATCH_SEQ
           ,VOID_YN
           ,VOID_DT
           ,CHK_NO
           ,CHK_PNT_YN
           ,CHK_PNT_DT
           ,CHK_PNT_USRID
           ,AMT
           ,CURR_CD
           ,LEVEL
           ,RMK
           ,DELT_FLG
           ,P_OFC_CD
           ,RGST_USRID
           ,RGST_OFC_CD
           ,RGST_TMS
           ,MODI_USRID
           ,MODI_OFC_CD
           ,MODI_TMS
           ,CLT_CMPL_FLG
           ,SLIP_NO
           ,JNR_YN
           ,JNR_DT
           ,CLS_YN
           ,CLS_DT
           ,BLOCK_DT
		) SELECT
	   		#f_jnr_no#
		   ,(SELECT  isnull(max(modi_seq)+1, 1) FROM  TB_JNR_HIS_MST WHERE JNR_NO = #f_jnr_no#)
           ,#f_jnr_tp#
           ,REPLACE(#f_post_dt#,'-','')		
           ,#s_cust_cd#
           ,#s_paid_cd#
           ,#f_rcv_from_cd#
           ,#f_rcv_from#
           ,#f_bank_cd#
           ,#clr_yn#
           ,REPLACE(#f_deposit_dt#,'-','')	
           ,#batch_seq#
           ,#void_yn#
           ,REPLACE(#f_void_dt#,'-','')	
           ,#f_chk_no#
           ,#chk_pnt_yn#
           ,REPLACE(#chk_pnt_dt#,'-','')	
           ,#chk_pnt_usrid#
           ,#f_rcv_amt#
           ,#f_curr_cd#
           ,#level#
           ,#f_remark#
           ,#delt_flg#
           ,#p_ofc_cd#
		   ,#modi_usrid#
		   ,#modi_ofc_cd#	
		   ,getdate()
		   ,#modi_usrid#			
		   ,#modi_ofc_cd#			
		   ,GETUTCDATE()
           ,#clt_cmpl_flg#
           ,#slip_no#
           ,#jnr_yn#
           ,REPLACE(#f_jnr_dt#,'-','')	
           ,#cls_yn#
           ,REPLACE(#f_cls_dt#,'-','')
		   ,REPLACE(#f_block_dt#,'-','')
    </insert>
    
    <insert id="insertJournalListHistory" parameterClass="HashMap">
		INSERT INTO TB_JNR_HIS_MST
           (JNR_NO
           ,MODI_SEQ
           ,JNR_TP
           ,POST_DT
           ,TRDP_CD
           ,PAYTO_CD
           ,RCVD_FM_NM
           ,BANK_SEQ
           ,CLR_YN
           ,CLR_DT
           ,BATCH_SEQ
           ,VOID_YN
           ,VOID_DT
           ,CHK_NO
           ,CHK_PNT_YN
           ,CHK_PNT_DT
           ,CHK_PNT_USRID
           ,AMT
           ,CURR_CD
           ,LEVEL
           ,RMK
           ,DELT_FLG
           ,P_OFC_CD
           ,RGST_USRID
           ,RGST_OFC_CD
           ,RGST_TMS
           ,MODI_USRID
           ,MODI_OFC_CD
           ,MODI_TMS
           ,CLT_CMPL_FLG
           ,SLIP_NO
           ,JNR_YN
           ,JNR_DT
           ,CLS_YN
           ,CLS_DT
           ,BLOCK_DT
		) SELECT
	   		#f_jnr_no#
		   ,(SELECT  isnull(max(modi_seq)+1, 1) FROM  TB_JNR_HIS_MST WHERE JNR_NO = #f_jnr_no#)
           ,#f_jnr_tp#
           ,#f_post_dt#		
           ,TRDP_CD
           ,PAYTO_CD
           ,RCVD_FM_NM
           ,BANK_SEQ
           ,CLR_YN
           ,CLR_DT	
           ,BATCH_SEQ
           ,VOID_YN
           ,VOID_DT	
           ,CHK_NO
           ,CHK_PNT_YN
           ,CHK_PNT_DT	
           ,CHK_PNT_USRID
           ,AMT
           ,CURR_CD
           ,#f_level#
           ,RMK
           ,DELT_FLG
           ,P_OFC_CD
		   ,#modi_usrid#
		   ,#modi_ofc_cd#	
		   ,getdate()
		   ,#modi_usrid#			
		   ,#modi_ofc_cd#			
		   ,GETUTCDATE()
           ,CLT_CMPL_FLG
           ,SLIP_NO
           ,JNR_YN
           ,JNR_DT	
           ,CLS_YN
           ,CLS_DT
		   ,BLOCK_DT
		FROM TB_JNR_MST
		WHERE JNR_NO = #f_jnr_no#
		AND JNR_TP = #f_jnr_tp#
    </insert>
    
    <insert id="insertJournalHistoryForBatch" parameterClass="JournalVO">
		INSERT INTO TB_JNR_HIS_MST
           (JNR_NO
           ,MODI_SEQ
           ,JNR_TP
           ,POST_DT
           ,TRDP_CD
           ,PAYTO_CD
           ,RCVD_FM_NM
           ,BANK_SEQ
           ,CLR_YN
           ,CLR_DT
           ,BATCH_SEQ
           ,VOID_YN
           ,VOID_DT
           ,CHK_NO
           ,CHK_PNT_YN
           ,CHK_PNT_DT
           ,CHK_PNT_USRID
           ,AMT
           ,CURR_CD
           ,LEVEL
           ,RMK
           ,DELT_FLG
           ,P_OFC_CD
           ,RGST_USRID
           ,RGST_OFC_CD
           ,RGST_TMS
           ,MODI_USRID
           ,MODI_OFC_CD
           ,MODI_TMS
           ,GRP_SLIP_NO
		) SELECT 
			JNR_NO
			,(SELECT  isnull(max(modi_seq)+1, 1) FROM  TB_JNR_HIS_MST WHERE JNR_NO = #jnr_no#)
	       ,JNR_TP
	       ,POST_DT
	       ,TRDP_CD
	       ,PAYTO_CD
	       ,RCVD_FM_NM
	       ,BANK_SEQ
	       ,CLR_YN
	       ,CLR_DT
	       ,BATCH_SEQ
	       ,VOID_YN
	       ,VOID_DT
	       ,CHK_NO
	       ,CHK_PNT_YN
	       ,CHK_PNT_DT
	       ,CHK_PNT_USRID
	       ,AMT
	       ,CURR_CD
	       ,LEVEL
	       ,RMK
	       ,DELT_FLG
	       ,P_OFC_CD
		   ,#proc_usrid#			
		   ,#proc_ofccd#			
		   ,getdate()
		   ,#proc_usrid#			
		   ,#proc_ofccd#			
		   ,GETUTCDATE()
		   ,GRP_SLIP_NO
	  FROM TB_JNR_MST 
	  	WHERE JNR_NO = #jnr_no#
    </insert>
    
    <insert id="insertJournalDetailHistory" parameterClass="InvJorVO">
        INSERT INTO TB_JNR_HIS_DTL(
			JNR_NO,
			JNR_SEQ,
			MODI_SEQ,
			DTL_SEQ,
			INV_NO,
			BUY_INV_NO,
			OFC_CD,
			INV_POST_DT,
			INV_DEPT_CD,
			INV_TP,
			REF_NO,
			BL_NO,
			INV_APLY_CURR_CD,
			INV_APLY_XCRT,
			INV_SUM_AMT,	
			BAL_SUM_AMT,
			PAY_AMT,
			TTL_PAY_AMT,	
			OLD_PAY_AMT,
			GL_NO,
			GL_RMK,
			JNR_DESC,
			INV_SEQ,
			TRDP_CD,
			TRDP_NM,
			RCVD_FM_NM,
			PAYTO_CD,
			RGST_USRID,
			RGST_OFC_CD,
			RGST_TMS,
			MODI_USRID,
			MODI_OFC_CD,
			MODI_TMS
		) SELECT
			#jnr_no#,
			#jnr_seq#,
			#modi_seq#,
			#dtl_seq#,
			#inv_no#,
			#buy_inv_no#,
			#ofc_cd#,
			#inv_post_dt#,
			#inv_dept_cd#,
			#inv_tp#,
			#ref_no#,
			#bl_no#,
			#inv_aply_curr_cd#,
			#inv_aply_xcrt#,
			#inv_sum_amt#,	
			#bal_sum_amt#,
			#pay_amt#,
			#ttl_pay_amt#,	
			#old_pay_amt#,
			#gl_no#,
			#gl_rmk#,
			#jnr_desc#,
			#inv_seq#,
			#trdp_cd#,
			#trdp_nm#,
			#rcvd_fm_nm#,
			#payto_cd#,
			#rgst_usrid#,
			#rgst_ofc_cd#,
			getdate(),
			#rgst_usrid#,
			#rgst_ofc_cd#,
			GETUTCDATE()
    </insert>
    
    <select id="selectJnrDtlForJnrHistory" parameterClass="java.util.HashMap"  resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > selectJnrDtlForJnrHistory */
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'D/C'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'D/C'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt


		 		<isEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt) 
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) * -1
		             ELSE MAX(inv_dtl.inv_sum_amt) 
		        END								AS inv_sum_amt	
		        </isEqual>
		 		<isNotEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.inv_sum_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.inv_sum_amt) 
		             ELSE MAX(inv_dtl.inv_sum_amt) 
		        END								AS inv_sum_amt	
		        </isNotEqual>
		        
		 		<isEqual property="jnr_tp" compareValue="D">
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END								AS bal_sum_amt
		        </isEqual>
		 		<isNotEqual property="jnr_tp" compareValue="D">
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END								AS bal_sum_amt
		        </isNotEqual>
		        
		        <isEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS pay_amt	
		        </isEqual>
		 		<isNotEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) 
		             ELSE MAX(jnr_dtl.pay_amt) 
		        END								AS pay_amt	
		        </isNotEqual>
		      		        
		        <isEqual property="jnr_tp" compareValue="D">
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS ttl_pay_amt	
		        </isEqual>
		 		<isNotEqual property="jnr_tp" compareValue="D">
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS ttl_pay_amt	
		        </isNotEqual>  
		    		      		        
		        <isEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS old_pay_amt	
		        </isEqual>
		 		<isNotEqual property="jnr_tp" compareValue="D">
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt) * -1
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) 
		             ELSE MAX(jnr_dtl.ttl_pay_amt) 
		        END								AS old_pay_amt
		        </isNotEqual>  
		        
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       ,MAX(inv_dtl.inv_no)				AS inv_no
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       ,(SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd)) AS trdp_nm
		       ,MAX(jnr_mst.RCVD_FM_NM)			AS rcvd_fm_nm
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt	
		       ,(SELECT MAX(modi_seq) FROM TB_JNR_HIS_MST his_mst
					WHERE his_mst.JNR_NO = jnr_dtl.JNR_NO
				) AS MODI_SEQ	       
		       		       
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_INV_DTL inv_dtl          
            	/*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
    		LEFT OUTER JOIN TB_INV inv_mst          
            	ON inv_dtl.inv_seq = inv_mst.inv_seq
		    LEFT OUTER JOIN TB_FRT frt 
		     	ON inv_mst.INV_SEQ = frt.INV_SEQ
			LEFT OUTER JOIN TB_INTG_BL bl
		     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ
			LEFT OUTER JOIN TB_OTH_SALES oth
		     	ON frt.OTH_SEQ = oth.OTH_SEQ
		    LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		   		ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
		 WHERE jnr_mst.jnr_no = #jnr_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 GROUP BY jnr_dtl.JNR_SEQ ,jnr_dtl.JNR_NO
    </select>
    
    <select id="selectModiSeqJnrHistory" parameterClass="String" resultClass="String">
		SELECT MAX(modi_seq) 
		FROM TB_JNR_HIS_MST his_mst
		WHERE  his_mst.jnr_no = #value#
    </select>
    
    <select id="getDupCheckNo" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		/*  AccInvInvoiceSQL.xml > getDupCheckNo  */
		SELECT MAX(CHK_NO) 
		  FROM TB_JNR_MST MST
		 WHERE 1 = 1
		   AND MST.JNR_NO != #f_jnr_no#
		   AND MST.CHK_NO = #f_chk_no#
		   AND MST.DELT_FLG = 'N'
		<isEqual property="f_jnr_tp" compareValue="D">
		   AND MST.TRDP_CD = #f_cust_cd#
		</isEqual>
		<isNotEqual property="f_jnr_tp" compareValue="D">
           AND MST.BANK_SEQ = #f_bank_cd#
           AND MST.JNR_TP = #f_jnr_tp#
		</isNotEqual>
    </select>
    
    <select id="getJnrVoidInfo" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		/*  AccInvInvoiceSQL.xml > getJnrVoidInfo  */
		SELECT MAX(void_yn) 
		  FROM TB_JNR_MST mst
		 WHERE  1=1
		   AND  mst.jnr_no = #f_jnr_no#		   
    </select>
    <!-- Payment Save시 오류수정 LKH 2015.02.24 -->
    <select id="selectInvSeqList" resultClass="com.clt.apps.fis.acc.inv.invoice.dto.InvListVO" parameterClass="java.lang.String">
		/*  AccInvInvoiceSQL.xml > selectInvSeqList  */
		SELECT DISTINCT OTH_SEQ, WMS_SEQ, INV_SEQ  FROM TB_FRT
		WHERE INV_SEQ IN (
			SELECT INV_SEQ FROM TB_JNR_DTL
			WHERE JNR_NO = #value# 
			)		  
    </select>
    
        <!-- LKH TODO::작업중 --> 
    <select id="selectInvSeqTargetList" resultClass="com.clt.apps.fis.acc.inv.invoice.dto.InvListVO" parameterClass="java.lang.String">
		/*  AccInvInvoiceSQL.xml > selectInvSeqTargetList  */
		SELECT Max(oth_seq)     AS OTH_SEQ, 
		       Max(wms_seq)     AS WMS_SEQ, 
		       Max(intg_bl_seq) AS INTG_BL_SEQ 
		FROM   (SELECT Max(Isnull(oth_seq, '')) OTH_SEQ, 
		               Max(Isnull(wms_seq, '')) WMS_SEQ, 
		               CASE 
		                 WHEN Max(Isnull(oth_seq, '')) = '' 
		                      AND Max(Isnull(wms_seq, '')) = '' THEN Max(intg_bl_seq) 
		                 ELSE '' 
		               END                      AS INTG_BL_SEQ 
		        FROM   tb_frt 
		        WHERE  inv_seq IN (SELECT inv_seq 
		                           FROM   tb_jnr_dtl 
		                           WHERE  jnr_no = #value# 
		                          ) 
		        GROUP  BY oth_seq, 
		                  wms_seq, 
		                  intg_bl_seq) A  
                  
    </select>
    
    <!-- Deposit/Payment Invoice List 조회 (Enter)  -->
    <select id="searchINV_CNT" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* AccJorJournalSQL.xml > searchINV_CNT */
		SELECT  COUNT(inv_seq) AS inv_cnt, MAX(cust_cd) AS cust_cd, MAX(cust_nm) AS cust_nm, MAX(acct_pay_ord) AS acct_pay_ord
	    FROM   (
	    	SELECT  inv_mst.inv_seq 				AS inv_seq
	    	       ,MAX(inv_mst.trdp_cd)			AS cust_cd
				   ,MAX(trdp.eng_nm)				AS cust_nm
				   ,MAX(trdp.reserve_field09)		AS acct_pay_ord
			  FROM TB_INV inv_mst
			    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
			     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
			    LEFT JOIN TB_FRT frt 
			     	ON inv_mst.INV_SEQ = frt.INV_SEQ AND frt.delt_flg = 'N'
			    LEFT OUTER JOIN TB_TRDP trdp 	
			        ON trdp.trdp_cd = inv_mst.trdp_cd 	
			 WHERE isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
			   AND inv_mst.DELT_FLG = 'N'
			 <isNotEmpty property="s_cust_cd">
			   AND inv_mst.TRDP_CD = #s_cust_cd#
			 </isNotEmpty>  
			 <isNotEmpty property="s_cust_nm">
			    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
			                WHERE trd.TRDP_CD = inv_mst.TRDP_CD AND trd.ENG_NM LIKE #s_cust_nm# + '%')
			 </isNotEmpty>
			 <isNotEmpty property="f_curr_cd">
			   AND frt.inv_curr_cd = #f_curr_cd#
			 </isNotEmpty>  
			 <isEqual property="his_chk" compareValue="O">
			   AND inv_dtl.INV_STS_CD != 'IE'
			   AND inv_dtl.BAL_AMT != 0
			 </isEqual>
			   <isNotEmpty property="s_inv_no">
			       AND ( inv_dtl.INV_NO = #s_inv_no# OR inv_dtl.BUY_INV_NO = #s_inv_no# )	
			   </isNotEmpty>
			   <isEqual property="dept_chk1" compareValue="Y">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			   <isEqual property="dept_chk1" compareValue="N">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			 GROUP BY inv_mst.INV_SEQ    
		 ) inval 
    </select>
    
    
    <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
    <select id="searchSlipModiTms" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		/*  searchSlipModiTms  */
		SELECT MAX(MODI_TMS) AS MODI_TMS
		FROM (
			SELECT MODI_TMS
			  FROM TB_SLIP_MST
			 WHERE SLIP_NO = #slip_no#
			 
			union all
			 
			 SELECT MODI_TMS
			  FROM TB_SLIP_MST_BLCK  
			 WHERE SLIP_NO = #slip_no#
			 
			 
		) INVAL
    </select>
    
    <select id="searchLateBillingList_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
    	select 'test' as col 
    </select>
    <select id="searchLateBillingList" resultClass="com.clt.apps.fis.acc.jor.journal.dto.acc_jor_0630VO" parameterClass="java.util.HashMap">
    /*  AccJorJournalSQL.xml > searchLateBillingList  */
		 with mblinfo as (
		      select
		           BL.* 
		        from TB_INTG_BL BL with(nolock)   
		       WHERE bl.delt_flg = 'N'         
		         AND bl.biz_clss_cd  =  'M' /**P*/     
		 ), 
		 hblinfo as
		 (
		      select
		           bl.* 
		           ,rlt.RLT_INTG_BL_SEQ
		        from TB_INTG_BL BL with(nolock)   
		        left outer join 
		        (
					select 
					    rlt.intg_bl_seq
					    ,rlt.RLT_INTG_BL_SEQ     
					  from mblinfo mbl
					   left join tb_intg_bl_rlt rlt 
		                on(mbl.INTG_BL_SEQ = rlt.rlt_intg_bl_seq)
					  
		        ) rlt
		        on( bl.INTG_BL_SEQ = rlt.intg_bl_seq)
		        
		        
		       WHERE bl.delt_flg = 'N'         
		         AND  bl.biz_clss_cd  =  'H' 
		 
		 )
		  ,invInfo as 
		 (
			 SELECT 
			 inv.* 
			 
			 from(
			  select    
						a.INTG_BL_SEQ
						,a.INV_SEQ
						,b.INV_SUM_AMT as INV_AMT
						,b.INV_APLY_CURR_CD
						,b.inv_no
						,b.INV_DT
						,b.INV_POST_DT
						,b.RGST_TMS AS INV_RGST_TMS
						,(ROW_NUMBER() OVER(PARTITION BY a.INTG_BL_SEQ order by a.INV_SEQ desc )) rnk
					
		        FROM
		            tb_frt a                  
		        LEFT OUTER JOIN
		            TB_INV_DTL b                               
		                ON a.INV_SEQ = b.inv_seq  AND b.delt_flg = 'N'                     
		        LEFT OUTER JOIN
		            TB_INV c                               
		                ON a.INV_SEQ = c.inv_seq 
		                AND c.delt_flg = 'N'    
		        
		        WHERE a.delt_flg = 'N'      
		          AND a.SELL_BUY_TP_CD ='S'    
		                
		      group by  
						a.INTG_BL_SEQ
						,a.INV_SEQ
						,b.INV_SUM_AMT
						,b.INV_APLY_CURR_CD
						,b.inv_no
						,b.INV_DT
						,b.INV_POST_DT
						,b.RGST_TMS
					
		 	) inv
		 	where not  EXISTS (select rnk where rnk > 1 and INV_SEQ is null) 
		 )
		 
		  ,listInfo as  
		 ( 
			 select 
						  ml.Air_Sea_Clss_Cd
						  ,bnd.BND_CLSS_CD
						  ,ml.Air_Sea_Clss_Cd+bnd.BND_CLSS_CD  as detp_cd
						  ,case when ml.Air_Sea_Clss_Cd+bnd.BND_CLSS_CD = 'SO' then 'Ocean Export'
						        when ml.Air_Sea_Clss_Cd+bnd.BND_CLSS_CD = 'SI' then 'Ocean Import'
						        when ml.Air_Sea_Clss_Cd+bnd.BND_CLSS_CD = 'AO' then 'Air Export'
						        when ml.Air_Sea_Clss_Cd+bnd.BND_CLSS_CD = 'AI' then 'Air Import'
						        end as detp_nm 
						  ,ml.ref_ofc_cd  /** Office*/  
				          ,ml.RGST_USRID  /** Operator */
				          ,ml.REF_NO
				          ,ml.BL_NO as mbl_no
				          ,hl.BL_NO as hbl_no
				          ,ml.hbl_tp_cd                   /** B/L Type */
				          ,cdl.cd_nm   AS hbl_tp_nm      /** B/L Type */
				          ,hl.nomi_flg                   /** Sales Type */
				          ,case when hl.nomi_flg = 'N' then 'Free cargo'
				                when hl.nomi_flg = 'Y' then 'Nomi'
				                when hl.nomi_flg = 'C' then 'Co-load' end as nomi_flg_nm
		
		                ,case 
		                    when hl.biz_clss_cd = 'H' then hl.ETD_DT_TM 
		                    else ml.ETD_DT_TM         end as etd 
		                ,case 
		                    when hl.biz_clss_cd = 'H' then hl.ETA_DT_TM 
		                    else ml.ETA_DT_TM         end as eta      
				          ,ml.POST_DT
				          ,bnd.AR_CHK
				          
				          <!-- 
				          ,inv.INV_NO as inv_no  
				          ,inv.INV_APLY_CURR_CD
				          ,inv.INV_AMT
				          ,inv.INV_DT
				          ,inv.INV_SEQ
				          ,inv.INV_RGST_TMS
				          ,inv.INV_POST_DT
				           -->
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_NO 
		                    else minv.INV_NO         end as inv_no 
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_APLY_CURR_CD
		                    else minv.INV_APLY_CURR_CD         end as INV_APLY_CURR_CD 				          
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_AMT
		                    else minv.INV_AMT         end as INV_AMT 				          
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_DT
		                    else minv.INV_DT         end as INV_DT 					          
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_SEQ
		                    else minv.INV_SEQ         end as INV_SEQ 				          
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_RGST_TMS
		                    else minv.INV_RGST_TMS         end as INV_RGST_TMS 					          
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then inv.INV_POST_DT
		                    else minv.INV_POST_DT         end as INV_POST_DT 				          
				           
				           
				          ,ml.RGST_TMS
				          ,ml.MODI_TMS
				          ,ML.INTG_BL_SEQ as ML_INTG_BL_SEQ 
				          ,HL.INTG_BL_SEQ as HL_INTG_BL_SEQ	 
				          <!-- ,DATEDIFF(DD, cast(inv.INV_DT as datetime), cast(inv.INV_POST_DT as datetime) )   gap -->
				          <!-- ,DATEDIFF(DD, cast(ml.POST_DT as datetime), inv.INV_RGST_TMS )   gap -->
				          
		                ,case 
		                    when hl.biz_clss_cd = 'H' then DATEDIFF(DD, cast(inv.INV_POST_DT as datetime), inv.INV_RGST_TMS )
		                    else DATEDIFF(DD, cast(minv.INV_POST_DT as datetime), minv.INV_RGST_TMS )         end as gap 					          
				          
				          
			   from mblinfo ml
			       left outer join  hblinfo hl 
			            on hl.rlt_INTG_BL_SEQ = ml.INTG_BL_SEQ
			       left outer join  invInfo minv
			            on(ML.INTG_BL_SEQ = minv.INTG_BL_SEQ)      
			       left outer join  invInfo inv
			            on(HL.INTG_BL_SEQ = inv.INTG_BL_SEQ)      
		           JOIN tb_add_info_bnd bnd with(nolock)         
		                ON  ml.intg_bl_seq = bnd.intg_bl_seq      	
		                
					LEFT OUTER JOIN
						tb_com_cd_dtl cdl              
							ON  cdl.cd_val = ml.hbl_tp_cd
							AND cdl.com_cd = 'C016' 
							AND cdl.delt_flg = 'N'                    
		        where 1=1          
			  	<isNotEmpty property="f_detp_cd">
			  		<isEqual property="f_detp_cd" compareValue="SO">
			  	  		and ml.Air_Sea_Clss_Cd ='S' 
			  	  		and bnd.BND_CLSS_CD    ='O'
			  	  	</isEqual>
			  		<isEqual property="f_detp_cd" compareValue="SI">
			  	  		and ml.Air_Sea_Clss_Cd ='S' 
			  	  		and bnd.BND_CLSS_CD    ='I'
			  	  	</isEqual>			  	  	
			  		<isEqual property="f_detp_cd" compareValue="AO">
			  	  		and ml.Air_Sea_Clss_Cd ='A' 
			  	  		and bnd.BND_CLSS_CD    ='O'
			  	  	</isEqual>
			  		<isEqual property="f_detp_cd" compareValue="AI">
			  	  		and ml.Air_Sea_Clss_Cd ='A' 
			  	  		and bnd.BND_CLSS_CD    ='I'
			  	  	</isEqual>			  	 
			  	</isNotEmpty>
			  	 
			  	<isNotEmpty property="f_date_type">
			  		<isEqual property="f_date_type" compareValue="POST">
			  			and ml.POST_DT between #f_strdt# and #f_enddt#
			  	  	</isEqual>
			  		<isEqual property="f_date_type" compareValue="ETD">
			  			and ml.ETA_DT_TM between #f_strdt# and #f_enddt#
			  	  	</isEqual>
			  		<isEqual property="f_date_type" compareValue="ETA">
			  			and hl.ETA_DT_TM between #f_strdt# and #f_enddt#
			  	  	</isEqual>
			  	</isNotEmpty> 
			  	 
			  	<isNotEmpty property="f_bl_type">
			  		and ml.hbl_tp_cd = #f_bl_type#
			  	</isNotEmpty> 
			  	 
			  	<isNotEmpty property="f_sales_cd">
			  		and hl.nomi_flg = #f_sales_cd#
			  	</isNotEmpty> 
			  	<isNotEmpty property="f_ofc_cd">
			  		and ml.ref_ofc_cd = #f_ofc_cd#
			  	</isNotEmpty> 
			  	

			  	
			  	
		 )
		 , lastList as
		 (
			 select 
			 		COUNT(*) OVER() TOT_CNT
			 		<isEmpty property="f_gap">
			 		,ROW_NUMBER() OVER (ORDER BY a.POST_DT DESC) AS RNUM
			 		</isEmpty>
			 		<isNotEmpty property="f_gap">
					,ROW_NUMBER() OVER (ORDER BY a.GAP DESC,a.POST_DT DESC) AS RNUM
					</isNotEmpty>
					,a.*
			  from listInfo a
			  where 1=1
			  	<isNotEmpty property="f_gap">
			  		  and (a.gap <![CDATA[ >=  ]]>#f_gap#
			  		       OR a.INV_RGST_TMS is null) 
			  	</isNotEmpty> 
		 
		 )
		 select * from lastList a
		 
		 where 1=1 
 			    <![CDATA[ and a.RNUM > #beginIdx# AND a.RNUM <= #topCnt#	]]> 
 
    </select>
    
    <select id="selectJnrBlockStatus" parameterClass="HashMap" resultClass="String">
		SELECT CASE WHEN ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, JNR.CLT_CMPL_FLG),'N') = 'N' 
					THEN CASE WHEN ISNULL(JNR.JNR_YN,'N') = 'Y' OR ISNULL(JNR.CLS_YN,'N') = 'Y' THEN 'Y' ELSE 'N' END 
					ELSE 'Y' END AS CLT_CMPL_FLG
		  FROM TB_JNR_MST JNR
		  LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK ON JNR.JNR_NO = BLCK.JNR_NO1
		 WHERE JNR.JNR_NO = #jnr_no#
	</select> 
	
	<!-- Currency List 조회 (Deposit/Payment for China (Entry)) -->
    <select id="searchJNR_DFLT_CURR_LIST" parameterClass="java.util.HashMap" resultClass="String">
		/* AccJorJournalSQL.xml > searchJNR_DFLT_CURR_LIST */
		<!-- SELECT '' AS JNR_TP, '' AS JNR_NO, CD_VAL AS CURR_CD, 0 AS RCV_AMT, 0 AS COLL_AMT, '' AS BANK_SEQ, '' AS CHK_NO, '' AS POST_DT, '' AS CLR_YN, '' AS CLR_DT, '' AS VOID_YN, '' AS VOID_DT
		  FROM TB_COM_CD_DTL
		 WHERE 1 = 1
		   AND COM_CD = 'C010'
		   AND DELT_FLG = 'N'
		 ORDER BY SRT_SEQ -->
		 
		 SELECT CURR_CD
		 FROM (
		 	SELECT JNR_DFLT_CURR_CD1 AS CURR_CD, 1 AS SRT_SEQ
			FROM TB_OFC
			WHERE OFC_CD = #ofc_cd#
			
			UNION ALL
			
			SELECT JNR_DFLT_CURR_CD2 AS CURR_CD, 2 AS SRT_SEQ
			FROM TB_OFC
			WHERE OFC_CD = #ofc_cd#
			
			UNION ALL
			
			SELECT JNR_DFLT_CURR_CD3 AS CURR_CD, 3 AS SRT_SEQ
			FROM TB_OFC
			WHERE OFC_CD = #ofc_cd#
			
			UNION ALL
			
			SELECT JNR_DFLT_CURR_CD4 AS CURR_CD, 4 AS SRT_SEQ
			FROM TB_OFC
			WHERE OFC_CD = #ofc_cd#
			
			UNION ALL
			
			SELECT JNR_DFLT_CURR_CD5 AS CURR_CD, 5 AS SRT_SEQ
			FROM TB_OFC
			WHERE OFC_CD = #ofc_cd#
		 ) INVAL
		 WHERE 1 = 1
		 AND ISNULL(CURR_CD,'') != ''
		 ORDER BY SRT_SEQ		 
					 
    </select> 
    
    <!-- Journal Invoice List 조회 (Deposit/Payment for China (Entry)) -->
    <select id="searchJNR_INV_FOR_CHINA_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchJNR_INV_FOR_CHINA_LIST */
		<isEqual property="page_show_yn" compareValue="Y">
		SELECT a1.*                 
          FROM (     
                SELECT ROW_NUMBER() OVER (ORDER BY T.inv_seq, T.inv_aply_curr_cd) as ROWNUM, T.* 
           	     FROM(
        </isEqual>   	 
        SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt 
            FROM (
			    	SELECT  MAX(inv_dtl.INV_POST_DT)		AS inv_post_dt
			    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
			    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
					       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
					       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
					       ,CASE WHEN ISNULL(MAX(inv_dtl.INV_XCRT_DT),'') = '' THEN MAX(inv_dtl.INV_POST_DT) ELSE MAX(inv_dtl.INV_XCRT_DT) END AS inv_xcrt_dt
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
					        END								AS inv_tp
			
							,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_AR)                
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_AGENT_AR)
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_AGENT_AP)
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_AP) END gl_no
							,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AR) AND use_flg = 'Y')                
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AR) AND use_flg = 'Y')      
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AP) AND use_flg = 'Y')        
							      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AP) AND use_flg = 'Y') END gl_rmk  
						    
						   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_EX_LOSS)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_MISC_LOSS)
								 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_EX_PROFIT)
								 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_MISC_PROFIT)
						    END clr_gl_cd 
					       ,MAX(inv_dtl.INV_NO)				AS inv_no
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
					        END 							AS buy_inv_no
					        ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.doc_ref_no)
					       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN MAX(bl.REF_NO)
					             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.REF_NO)					
									 END
								END 	AS ref_no
						   ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.mbl_no)
					       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no) ELSE '' END
					             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.mbl_no)					
									 END
								END 	AS mbl_no
						   ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.hbl_no)
					       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN CASE WHEN MAX(bl.biz_clss_cd) = 'H' THEN MAX(bl.bl_no) ELSE '' END
					             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.hbl_no)					
									 END
								END 	AS hbl_no
						   , CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.MBL_NO)
						   		ELSE     
					       			MAX(CASE WHEN bl.intg_bl_seq is not null THEN bl.bl_no ELSE oth.mbl_no END)	
					       		END	AS bl_no
					       ,MAX(inv_dtl.inv_aply_curr_cd)   AS inv_aply_curr_cd   <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경 -->
					       ,MAX(inv_dtl.inv_aply_curr_cd)   AS curr_cd            <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경 -->   
					       ,1 AS inv_aply_xcrt
					       
						   <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN SUM(frt.TRF_CUR_SUM_AMT)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN SUM(frt.TRF_CUR_SUM_AMT) * -1
					        END								AS inv_sum_amt	
						   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0))
					             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) * -1
					        END								AS bal_sum_amt
			               -->
			               <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경 -->
					       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT)
					             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT) * -1
					        END								AS inv_sum_amt				               
						    ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
					              WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
					        END								AS bal_sum_amt
					        		      			               
					       ,MAX(inv_dtl.inv_seq)			AS inv_seq
					       ,MAX(inv_mst.trdp_cd)			AS trdp_cd
						   ,MAX(trdp.eng_nm)				AS trdp_nm
					       ,CASE WHEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) = 0 THEN '1'
					             ELSE '0'
					        END 							AS clr_flag
					       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
					       
							<!-- #21662 : [BINEX]Deposit, Payment -->
							,''			as INP_TYPE
							,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
							,(case          
					            when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)         
					            when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)         
					            else MAX(TIDB.MODI_TMS) 
					        end)  as modi_tms        
					        ,'' AS jnr_modi_tms   
							
					       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
					       ,MAX(bnd.SLS_USRID) as SLS_USRID
						   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
						   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
				           ,CASE WHEN MAX(inv_mst.AIR_SEA_CLSS_CD) = 'G' AND (SELECT ISNULL(OPT_VAL, '') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_GNA_RMK') = 'Y'
							     THEN MAX(inv_mst.INV_RMK)
							     ELSE ''
							 END AS jnr_desc 
						   ,ISNULL(MAX(TIDB.CLT_CMPL_FLG),'N') as CLT_CMPL_FLG
						   ,MAX(inv_dtl.INV_STS_CD) as INV_STS_CD
			        	    <!-- #2115 [PATENT] Deposit/Payment for CN (ENTRY) 기능 보완 -->
			        	    ,MAX(inv_mst.inv_rmk)  as inv_rmk   
			            	,MAX(bnd.verify_flag ) as verify_flag
			            	,MAX(bnd.pay_flag)     as pay_flag
	                       <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
	                       ,max(trdp.ACCT_CD) as acct_cd    
			            	<!-- OFVFOUR-7996 [South East World Wide] Adding Agent Ref No. Column and Header Setting Save Function -->
					      ,CASE WHEN Isnull(Max(inv_dtl.cust_ref_no), '') != ''AND (Max(inv_mst.sell_buy_tp_cd) IN ('D','C')) THEN Max(Isnull(inv_dtl.cust_ref_no, '')) 
					       	  ELSE 
					   		    (CASE WHEN Max(bl.biz_clss_cd) = 'M' THEN Max(bl.imp_ref_no)
					   			      WHEN Max(bl.biz_clss_cd) = 'H' THEN Max(bl.prnr_ref_no)
					   		     ELSE ''
					   		  END) 
					   	   END AS imp_ref_no     						   
					  FROM TB_INV inv_mst
					    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
					     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
					    LEFT JOIN TB_FRT frt 
					     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
						LEFT JOIN TB_INTG_BL bl
					     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
						LEFT JOIN TB_OTH_SALES oth
					     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
					    LEFT JOIN TB_WM_DOC_MST wms
				   			ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N' 	
						<!-- LEFT JOIN TB_JNR_DTL jnr_dtl
					     	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'	 -->
					    LEFT OUTER JOIN  TB_OFC ofc 
					        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N'
						LEFT OUTER JOIN TB_ADD_INFO_BND bnd
					     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
					    LEFT OUTER JOIN TB_TRDP trdp 	
					        ON trdp.trdp_cd = inv_mst.trdp_cd 	
					     LEFT OUTER JOIN
				            (
				                SELECT
				                    MODI_TMS,
				                    INV_SEQ,
				                    CLT_CMPL_FLG 
				                FROM
				                    TB_INV_DTL_BLCK                
				            ) TIDB                          
			                ON TIDB.INV_SEQ = INV_DTL.INV_SEQ             
                
                 
					 WHERE  isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
					   AND inv_mst.DELT_FLG = 'N'
					 
					<isNotEmpty property="s_post_strdt">
						<isNotEmpty property="s_post_enddt">
					 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
					 	</isNotEmpty>
					</isNotEmpty>
					<isNotEmpty property="s_ofc_cd">
						AND inv_mst.OFC_CD = #s_ofc_cd#
					</isNotEmpty>

                     <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
                     <isNotEmpty  property="s_acct_cd">
                         AND trdp.acct_cd like #s_acct_cd#
                     </isNotEmpty>        					   
					<isNotEmpty property="s_cust_cd">
					   	AND inv_mst.TRDP_CD = #s_cust_cd#
					</isNotEmpty>  
					<isNotEmpty property="s_cust_nm">
					    	AND EXISTS(SELECT 1 FROM TB_TRDP trd WHERE trd.TRDP_CD = inv_mst.TRDP_CD AND trd.ENG_NM LIKE #s_cust_nm# + '%')
					</isNotEmpty>
					<!-- isNotEmpty property="f_curr_cd">
					  AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
					</isNotEmpty --> 
					<isNotEmpty property="s_inv_no">
					  	AND ((inv_mst.sell_buy_tp_cd = 'B' AND inv_dtl.BUY_INV_NO = #s_inv_no#) OR (inv_mst.sell_buy_tp_cd != 'B' AND inv_dtl.INV_NO = #s_inv_no#))
					</isNotEmpty>
					   
					<isEqual property="dept_chk1" compareValue="Y">
					 	<isEqual property="dept_chk2" compareValue="Y">
					    	<isEqual property="dept_chk3" compareValue="Y">
					       		AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
					       	</isEqual>
					       	<isEqual property="dept_chk3" compareValue="N">
					       		AND inv_mst.sell_buy_tp_cd IN('S','D','C')
					       	</isEqual>
						</isEqual>
					    <isEqual property="dept_chk2" compareValue="N">
					    	<isEqual property="dept_chk3" compareValue="Y">
					       		AND inv_mst.sell_buy_tp_cd IN('S','B')
					       	</isEqual>
					       	<isEqual property="dept_chk3" compareValue="N">
					       		AND inv_mst.sell_buy_tp_cd IN('S')
					       	</isEqual>
					 	</isEqual>	    		
					</isEqual>
					   
					<isEqual property="dept_chk1" compareValue="N">
						<isEqual property="dept_chk2" compareValue="Y">
					    	<isEqual property="dept_chk3" compareValue="Y">
					       		AND inv_mst.sell_buy_tp_cd IN('D','C','B')
					       	</isEqual>
					       	<isEqual property="dept_chk3" compareValue="N">
					       	   	AND inv_mst.sell_buy_tp_cd IN('D','C')
					       	</isEqual>
					  	</isEqual>
					    <isEqual property="dept_chk2" compareValue="N">
					    	<isEqual property="dept_chk3" compareValue="Y">
					       	   	AND inv_mst.sell_buy_tp_cd IN('B')
					       	</isEqual>
					       	<isEqual property="dept_chk3" compareValue="N">
					       	   	AND inv_mst.sell_buy_tp_cd IN('')
					       	</isEqual>
					 	</isEqual>	    		
					</isEqual>
					 GROUP BY inv_mst.INV_SEQ  <!--  , frt.RAT_CURR_CD #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경  -->  
				 ) Y
			  WHERE 1 = 1
		   <isEqual property="his_chk" compareValue="O">
				AND y.INV_STS_CD != 'IE'
			  	AND y.bal_sum_amt != 0
		   </isEqual>
		   <isNotEmpty property="s_type_no">
				<isEqual property="s_type" compareValue="REF_NO">
					AND y.ref_no like #s_type_no# + '%'
				</isEqual>
				<isEqual property="s_type" compareValue="MBL_NO">
					AND y.mbl_no like #s_type_no# + '%'
				</isEqual>
				<isEqual property="s_type" compareValue="HBL_NO">
					AND y.hbl_no like #s_type_no# + '%'
				</isEqual>
		   </isNotEmpty>
		   <isEqual property="page_show_yn" compareValue="Y"> 
					 ) T ) a1      
           WHERE 1 = 1
           <![CDATA[
             AND a1.ROWNUM >  #beginIdx# /**P*/ 
             AND a1.ROWNUM <=  #topCnt# /**P*/
           ]]>  
           </isEqual>
           <isNotEqual property="page_show_yn" compareValue="Y">
			ORDER BY Y.inv_seq, Y.inv_aply_curr_cd
	       </isNotEqual> 
    </select>
    
    <select id="searchJNR_INV_FOR_CHINA_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
	     /* AccJorJournalSQL.xml  searchJNR_INV_FOR_CHINA_LIST_CNT */
	     SELECT COUNT(*)
           	     FROM(
	    	SELECT  MAX(inv_dtl.INV_POST_DT)		AS inv_post_dt
	    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
	    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
			       ,MAX(inv_mst.OFC_CD)				AS ofc_cd
			       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
			        END								AS inv_tp
	
					,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_AR)                
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_AGENT_AR)
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_AGENT_AP)
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_AP) END gl_no
					,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AR) AND use_flg = 'Y')                
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AR) AND use_flg = 'Y')      
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AGENT_AP) AND use_flg = 'Y')        
					      WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN (SELECT RMK FROM TB_GL_CD WHERE GL_CD = MAX(ofc.GL_AP) AND use_flg = 'Y') END gl_rmk  
				    
				   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S'  THEN MAX(ofc.GL_EX_LOSS)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D'  THEN MAX(ofc.GL_MISC_LOSS)
						 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C'  THEN MAX(ofc.GL_EX_PROFIT)
						 WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B'  THEN MAX(ofc.GL_MISC_PROFIT)
				    END clr_gl_cd 
			       ,MAX(inv_dtl.INV_NO)				AS inv_no
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
			             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
			        END 							AS buy_inv_no
			        ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.doc_ref_no)
			       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN MAX(bl.REF_NO)
			             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.REF_NO)					
							 END
						END 	AS ref_no
				   ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.mbl_no)
			       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no) ELSE '' END
			             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.mbl_no)					
							 END
						END 	AS mbl_no
				   ,CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.hbl_no)
			       		ELSE CASE WHEN MAX(frt.intg_bl_seq) is not null THEN CASE WHEN MAX(bl.biz_clss_cd) = 'H' THEN MAX(bl.bl_no) ELSE '' END
			             		WHEN MAX(frt.oth_seq) is not null THEN MAX(oth.hbl_no)					
							 END
						END 	AS hbl_no
				   , CASE WHEN MAX(inv_mst.INV_DEPT_CD) ='WMS' THEN MAX(wms.MBL_NO)
				   		ELSE     
			       			MAX(CASE WHEN bl.intg_bl_seq is not null THEN bl.bl_no ELSE oth.mbl_no END)	
			       		END	AS bl_no
			       ,frt.RAT_CURR_CD   AS inv_aply_curr_cd
			       ,1 AS inv_aply_xcrt
			       
			       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN SUM(frt.TRF_CUR_SUM_AMT) * -1
			             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN SUM(frt.TRF_CUR_SUM_AMT) 
			        END								AS inv_sum_amt	
				   
				   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) * -1
			             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0))
			        END								AS bal_sum_amt
	
			       ,MAX(inv_dtl.inv_seq)			AS inv_seq
			       ,MAX(inv_mst.trdp_cd)			AS trdp_cd
				   ,MAX(trdp.eng_nm)				AS trdp_nm
			       ,CASE WHEN isnull(MAX(inv_dtl.BAL_AMT),0) = 0 THEN '1'
			             ELSE '0'
			        END 							AS clr_flag
			       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
			       
					<!-- #21662 : [BINEX]Deposit, Payment -->
					,''			as INP_TYPE
					,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
					,MAX(inv_dtl.modi_tms) AS modi_tms
					
			       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
				   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
				   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
				   ,CASE WHEN MAX(inv_mst.AIR_SEA_CLSS_CD) = 'G' AND (SELECT ISNULL(OPT_VAL, '') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_GNA_RMK') = 'Y'
					     THEN MAX(inv_mst.INV_RMK)
					     ELSE ''
					 END AS jnr_desc  
				   ,ISNULL(MAX(TIDB.CLT_CMPL_FLG),'N') as CLT_CMPL_FLG
				   ,MAX(inv_dtl.INV_STS_CD) as INV_STS_CD
			  FROM TB_INV inv_mst
			    LEFT OUTER JOIN TB_INV_DTL inv_dtl 
			     	ON inv_mst.INV_SEQ = inv_dtl.INV_SEQ and inv_dtl.DELT_FLG = 'N'
			    LEFT JOIN TB_FRT frt 
			     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N'
				LEFT JOIN TB_INTG_BL bl
			     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
				LEFT JOIN TB_OTH_SALES oth
			     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
			    LEFT JOIN TB_WM_DOC_MST wms
		   			ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N' 	
				<!-- LEFT JOIN TB_JNR_DTL jnr_dtl
			     	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ AND jnr_dtl.delt_flg = 'N'	 -->
			    LEFT OUTER JOIN  TB_OFC ofc 
			        ON ofc.OFC_CD = inv_mst.OFC_CD AND ofc.delt_flg = 'N'
				LEFT OUTER JOIN TB_ADD_INFO_BND bnd
			     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
			    LEFT OUTER JOIN TB_TRDP trdp 	
			        ON trdp.trdp_cd = inv_mst.trdp_cd 	
			    LEFT OUTER JOIN
				            (
				                SELECT
				                    MODI_TMS,
				                    INV_SEQ,
				                    CLT_CMPL_FLG 
				                FROM
				                    TB_INV_DTL_BLCK                
				            ) TIDB                          
			                ON TIDB.INV_SEQ = INV_DTL.INV_SEQ 
			 WHERE  isnull(inv_mst.tax_bil_flg, 'N') != 'Y'
			   AND inv_mst.DELT_FLG = 'N'
			 
			 <isNotEmpty property="s_post_strdt">
			 	<isNotEmpty property="s_post_enddt">
			 		AND inv_dtl.INV_POST_DT between #s_post_strdt# AND #s_post_enddt#
			 	</isNotEmpty>
			 </isNotEmpty>
			 <isNotEmpty property="s_ofc_cd">
			   AND inv_mst.OFC_CD = #s_ofc_cd#
			 </isNotEmpty>
             <!-- 2967 [BNX US] INVOICES TO BE SEARCHED BY ACCOUNT GROUP ID ON DEPOSIT OR PAYMENT -->
             <isNotEmpty  property="s_acct_cd">
                 AND trdp.acct_cd like #s_acct_cd#
             </isNotEmpty>        			   
			 <isNotEmpty property="s_cust_cd">
			   AND inv_mst.TRDP_CD = #s_cust_cd#
			 </isNotEmpty>  
			 <isNotEmpty property="s_cust_nm">
			    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
			                WHERE trd.TRDP_CD = inv_mst.TRDP_CD AND trd.ENG_NM LIKE #s_cust_nm# + '%')
			 </isNotEmpty>
			 <!-- isNotEmpty property="f_curr_cd">
			   AND frt.inv_curr_cd = (CASE WHEN (SELECT ISNULL(MAX(OPT_VAL),'N') FROM TB_SYS_OPT WHERE OPT_KEY = 'BANK_MULTI_CURR_FLAG') = 'N' THEN #f_curr_cd# ELSE frt.inv_curr_cd END)
			 </isNotEmpty--> 
			   <isNotEmpty property="s_inv_no">
			       AND ((inv_mst.sell_buy_tp_cd = 'B' AND inv_dtl.BUY_INV_NO = #s_inv_no#) OR (inv_mst.sell_buy_tp_cd != 'B' AND inv_dtl.INV_NO = #s_inv_no#))
			   </isNotEmpty>
			   
			   <isEqual property="dept_chk1" compareValue="Y">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('S')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			   
			   <isEqual property="dept_chk1" compareValue="N">
			       <isEqual property="dept_chk2" compareValue="Y">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C','B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('D','C')
			       	   </isEqual>
			       </isEqual>
			       <isEqual property="dept_chk2" compareValue="N">
			       	   <isEqual property="dept_chk3" compareValue="Y">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('B')
			       	   </isEqual>
			       	   <isEqual property="dept_chk3" compareValue="N">
			       	   	   AND inv_mst.sell_buy_tp_cd IN('')
			       	   </isEqual>
			       </isEqual>	    		
			   </isEqual>
			 GROUP BY inv_mst.INV_SEQ, frt.RAT_CURR_CD) T 
			  WHERE 1 = 1
		   <isEqual property="his_chk" compareValue="O">
				AND T.INV_STS_CD != 'IE'
			  	AND T.bal_sum_amt != 0
		   </isEqual>
		   <isNotEmpty property="s_type_no">
				<isEqual property="s_type" compareValue="REF_NO">
					AND T.ref_no like #s_type_no# + '%'
				</isEqual>
				<isEqual property="s_type" compareValue="MBL_NO">
					AND T.mbl_no like #s_type_no# + '%'
				</isEqual>
				<isEqual property="s_type" compareValue="HBL_NO">
					AND T.hbl_no like #s_type_no# + '%'
				</isEqual>
		   </isNotEmpty>
	</select>
	
	<!-- Group Slip No 중복 체크   -->
    <select id="selectGrpSlipNoDuplCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(jnr.grp_slip_no)
          FROM  tb_jnr_mst jnr 
         WHERE  jnr.grp_slip_no = #f_grp_slip_no# 
           AND  jnr.delt_flg = 'N'
    </select>
    
    <!-- JOURNAL 생성된 INVOICE LIST 조회 (Deposit/Payment for China (Entry)) - Master  -->
    <select id="searchJNR_MST_FOR_CHINA_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchJNR_MST_FOR_CHINA_LIST */
		SELECT MAX(JNR.GRP_SLIP_NO) 	AS GRP_SLIP_NO,
		       MAX(JNR.JNR_TP) 			AS JNR_TP,
			   MAX(JNR.JNR_NO) 			AS JNR_NO,
		       MAX(JNR.CURR_CD) 		AS CURR_CD,
		       MAX(JNR.RCV_AMT) 		AS RCV_AMT,
		       ABS(SUM(JNR.COLL_AMT)) 	AS COLL_AMT,
		       SUM(JNR.COLL_AMT) 		AS ORG_COLL_AMT,
		       SUM(JNR.EX_GL_AMT) 		AS EX_GL_AMT,
		       MAX(JNR.BANK_SEQ) 		AS BANK_SEQ,
		       MAX(JNR.CHK_NO) 			AS CHK_NO,
		       MAX(JNR.POST_DT) 		AS POST_DT,
		       MAX(JNR.CLR_YN) 			AS CLR_YN,
		       MAX(JNR.CLR_DT) 			AS CLR_DT,
		       MAX(JNR.VOID_YN) 		AS VOID_YN,
		       MAX(JNR.VOID_DT) 		AS VOID_DT,
		       MAX(JNR.P_OFC_CD) 		AS P_OFC_CD,
		       MAX(JNR.TRDP_CD) 		AS TRDP_CD,
		       MAX(JNR.TRDP_NM) 		AS TRDP_NM,
		       MAX(JNR.CLT_CMPL_FLG)    AS CLT_CMPL_FLG,
		       MAX(JNR.CUR_CHK_NO)      AS CUR_CHK_NO,
		       MAX(JNR.LST_CHK_NO)      AS LST_CHK_NO,
		       MAX(JNR.JNR_YN)      	AS JNR_YN,
		       MAX(JNR.CLS_YN)      	AS CLS_YN,
		       MAX(JNR.VCHR_TP_CD)      AS VCHR_TP_CD,
		       MAX(JNR.VCHR_NO)      	AS VCHR_NO,
		       MAX(JNR.RCV_TP_CD)       AS RCV_TP_CD,
		       MAX(JNR.RMK)             AS R_RMK  <!-- #2623 [CLC] Add remark in Multi Bank Deposit-Payment Entry --> 
		FROM (
				SELECT MST.GRP_SLIP_NO, MST.JNR_NO, MST.JNR_TP, MST.CURR_CD, MST.AMT AS RCV_AMT, DTL.TTL_PAY_AMT AS COLL_AMT, MST.BANK_SEQ, MST.CHK_NO, MST.POST_DT, MST.CLR_YN, MST.CLR_DT, MST.VOID_YN, MST.VOID_DT, 
				       MST.P_OFC_CD, MST.TRDP_CD, TRDP.ENG_NM AS TRDP_NM, ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG) AS CLT_CMPL_FLG, BANK.CUR_CHK_NO, BANK.LST_CHK_NO, MST.JNR_YN, MST.CLS_YN, MST.VCHR_TP_CD, MST.VCHR_NO, MST.RCV_TP_CD,
				       CASE WHEN DTL.GL_NO IN (ISNULL(OFC.GL_EX_PROFIT,''), ISNULL(GL_EX_LOSS,'')) THEN DTL.TTL_PAY_AMT ELSE 0 END AS EX_GL_AMT
				       ,MST.RMK <!-- #2623 [CLC] Add remark in Multi Bank Deposit-Payment Entry  -->
				FROM TB_JNR_MST MST
				JOIN TB_JNR_DTL DTL ON MST.JNR_NO = DTL.JNR_NO AND DTL.DELT_FLG = 'N'
				LEFT OUTER JOIN TB_TRDP TRDP ON MST.TRDP_CD = TRDP.TRDP_CD AND TRDP.DELT_FLG = 'N'
				LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
				LEFT OUTER JOIN TB_BANK BANK ON MST.BANK_SEQ = BANK.BANK_SEQ
				LEFT OUTER JOIN TB_OFC OFC ON OFC.OFC_CD = MST.P_OFC_CD
				WHERE 1 = 1
				AND GRP_SLIP_NO = #f_grp_slip_no#
				AND MST.DELT_FLG = 'N'
		) JNR
		GROUP BY JNR.JNR_NO
		ORDER BY JNR.JNR_NO
    </select>
    
    <!-- JOURNAL 생성된 INVOICE LIST 조회 (Deposit/Payment for China (Entry)) - Detail  -->
    <select id="searchJNR_DTL_FOR_CHINA_LIST" parameterClass="java.util.HashMap" resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > searchJNR_DTL_FOR_CHINA_LIST */
		SELECT Y.*, inv_aply_xcrt * inv_sum_amt AS inv_xcrt_sum_amt
            FROM (
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
    	       ,MAX(inv_dtl.INV_DT)				AS inv_dt
    	       ,MAX(inv_dtl.INV_DUE_DT)			AS inv_due_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'DEBIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'CREDIT'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       
		        <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN SUM(frt.TRF_CUR_SUM_AMT)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN SUM(frt.TRF_CUR_SUM_AMT) * -1
		             ELSE SUM(frt.TRF_CUR_SUM_AMT) 
		        END								AS inv_sum_amt
		        
			   ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0))
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) * -1
		             ELSE CASE WHEN MAX(jnr_mst.jnr_tp) = 'C' THEN (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) * -1
		                       ELSE (isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) END
		        END)	+ 
		        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE CASE WHEN MAX(jnr_mst.jnr_tp) = 'C' THEN MAX(jnr_dtl.pay_amt)  * -1
		                       ELSE MAX(jnr_dtl.pay_amt) END
		        END)						    AS bal_sum_amt
		         -->
		         <!-- #2457 [PATENT] Multi Bank Deposit/Payment Enty, Invoice 기준으로 변경 -->
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(inv_dtl.INV_SUM_AMT)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(inv_dtl.INV_SUM_AMT) * -1
		        END								AS inv_sum_amt			         
			   ,(CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN isnull(MAX(inv_dtl.BAL_AMT),0)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN isnull(MAX(inv_dtl.BAL_AMT),0) * -1
		             ELSE isnull(MAX(inv_dtl.BAL_AMT),0)
		        END)	+
		        (CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE MAX(jnr_dtl.pay_amt)
		        END)							AS bal_sum_amt		        
		        
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1
		             ELSE CASE WHEN MAX(jnr_mst.jnr_tp) = 'C' THEN MAX(jnr_dtl.pay_amt)  * -1
		                       ELSE MAX(jnr_dtl.pay_amt) END 
		        END								AS pay_amt	
			   ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.ttl_pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.ttl_pay_amt) * -1 
		             ELSE CASE WHEN MAX(jnr_mst.jnr_tp) = 'C' THEN MAX(jnr_dtl.ttl_pay_amt)  * -1
		                       ELSE MAX(jnr_dtl.ttl_pay_amt) END 
		        END								AS ttl_pay_amt	
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('S','D') THEN MAX(jnr_dtl.pay_amt)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) IN ('B','C') THEN MAX(jnr_dtl.pay_amt) * -1 
		             ELSE CASE WHEN MAX(jnr_mst.jnr_tp) = 'C' THEN MAX(jnr_dtl.pay_amt)  * -1
		                       ELSE MAX(jnr_dtl.pay_amt) END
		        END								AS old_pay_amt
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       <!-- ,MAX(inv_dtl.inv_no)				AS inv_no -->
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       ,(SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd)) AS trdp_nm
		       ,MAX(jnr_mst.RCVD_FM_NM)			AS rcvd_fm_nm
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       ,(SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.payto_cd)) AS payto_nm
		       ,jnr_mst.JNR_NO					AS jnr_no
		       ,jnr_dtl.JNR_SEQ					AS jnr_seq
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt
		       ,MAX(jnr_dtl.SLS_USRID)			AS SLS_USRID
		       
		       
		       ,MAX(bnd.bnd_clss_cd) as bnd_clss_cd
			   ,MAX(bl.biz_clss_cd)  as biz_clss_cd
			   ,MAX(bl.intg_bl_seq)  as intg_bl_seq
			   ,MAX(isnull(jnr_mst.chk_pnt_yn, 'N'))  as chk_pnt_yn
			   
        	   ,max(jnr_mst.p_ofc_cd) as master_ofc_cd             <!-- 201601  추가  -->  
        	    
        	   
        	   
        	   <!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
   				,(case 
   				 when MAX(TIDB.MODI_TMS) IS null then MAX(inv_dtl.modi_tms)
   				 when MAX(inv_dtl.modi_tms)  > MAX(TIDB.MODI_TMS) then MAX(inv_dtl.modi_tms)
   				 else MAX(TIDB.MODI_TMS) end) AS modi_tms   
   				      	   
   				,(case 
   				 when MAX(TJMB.MODI_TMS) IS null then MAX(jnr_mst.modi_tms)
   				 when MAX(jnr_mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(jnr_mst.modi_tms)
   				 else MAX(TJMB.MODI_TMS) end) AS jnr_modi_tms        	   
        	   
        	    ,MAX(jnr_mst.post_dt)			AS inv_xcrt_dt
        	    ,MAX(jnr_mst.curr_cd)           AS curr_cd
        	    <!-- #2115 [PATENT] Deposit/Payment for CN (ENTRY) 기능 보완 -->
        	    ,MAX(inv_mst.inv_rmk)  as inv_rmk   
            	,MAX(bnd.verify_flag ) as verify_flag
            	,MAX(bnd.pay_flag)     as pay_flag   
        	         
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_INV_DTL inv_dtl          
            	/*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
    		LEFT OUTER JOIN TB_INV inv_mst          
            	ON inv_dtl.inv_seq = inv_mst.inv_seq
		    LEFT OUTER JOIN TB_FRT frt 
		     	ON inv_mst.INV_SEQ = frt.INV_SEQ and frt.DELT_FLG = 'N' AND jnr_dtl.CURR_CD = frt.RAT_CURR_CD
			LEFT OUTER JOIN TB_INTG_BL bl
		     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ and bl.DELT_FLG = 'N'
			LEFT OUTER JOIN TB_OTH_SALES oth
		     	ON frt.OTH_SEQ = oth.OTH_SEQ and oth.DELT_FLG = 'N'
			LEFT OUTER JOIN TB_WM_DOC_MST wms
	   			ON frt.WMS_SEQ = wms.WM_DOC_SEQ AND wms.delt_flg = 'N'
			LEFT OUTER JOIN TB_ADD_INFO_BND bnd
		     	ON frt.INTG_BL_SEQ = bnd.INTG_BL_SEQ and bnd.DELT_FLG = 'N'
		    LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		    	ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
			
			<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
		    LEFT OUTER JOIN
            (
                SELECT MODI_TMS,INV_SEQ FROM TB_INV_DTL_BLCK   
            ) TIDB         
            ON TIDB.INV_SEQ = INV_DTL.INV_SEQ 
		    		
		    LEFT OUTER JOIN
            (
                SELECT MODI_TMS,JNR_NO FROM TB_JNR_MST_BLCK   
            ) TJMB       
            ON TJMB.JNR_NO = JNR_MST.JNR_NO 
		    	
		 WHERE jnr_mst.grp_slip_no = #f_grp_slip_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 GROUP BY jnr_mst.JNR_NO, jnr_dtl.JNR_SEQ
		 ) Y
		 ORDER BY inp_type desc, inv_seq, inv_aply_curr_cd, jnr_seq
    </select>
    
    <select id="selectJnrGrpSlipBlockStatus" parameterClass="HashMap" resultClass="String">
    	/* AccJorJournalSQL.xml > selectJnrGrpSlipBlockStatus */
    	SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END AS CLT_CMPL_FLG
    	FROM   (
    			SELECT CASE WHEN ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, JNR.CLT_CMPL_FLG),'N') = 'N' 
							THEN CASE WHEN ISNULL(JNR.JNR_YN,'N') = 'Y' OR ISNULL(JNR.CLS_YN,'N') = 'Y' THEN 'Y' ELSE 'N' END 
							ELSE 'Y' END AS CLT_CMPL_FLG
				  FROM TB_JNR_MST JNR
				  LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK ON JNR.JNR_NO = BLCK.JNR_NO1
				 WHERE JNR.GRP_SLIP_NO = #grp_slip_no#
    	) INVAL
    	WHERE  1= 1
    	AND    INVAL.CLT_CMPL_FLG = 'Y'
		
	</select> 
	
	<!-- JOURNAL 생성된 INVOICE LIST 조회 (Deposit/Payment for China (List))  -->
    <select id="searchJNR_FOR_CHINA_LIST" parameterClass="java.util.HashMap" resultClass="JournalVO">
		/* AccJorJournalSQL.xml > searchJNR_FOR_CHINA_LIST */
		SELECT MAX(mst.post_dt)			AS post_dt
		      ,MAX(mst.rcvd_fm_nm)		AS rcvd_fm_nm
		      ,MAX(mst.chk_no)			AS chk_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,(select eng_nm from tb_trdp x where x.trdp_cd = MAX(mst.trdp_cd)) AS trdp_nm
		      ,MAX(mst.bank_seq)		AS bank_seq
		      ,(select bk.BANK_NM FROM TB_BANK bk where MAX(mst.bank_seq) = bk.bank_seq) AS bank_nm
		      ,MAX(mst.AMT)     		AS amt
		      ,MAX(mst.curr_cd)			AS curr_cd
		      ,MAX(mst.clr_yn)			AS clr_yn
		      ,MAX(mst.clr_dt)			AS clr_dt
		      ,MAX(mst.void_yn)			AS void_yn
		      ,MAX(mst.void_dt)			AS void_dt
		      ,MAX(isnull(mst.chk_pnt_yn, 'N'))		AS chk_pnt_yn
		      ,MAX(mst.p_ofc_cd)		AS p_ofc_cd
		      ,MAX(mst.rgst_usrid)		AS rgst_usrid
		      ,MAX(mst.jnr_no)			AS jnr_no
		      ,MAX(mst.trdp_cd)			AS trdp_cd
		      ,(select COUNT(x.jnr_no)	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
		       ) AS dtl_cnt
		      ,(select CASE WHEN COUNT(x.jnr_no) > 12 THEN 'Y' ELSE 'N' END	
		          from TB_JNR_DTL x 
		         where x.JNR_NO = MAX(mst.JNR_NO) 
		         <isNotEmpty property="s_ofc_cd">
				 	AND MAX(mst.P_OFC_CD) = #s_ofc_cd#
				 </isNotEmpty>
				 AND DELT_FLG = 'N'
		       ) AS rider_yn
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(mbl.bl_no)
				    ELSE MAX(bl.bl_no)
			   END AS hbl_no
		      ,CASE WHEN MAX(bl.biz_clss_cd) = 'M' THEN MAX(bl.bl_no)
				    ELSE MAX(mbl.bl_no) 		
			   END AS mbl_no
			  ,MAX(bl.ref_no)			AS ref_no 
			  ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
			  ,MAX(mst.rmk) AS RMK	<!-- 20150709 추가. payment list remark 삽입 -->   
			  ,MAX(oth.REF_NO) AS oth_ref_no <!-- 52071 [You First Express] Other Filing No. 추가 on Payment/Deposit List -->   
			  ,MAX(oth.modi_tms) AS modi_tms
			  
				<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
				,(case 
				when MAX(TJMB.MODI_TMS) IS null then MAX(mst.modi_tms)
				when MAX(mst.modi_tms)  > MAX(TJMB.MODI_TMS) then MAX(mst.modi_tms)
				else MAX(TJMB.MODI_TMS) end) AS trx_modi_tms 
			  ,MAX(BLCK.bloked_by)          AS bloked_by     
		      ,MAX(issued_usr.locl_usr_nm)  AS issued_by      
		      ,MAX(BLCK.block_dt)           AS block_dt  
		      ,MAX(mst.grp_slip_no)			AS grp_slip_no	
		      ,MAX(mst.jnr_tp)			    AS jnr_tp	
		      ,MAX(mst.vchr_no) 			AS vchr_no
			  ,(SELECT cd_nm FROM tb_com_cd_dtl vchr_tp WHERE vchr_tp.com_cd = 'C225' AND MAX(mst.vchr_tp_cd) = vchr_tp.cd_val) AS vchr_tp_nm  
			  ,(SELECT cd_nm FROM tb_com_cd_dtl rcv_tp WHERE rcv_tp.com_cd = 'C227' AND MAX(mst.rcv_tp_cd) = rcv_tp.cd_val) AS rcv_tp_nm 
			  ,MAX(mst.aud_flg) 			AS aud_flg
			  ,MAX(mst.aud_usr_id) 	        AS aud_usr_id
			  ,MAX(aud_usr.locl_usr_nm) 	AS aud_usr_name
			  ,MAX(mst.aud_dt) 				AS aud_dt
			  ,MAX(mst.rmk)                 AS rmk <!-- #2623 [CLC] Add remark in Multi Bank Deposit-Payment Entry -->  
		  FROM TB_JNR_MST mst
	LEFT JOIN  TB_JNR_DTL dtl 
		ON mst.JNR_NO = dtl.JNR_NO
	LEFT JOIN TB_INV_DTL inv_dtl 
		ON inv_dtl.INV_SEQ = dtl.INV_SEQ AND inv_dtl.DELT_FLG = 'N' 	
	LEFT JOIN TB_FRT frt 
		ON frt.INV_SEQ = inv_dtl.INV_SEQ AND frt.DELT_FLG = 'N'  
	LEFT JOIN TB_INTG_BL bl 
		ON bl.INTG_BL_SEQ = frt.INTG_BL_SEQ AND bl.DELT_FLG = 'N'
	LEFT JOIN TB_OTH_SALES oth 
		ON oth.OTH_SEQ = frt.OTH_SEQ AND oth.DELT_FLG = 'N'	
	LEFT JOIN tb_intg_bl_rlt rlt
		ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
	LEFT JOIN tb_intg_bl mbl
	    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
	LEFT OUTER JOIN (
			SELECT
				 JNR_NO AS JNR_NO1    
                ,P_OFC_CD AS P_OFC_CD1
                ,CLT_CMPL_FLG AS CLT_CMPL_FLG1
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN      blcked_usr.LOCL_USR_NM                 
                    ELSE '' 
                END AS BLOKED_BY             
                ,CASE 
                    WHEN jmb.CLT_CMPL_FLG = 'Y' THEN         ISNULL(CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.BLOCK_DT),
                    110),
                    CONVERT(VARCHAR(23),
                    CONVERT(DATETIME,
                    jmb.MODI_TMS),
                    110))        
                    ELSE '' 
                END AS BLOCK_DT   
            FROM
                TB_JNR_MST_BLCK   jmb   
            LEFT OUTER JOIN
                tb_usr blcked_usr     
                    ON jmb.rgst_usrid = blcked_usr.usrid       
	) BLCK 
		ON MST.JNR_NO = BLCK.JNR_NO1 AND MST.P_OFC_CD = BLCK.P_OFC_CD1
		
	<!-- 52320 [COMMON] Transaction 변경처리시 Block Date 까지 Check 하도록 수정 -->
	LEFT OUTER JOIN
	(	
		SELECT MODI_TMS, JNR_NO FROM TB_JNR_MST_BLCK     
	) TJMB       
	ON TJMB.JNR_NO = MST.JNR_NO 		
	LEFT OUTER JOIN TB_USR issued_usr    
            ON mst.RGST_USRID = issued_usr.USRID   	
	LEFT OUTER JOIN TB_USR aud_usr    
            ON mst.aud_usr_id = aud_usr.USRID  
             	
		 WHERE isnull(mst.DELT_FLG,'N') = 'N'
		   AND isnull(dtl.DELT_FLG,'N') = 'N'
		   AND isnull(mst.grp_slip_no,'') != ''
		 <isNotEmpty property="s_post_strdt">
		 	<isNotEmpty property="s_post_enddt">
		 		AND mst.POST_DT between #s_post_strdt# AND #s_post_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_deposit_strdt">
		 	<isNotEmpty property="s_deposit_enddt">
		 		AND mst.CLR_DT between #s_deposit_strdt# AND #s_deposit_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_cd">
		 	AND mst.TRDP_CD = #s_rcv_from_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_rcv_from_nm">
		    AND EXISTS(SELECT 1 FROM TB_TRDP trd 
		                WHERE trd.TRDP_CD = mst.TRDP_CD AND trd.ENG_NM LIKE #s_rcv_from_nm# + '%')
		 </isNotEmpty>
		 <isNotEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ = #s_bank_cd#
		 </isNotEmpty>
		 <isEmpty property="s_bank_cd">
		 	AND mst.BANK_SEQ IN (SELECT	bank_seq
		  						   FROM	tb_bank
		 						  WHERE use_flg = 'Y'
									AND (isnull(bank_ofc_cd,'') = '' OR BANK_OFC_CD = #ofc_cd#))
		 </isEmpty>
		 <isNotEmpty property="s_chk_no">
		 	AND mst.CHK_NO LIKE '%' + #s_chk_no# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="s_oth_ref_no">
		 	AND oth.REF_NO LIKE '%' + #s_oth_ref_no# + '%'
		 </isNotEmpty>			 
		 <isNotEmpty property="s_ofc_cd">
		 	AND mst.P_OFC_CD = #s_ofc_cd#
		 </isNotEmpty>
		 <isNotEmpty property="s_amt_fr">
			AND mst.AMT BETWEEN replace(#s_amt_fr#, ',', '') AND replace(#s_amt_to#, ',', '')
		 </isNotEmpty>
		 <isNotEmpty property="s_void_yn">
			AND mst.void_yn = #s_void_yn#
		 </isNotEmpty>
		 <isNotEmpty property="s_void_strdt">
		 	<isNotEmpty property="s_void_enddt">
		 		AND mst.void_dt between #s_void_strdt# AND #s_void_enddt#
		 	</isNotEmpty>
		 </isNotEmpty>
		 <isNotEmpty property="s_hbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN mbl.bl_no
				    ELSE bl.bl_no
			   END) = #s_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_mbl_no">
			AND (CASE WHEN bl.biz_clss_cd = 'M' THEN bl.bl_no
				    ELSE mbl.bl_no 		
			   END) = #s_mbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="s_issued_by">
			AND mst.rgst_usrid = #s_issued_by#
		 </isNotEmpty>
	  GROUP BY mst.JNR_NO
	  ORDER BY MAX(mst.modi_tms) desc, post_dt desc, jnr_no desc
			
    </select>
    
    <!-- Freight 정보를 UPDATE 한다.   -->
    <select id="selectFrtPayAmt" parameterClass="java.util.HashMap" resultClass="FrtVO">
    	SELECT FRT_SEQ, TRF_CUR_SUM_AMT, INV_XCRT, INV_PAY_AMT, INV_BAL_AMT
    	  FROM (
    	SELECT FRT_SEQ, ISNULL(TRF_CUR_SUM_AMT,0) AS TRF_CUR_SUM_AMT, ISNULL(INV_XCRT,1) AS INV_XCRT, ISNULL(PAY_AMT,0) AS INV_PAY_AMT, ISNULL(TRF_CUR_SUM_AMT,0) - ISNULL(PAY_AMT,0) AS INV_BAL_AMT
    	  FROM TB_FRT
		 WHERE INV_SEQ 		= #inv_seq#
		 <isNotEmpty property="curr_cd">
		   AND RAT_CURR_CD 	= #curr_cd#
		 </isNotEmpty>
		   AND DELT_FLG = 'N'
		) FRT
		ORDER BY INV_BAL_AMT DESC, FRT_SEQ
    </select>
    
     <!-- Freight 정보를 UPDATE 한다.   -->
    <update id="updateFrtPayAmt" parameterClass="FrtVO">
    	UPDATE TB_FRT
		   SET PAY_AMT		= ISNULL(PAY_AMT,0) + #inv_pay_amt#,
			   MODI_TMS		= GETUTCDATE()
		 WHERE FRT_SEQ 		= #frt_seq#
    </update>
    
    <!-- Freight 정보를 UPDATE 한다. VOID CHECK 용  -->
    <update id="updateFrtPayAmtVoidCheck" parameterClass="FrtVO">
    	UPDATE TB_FRT
		   SET PAY_AMT		= ISNULL(PAY_AMT,0) - #inv_pay_amt#,
			   MODI_TMS		= GETUTCDATE()
		 WHERE FRT_SEQ 		= #frt_seq#
    </update>
    
    <!-- Invoice 정보를 UPDATE 한다.   -->
    <update id="upateSumFrtAmt" parameterClass="InvJorVO">
    	UPDATE TB_INV_DTL
		   SET INV_STS_CD	= #inv_sts_cd#
		      ,PAY_AMT		= #pay_amt#
		      ,PAY_FRGN_AMT = #pay_frgn_amt#
		      ,BAL_AMT		= #bal_sum_amt#
		      ,BAL_FRGN_AMT = #bal_frgn_amt#
			  ,modi_tms		= GETUTCDATE()
		 WHERE inv_seq 		= #inv_seq#
    </update>
    
    <select id="selectJnrDtlChinaForJnrHistory" parameterClass="java.util.HashMap"  resultClass="InvJorVO">
		/* AccJorJournalSQL.xml > selectJnrDtlForJnrHistory */
    	SELECT  MAX(jnr_dtl.POST_DT)			AS inv_post_dt
		       ,MAX(jnr_dtl.OFC_CD)				AS ofc_cd
		       ,MAX(inv_mst.INV_DEPT_CD)		AS inv_dept_cd
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN 'A/R'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN 'D/C'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN 'D/C'
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN 'A/P'
		        END								AS inv_tp
		       ,MAX(jnr_dtl.INV_NO)				AS inv_no
		       ,CASE WHEN MAX(inv_mst.sell_buy_tp_cd) = 'S' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'D' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'C' THEN MAX(inv_dtl.INV_NO)
		             WHEN MAX(inv_mst.sell_buy_tp_cd) = 'B' THEN MAX(inv_dtl.BUY_INV_NO)
		             ELSE MAX(jnr_dtl.INV_NO)
		        END 							AS buy_inv_no
		       ,MAX(CASE WHEN bl.REF_NO IS NULL OR bl.REF_NO = '' THEN jnr_dtl.REF_NO ELSE bl.REF_NO END)			AS ref_no
		       ,MAX(CASE WHEN bl.BL_NO  IS NULL OR bl.BL_NO = ''  THEN jnr_dtl.BL_NO  ELSE bl.BL_NO  END)	 		AS bl_no
		       ,MAX(jnr_dtl.CURR_CD)   			AS inv_aply_curr_cd
		       ,MAX(jnr_dtl.XCRT)				AS inv_aply_xcrt
		       ,SUM(frt.TRF_CUR_SUM_AMT) AS inv_sum_amt
			   ,(isnull(SUM(frt.TRF_CUR_SUM_AMT),0) - isnull(SUM(frt.PAY_AMT),0)) AS bal_sum_amt
		       ,MAX(jnr_dtl.pay_amt) AS pay_amt	
			   ,MAX(jnr_dtl.ttl_pay_amt) AS ttl_pay_amt	
		       ,MAX(jnr_dtl.ttl_pay_amt) AS old_pay_amt
		       ,MAX(jnr_dtl.GL_NO)				AS gl_no
		       ,(select x.rmk from tb_gl_cd x where x.gl_cd = MAX(jnr_dtl.GL_NO)) AS gl_rmk
		       ,MAX(jnr_dtl.JNR_DESC)			AS jnr_desc
		       ,MAX(inv_dtl.inv_seq)			AS inv_seq
		       ,MAX(inv_dtl.inv_no)				AS inv_no
		       ,MAX(jnr_mst.trdp_cd)			AS trdp_cd
		       ,(SELECT eng_nm FROM TB_TRDP WHERE trdp_cd = MAX(jnr_mst.trdp_cd)) AS trdp_nm
		       ,MAX(jnr_mst.RCVD_FM_NM)			AS rcvd_fm_nm
		       ,MAX(jnr_mst.payto_cd)			AS payto_cd
		       ,MAX(jnr_mst.JNR_NO)				AS jnr_no
		       ,MAX(jnr_dtl.JNR_SEQ)			AS jnr_seq
		       ,MAX(jnr_mst.post_dt)			AS r_post_dt
		       ,MAX(jnr_mst.bank_seq)			AS r_bank_seq
		       ,MAX(jnr_mst.clr_yn)				AS r_clr_yn
		       ,MAX(jnr_mst.clr_dt)				AS r_clr_dt
		       ,MAX(jnr_mst.void_yn)			AS r_void_yn
		       ,MAX(jnr_mst.void_dt)			AS r_void_dt
		       ,MAX(jnr_mst.chk_no)				AS r_chk_no
		       ,MAX(jnr_mst.amt)				AS r_amt
		       ,MAX(jnr_mst.curr_cd)			AS r_curr_cd
		       ,MAX(jnr_mst.rmk)				AS r_rmk
		       ,CASE WHEN MAX(jnr_dtl.INP_TYPE) = 'S' 
						 THEN CASE WHEN MAX(inv_dtl.INV_STS_CD) = 'IE' THEN '1'
								   ELSE '0'
							  END
					 ELSE '1'
		        END 							AS clr_flag
		       ,MAX(inv_mst.sell_buy_tp_cd)		AS sell_buy_tp_cd
		       ,MAX(ISNULL(BLCK.CLT_CMPL_FLG1, JNR_MST.CLT_CMPL_FLG)) AS CLT_CMPL_FLG
		       
		       ,MAX(jnr_dtl.INP_TYPE)			AS INP_TYPE
		       ,MAX(inv_mst.AIR_SEA_CLSS_CD)	AS AIR_SEA_CLSS_CD	
		       
		       ,MAX(jnr_mst.JNR_YN)				AS jnr_yn
		       ,MAX(jnr_mst.JNR_DT)				AS jnr_dt
		       ,MAX(jnr_mst.CLS_YN)				AS cls_yn
		       ,MAX(jnr_mst.CLS_DT)				AS cls_dt	
		       ,(SELECT MAX(modi_seq) FROM TB_JNR_HIS_MST his_mst
					WHERE his_mst.JNR_NO = jnr_dtl.JNR_NO
				) AS MODI_SEQ	       
		       		       
		  FROM TB_JNR_MST jnr_mst
		    LEFT OUTER JOIN TB_JNR_DTL jnr_dtl
		        ON jnr_mst.jnr_no = jnr_dtl.jnr_no AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		    LEFT OUTER JOIN TB_INV_DTL inv_dtl          
            	/*ON jnr_dtl.INV_NO = inv_dtl.INV_NO AND jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ*/
            	ON jnr_dtl.INV_SEQ = inv_dtl.INV_SEQ
    		LEFT OUTER JOIN TB_INV inv_mst          
            	ON inv_dtl.inv_seq = inv_mst.inv_seq
		    LEFT OUTER JOIN TB_FRT frt 
		     	ON inv_mst.INV_SEQ = frt.INV_SEQ AND jnr_dtl.CURR_CD = frt.RAT_CURR_CD
			LEFT OUTER JOIN TB_INTG_BL bl
		     	ON frt.INTG_BL_SEQ = bl.INTG_BL_SEQ
			LEFT OUTER JOIN TB_OTH_SALES oth
		     	ON frt.OTH_SEQ = oth.OTH_SEQ
		    LEFT OUTER JOIN (SELECT JNR_NO AS JNR_NO1, P_OFC_CD AS P_OFC_CD1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_JNR_MST_BLCK) BLCK 
		   		ON JNR_MST.JNR_NO = BLCK.JNR_NO1 AND JNR_MST.P_OFC_CD = BLCK.P_OFC_CD1
		 WHERE jnr_mst.jnr_no = #jnr_no#
		   AND isnull(jnr_mst.DELT_FLG,'N') = 'N'
		   AND isnull(jnr_dtl.DELT_FLG,'N') = 'N'
		 GROUP BY jnr_dtl.JNR_SEQ ,jnr_dtl.JNR_NO
    </select>
    
    <!-- Journal Detail 정보를 UPADTE 한다.   -->
    <update id="updateJnrNo" parameterClass="InvJorVO">
    	UPDATE TB_JNR_DTL
    	   SET jnr_no		= #jnr_no#
    	      ,jnr_seq 		= (SELECT isnull(max(jnr_seq)+1, 1) FROM  tb_jnr_dtl WHERE  jnr_no = #jnr_no#)
			  ,modi_usrid	= #proc_usrid#
			  ,modi_ofc_cd	= #proc_ofccd#
			  ,modi_tms		= GETUTCDATE()
		 WHERE jnr_no 	    = #org_jnr_no#
		   AND jnr_seq 	    = #jnr_seq#
    </update>
    
    <update id="updateJnrAudInfo" parameterClass="JournalVO">
    /* updateJnrAudInfo */
        UPDATE tb_jnr_mst
           SET modi_usrid			= #proc_usrid#
			  ,modi_ofc_cd			= #proc_ofccd#
			  ,modi_tms				= GETUTCDATE()
           <isNotEmpty property="aud_flg">
           		<isEqual property="aud_flg" compareValue="1">
           			,aud_flg		= 'Y'
           			,aud_usr_id     = #proc_usrid#
           			,aud_dt			= #aud_dt#
           		</isEqual>
           		<isNotEqual property="aud_flg" compareValue="1">
           			,aud_flg		= 'N'
           			,aud_usr_id     = ''
           			,aud_dt			= ''
           		</isNotEqual>
           </isNotEmpty>
         WHERE grp_slip_no = #grp_slip_no#
           AND delt_flg = 'N'
    </update>
    
    <!-- #2203 [LBS] Batch Processing Validation 강화 -->
    <select id="checkJnrChanged" parameterClass="java.util.HashMap" resultClass="String">
		/* checkJnrChanged */
    	SELECT isnull(mst.POST_DT, '')
    		+  isnull(mst.TRDP_CD, '')
<!--     		#6003 [StarCluster-Mex, BNX HCM] BANK BATCH PROCESSING ERROR -->
<!--     		+  isnull(CASE WHEN mst.LEVEL = '3' THEN '*******************' -->
<!-- 		            ELSE (SELECT x.ENG_NM FROM TB_TRDP x WHERE x.TRDP_CD = mst.TRDP_CD)  -->
<!-- 		       END, '') -->
		    +  LTRIM(RTRIM(isnull(mst.CHK_NO, '')))
		    +  isnull(mst.CURR_CD, '')
		    +  isnull((SELECT CONVERT(VARCHAR, COUNT(dtl.JNR_NO)) FROM TB_JNR_DTL dtl WHERE mst.JNR_NO = dtl.JNR_NO), '')
		    +  isnull(CONVERT(VARCHAR, CONVERT(NUMERIC(18,2), ROUND(mst.AMT,2))), '')
		    +  isnull(mst.VOID_YN, '')
		    +  isnull(mst.VOID_DT, '')
		    +  isnull(mst.CLR_YN, '')
		    +  isnull(mst.CLR_DT, '')
		    +  isnull(mst.JNR_NO, '')
		    +  isnull(mst.JNR_TP, '')
		    +  isnull(mst.BANK_SEQ, '')
		    +  isnull((SELECT x.bank_nm FROM tb_bank x where x.bank_seq = mst.BANK_SEQ), '')
		    +  isnull(mst.P_OFC_CD, '')
		    +  isnull(mst.OFC_BLCK_FLG, '')
		  FROM TB_JNR_MST mst
		 WHERE 1 = 1
		 AND mst.jnr_no = #jnr_no#
    </select>
    
    <select id="selectFincXchRtUt" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    /* AccJorJournalSQL.xml / selectFincXchRtUt */    
        SELECT  TOP 1 xch_rt_ut
          FROM  tb_finc_perf_xcrt
         WHERE  delt_flg = 'N'
                AND fm_curr_cd = #fm_curr_cd#
                AND to_curr_cd = #to_curr_cd#

    <![CDATA[   AND (     ( dt_clss_cd = 'M' AND aply_fm_dt <= #f_curr_date#       AND     aply_to_dt >= #f_curr_date#)
                      OR  ( dt_clss_cd = 'D' AND aply_fm_dt  = #f_curr_date#) )             ]]>
        
        ORDER BY dt_clss_cd ASC, aply_fm_dt DESC    
    </select>

	<!-- #1106 [UFF] PAYMENT CHECK BATCH PRINT -->
	<select id="searchChkBatchPrintList" parameterClass="java.util.HashMap"  resultClass="JournalVO">
	
		 select mst.JNR_NO,
		        mst.CHK_NO,
		        mst.BANK_SEQ,
		       (select chk_form FROM TB_BANK WHERE bank_seq =  mst.BANK_SEQ  ) as CHK_FORM,
		       (select CASE 
		                    WHEN COUNT(x.jnr_no) > 12 THEN 'Y' 
		                    ELSE 'N' 
		                END              
		          from
		                TB_JNR_DTL x             
		         where  x.JNR_NO = mst.JNR_NO                   
		                AND DELT_FLG = 'N'          ) AS rider_yn     
		  from TB_JNR_MST mst 
		 where mst.CHK_NO between  #f_check_no# and  #t_check_no#
		   AND mst.JNR_TP = 'C'
		   AND isnull(mst.DELT_FLG,'N') = 'N' <!-- #1106 -->
		   AND mst.POST_DT between #f_strdt# AND #f_enddt#  <!-- #3345 #1106 개선사항 -->
		   <isEqual property="cmd_type" compareValue="L1">
		   AND mst.LEVEL  IN ('1')
		   </isEqual>
		   <isEqual property="cmd_type" compareValue="L2">
		   AND mst.LEVEL  IN ('1','2')
		   </isEqual>
		   <isEqual property="cmd_type" compareValue="L3">
		   AND mst.LEVEL  IN ('1','2','3')
		   </isEqual>
		  
		  order by mst.CHK_NO
 
 	
	</select>
	
	<!-- GL_NO 로  BANK INFO 조회  -->
    <select id="searchGlBankInfoNew" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT gl.gl_cd 
		      ,gl.gl_nm
		  FROM TB_GL_CD_NW gl
		 WHERE USE_FLG = 'Y'
		   AND DELT_FLG = 'N'
		   AND gl_cd = #gl_no#		   		
    </select>
    
</sqlMap>